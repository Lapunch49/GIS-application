var Yg=Object.defineProperty;var Zg=(i,t,e)=>t in i?Yg(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var pe=(i,t,e)=>(Zg(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();class Ug{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Je=Ug,lr={PROPERTYCHANGE:"propertychange"};class $g{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const xo=$g;function Kg(i,t,e){let n,r;e=e||On;let s=0,o=i.length,a=!1;for(;s<o;)n=s+(o-s>>1),r=+e(i[n],t),r<0?s=n+1:(o=n,a=!r);return a?s:~s}function On(i,t){return i>t?1:i<t?-1:0}function Eo(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===t)return r;if(s<t)return e(t,i[r-1],s)>0?r-1:r}return n-1}if(e>0){for(let r=1;r<n;++r)if(i[r]<t)return r-1;return n-1}if(e<0){for(let r=1;r<n;++r)if(i[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==t)return r;if(i[r]<t)return i[r-1]-t<t-i[r]?r-1:r}return n-1}function jg(i,t,e){for(;t<e;){const n=i[t];i[t]=i[e],i[e]=n,++t,--e}}function gn(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function di(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function Vg(i,t,e){const n=t||On;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||e&&o===0)})}function Fr(){return!0}function vo(){return!1}function hr(){}function dc(i){let t=!1,e,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==r||!di(s,n))&&(t=!0,r=this,n=s,e=i.apply(this,arguments)),e}}function gc(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function ts(i){for(const t in i)delete i[t]}function Oi(i){let t;for(t in i)return!1;return!t}class qg extends xo{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new Je(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,u=r.length;h<u;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,hr);delete o[n]}return l}disposeInternal(){this.listeners_&&ts(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=hr,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}const es=qg,et={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function dt(i,t,e,n,r){if(n&&n!==i&&(e=e.bind(n)),r){const o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function js(i,t,e,n){return dt(i,t,e,n,!0)}function Rt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ts(i))}class wo extends es{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(et.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=dt(this,t[s],e);return r}return dt(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=js(this,t[s],e)}else n=js(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Hg(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}wo.prototype.on;wo.prototype.once;wo.prototype.un;function Hg(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Rt(i[t]);else Rt(i)}const mc=wo;function nt(){throw new Error("Unimplemented abstract method.")}let Jg=0;function pt(i){return i.ol_uid||(i.ol_uid=String(++Jg))}class Yh extends Je{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Qg extends mc{constructor(t){super(),this.on,this.once,this.un,pt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Yh(n,t,e)),n=lr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Yh(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){!t.values_||Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Oi(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const pn=Qg,ye={ADD:"add",REMOVE:"remove"},Zh={LENGTH:"length"};class As extends Je{constructor(t,e,n){super(t),this.element=e,this.index=n}}class tm extends pn{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Zh.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new As(ye.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new As(ye.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new As(ye.REMOVE,r,t)),this.dispatchEvent(new As(ye.ADD,e,t))}updateLength_(){this.set(Zh.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}const cn=tm,vt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function mt(i,t){if(!i)throw new Error(t)}function Xt(i,t,e){return Math.min(Math.max(i,t),e)}function em(i,t,e,n,r,s){const o=r-e,a=s-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=r,n=s):l>0&&(e+=o*l,n+=a*l)}return Ti(i,t,e,n)}function Ti(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function nm(i){const t=i.length;for(let n=0;n<t;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<t;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<t+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let r=n-1;r>=0;r--)i[r][t]-=i[r][n]*e[n]}return e}function Zs(i){return i*Math.PI/180}function Mi(i,t){const e=i%t;return e*t<0?e+t:e}function Re(i,t,e){return i+e*(t-i)}function rl(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Ls(i,t){return Math.floor(rl(i,t))}function ei(i,t){return Math.ceil(rl(i,t))}class im extends pn{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[vt.OPACITY]=t.opacity!==void 0?t.opacity:1,mt(typeof e[vt.OPACITY]=="number","Layer opacity must be a number"),e[vt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[vt.Z_INDEX]=t.zIndex,e[vt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[vt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[vt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[vt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=Xt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return nt()}getLayerStatesArray(t){return nt()}getExtent(){return this.get(vt.EXTENT)}getMaxResolution(){return this.get(vt.MAX_RESOLUTION)}getMinResolution(){return this.get(vt.MIN_RESOLUTION)}getMinZoom(){return this.get(vt.MIN_ZOOM)}getMaxZoom(){return this.get(vt.MAX_ZOOM)}getOpacity(){return this.get(vt.OPACITY)}getSourceState(){return nt()}getVisible(){return this.get(vt.VISIBLE)}getZIndex(){return this.get(vt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(vt.EXTENT,t)}setMaxResolution(t){this.set(vt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(vt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(vt.MAX_ZOOM,t)}setMinZoom(t){this.set(vt.MIN_ZOOM,t)}setOpacity(t){mt(typeof t=="number","Layer opacity must be a number"),this.set(vt.OPACITY,t)}setVisible(t){this.set(vt.VISIBLE,t)}setZIndex(t){this.set(vt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const _c=im,Fe={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Vt={ANIMATING:0,INTERACTING:1},Ke={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},rm=42,sl=256,Dr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class sm{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Dr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const pc=sm,ns=6378137,rr=Math.PI*ns,om=[-rr,-rr,rr,rr],am=[-180,-85,180,85],Ps=ns*Math.log(Math.tan(Math.PI/2));class Ki extends pc{constructor(t){super({code:t,units:"m",extent:om,global:!0,worldExtent:am,getPointResolution:function(e,n){return e/Math.cosh(n[1]/ns)}})}}const Uh=[new Ki("EPSG:3857"),new Ki("EPSG:102100"),new Ki("EPSG:102113"),new Ki("EPSG:900913"),new Ki("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ki("http://www.opengis.net/gml/srs/epsg.xml#3857")];function lm(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e){t[r]=rr*i[r]/180;let s=ns*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>Ps?s=Ps:s<-Ps&&(s=-Ps),t[r+1]=s}return t}function hm(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e)t[r]=180*i[r]/rr,t[r+1]=360*Math.atan(Math.exp(i[r+1]/ns))/Math.PI-90;return t}const um=6378137,$h=[-180,-90,180,90],cm=Math.PI*um/180;class xi extends pc{constructor(t,e){super({code:t,units:"degrees",extent:$h,axisOrientation:e,global:!0,metersPerUnit:cm,worldExtent:$h})}}const Kh=[new xi("CRS:84"),new xi("EPSG:4326","neu"),new xi("urn:ogc:def:crs:OGC:1.3:CRS84"),new xi("urn:ogc:def:crs:OGC:2:84"),new xi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new xi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new xi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let ba={};function fm(i){return ba[i]||ba[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function dm(i,t){ba[i]=t}let sr={};function Vs(i,t,e){const n=i.getCode(),r=t.getCode();n in sr||(sr[n]={}),sr[n][r]=e}function gm(i,t){let e;return i in sr&&t in sr[i]&&(e=sr[i][t]),e}const jt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function jh(i){const t=ze();for(let e=0,n=i.length;e<n;++e)Pr(t,i[e]);return t}function ol(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function yc(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function Di(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function Fi(i,t){return al(i,t[0],t[1])}function An(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function al(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Ta(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1];let l=jt.UNKNOWN;return o<e?l=l|jt.LEFT:o>r&&(l=l|jt.RIGHT),a<n?l=l|jt.BELOW:a>s&&(l=l|jt.ABOVE),l===jt.UNKNOWN&&(l=jt.INTERSECTING),l}function ze(){return[1/0,1/0,-1/0,-1/0]}function hi(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function is(i){return hi(1/0,1/0,-1/0,-1/0,i)}function xc(i,t){const e=i[0],n=i[1];return hi(e,n,e,n,t)}function ll(i,t,e,n,r){const s=is(r);return vc(s,i,t,e,n)}function ui(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function Ec(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function Pr(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function vc(i,t,e,n,r){for(;e<n;e+=r)mm(i,t[e],t[e+1]);return i}function mm(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function wc(i,t){let e;return e=t(Co(i)),e||(e=t(Ro(i)),e)||(e=t(So(i)),e)||(e=t(ki(i)),e)?e:!1}function Ma(i){let t=0;return gr(i)||(t=ft(i)*Ot(i)),t}function Co(i){return[i[0],i[1]]}function Ro(i){return[i[2],i[1]]}function qe(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function _m(i,t){let e;if(t==="bottom-left")e=Co(i);else if(t==="bottom-right")e=Ro(i);else if(t==="top-left")e=ki(i);else if(t==="top-right")e=So(i);else throw new Error("Invalid corner");return e}function qs(i,t,e,n,r){const[s,o,a,l,h,u,c,f]=Aa(i,t,e,n);return hi(Math.min(s,a,h,c),Math.min(o,l,u,f),Math.max(s,a,h,c),Math.max(o,l,u,f),r)}function Aa(i,t,e,n){const r=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,u=s*o,c=s*a,f=i[0],g=i[1];return[f-l+c,g-h-u,f-l-c,g-h+u,f+l-c,g+h+u,f+l+c,g+h-u,f-l+c,g-h-u]}function Ot(i){return i[3]-i[1]}function Ai(i,t,e){const n=e||ze();return fe(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):is(n),n}function ki(i){return[i[0],i[3]]}function So(i){return[i[2],i[3]]}function ft(i){return i[2]-i[0]}function fe(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function gr(i){return i[2]<i[0]||i[3]<i[1]}function pm(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function ym(i,t,e){let n=!1;const r=Ta(i,t),s=Ta(i,e);if(r===jt.INTERSECTING||s===jt.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],u=t[0],c=t[1],f=e[0],g=e[1],_=(g-c)/(f-u);let m,y;!!(s&jt.ABOVE)&&!(r&jt.ABOVE)&&(m=f-(g-h)/_,n=m>=o&&m<=l),!n&&!!(s&jt.RIGHT)&&!(r&jt.RIGHT)&&(y=g-(f-l)*_,n=y>=a&&y<=h),!n&&!!(s&jt.BELOW)&&!(r&jt.BELOW)&&(m=f-(g-a)/_,n=m>=o&&m<=l),!n&&!!(s&jt.LEFT)&&!(r&jt.LEFT)&&(y=g-(f-o)*_,n=y>=a&&y<=h)}return n}function Cc(i,t){const e=t.getExtent(),n=qe(i);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const r=ft(e),o=Math.floor((n[0]-e[0])/r)*r;i[0]-=o,i[2]-=o}return i}function xm(i,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[e[0],i[1],e[2],i[3]]];Cc(i,t);const n=ft(e);if(ft(i)>n)return[[e[0],i[1],e[2],i[3]]];if(i[0]<e[0])return[[i[0]+n,i[1],e[2],i[3]],[e[0],i[1],i[2],i[3]]];if(i[2]>e[2])return[[i[0],i[1],e[2],i[3]],[e[0],i[1],i[2]-n,i[3]]]}return[i]}function Em(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function Hs(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function hl(i,t){const e=Math.cos(t),n=Math.sin(t),r=i[0]*e-i[1]*n,s=i[1]*e+i[0]*n;return i[0]=r,i[1]=s,i}function vm(i,t){return i[0]*=t,i[1]*=t,i}function Rc(i,t){if(t.canWrapX()){const e=ft(t.getExtent()),n=wm(i,t,e);n&&(i[0]-=n*e)}return i}function wm(i,t,e){const n=t.getExtent();let r=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||ft(n),r=Math.floor((i[0]-n[0])/e)),r}const Cm=63710088e-1;function Vh(i,t,e){e=e||Cm;const n=Zs(i[1]),r=Zs(t[1]),s=(r-n)/2,o=Zs(t[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const Sc={info:1,warn:2,error:3,none:4};let Rm=Sc.info;function Ic(...i){Rm>Sc.warn||console.warn(...i)}let La=!0;function Sm(i){La=!(i===void 0?!0:i)}function ul(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function bc(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function Im(i){dm(i.getCode(),i),Vs(i,i,ul)}function bm(i){i.forEach(Im)}function Wt(i){return typeof i=="string"?fm(i):i||null}function qh(i,t,e,n){i=Wt(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(t,e),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/Dr[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=t;else{const a=Io(i,Wt("EPSG:4326"));if(a===bc&&o!=="degrees")r=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const u=Vh(h.slice(0,2),h.slice(2,4)),c=Vh(h.slice(4,6),h.slice(6,8));r=(u+c)/2}const l=n?Dr[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Hh(i){bm(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Vs(t,e,ul)})})}function Tm(i,t,e,n){i.forEach(function(r){t.forEach(function(s){Vs(r,s,e),Vs(s,r,n)})})}function cl(i,t){return i?typeof i=="string"?Wt(i):i:Wt(t)}function kr(i,t){const e=Tc(i,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=Mi(n+180,360)-180),e}function Mn(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Io(i,t)===ul)&&e}function Io(i,t){const e=i.getCode(),n=t.getCode();let r=gm(e,n);return r||(r=bc),r}function Nr(i,t){const e=Wt(i),n=Wt(t);return Io(e,n)}function Tc(i,t,e){return Nr(t,e)(i,void 0,i.length)}let Mm=null;function Am(){return Mm}function Pa(i,t){return i}function Sn(i,t){return La&&!Hs(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(La=!1,Ic("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function fl(i,t){return i}function Ln(i,t){return i}function Lm(){Hh(Uh),Hh(Kh),Tm(Kh,Uh,lm,hm)}Lm();function Jh(i,t,e){return function(n,r,s,o,a){if(!n)return;if(!r&&!t)return n;const l=t?0:s[0]*r,h=t?0:s[1]*r,u=a?a[0]:0,c=a?a[1]:0;let f=i[0]+l/2+u,g=i[2]-l/2+u,_=i[1]+h/2+c,m=i[3]-h/2+c;f>g&&(f=(g+f)/2,g=f),_>m&&(_=(m+_)/2,m=_);let y=Xt(n[0],f,g),x=Xt(n[1],_,m);if(o&&e&&r){const E=30*r;y+=-E*Math.log(1+Math.max(0,f-n[0])/E)+E*Math.log(1+Math.max(0,n[0]-g)/E),x+=-E*Math.log(1+Math.max(0,_-n[1])/E)+E*Math.log(1+Math.max(0,n[1]-m)/E)}return[y,x]}}function Pm(i){return i}function dl(i,t,e,n){const r=ft(t)/e[0],s=Ot(t)/e[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function gl(i,t,e){let n=Math.min(i,t);const r=50;return n*=Math.log(1+r*Math.max(0,i/t-1))/r+1,e&&(n=Math.max(n,e),n/=Math.log(1+r*Math.max(0,e/i-1))/r+1),Xt(n,e/2,t*2)}function Om(i,t,e,n){return t=t!==void 0?t:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],u=e?dl(l,e,o,n):l;if(a)return t?gl(r,u,h):Xt(r,h,u);const c=Math.min(u,r),f=Math.floor(Eo(i,c,s));return i[f]>u&&f<i.length-1?i[f+1]:i[f]}}}function Fm(i,t,e,n,r,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const u=r?dl(t,r,l,s):t;if(h)return n?gl(o,u,e):Xt(o,e,u);const c=1e-9,f=Math.ceil(Math.log(t/u)/Math.log(i)-c),g=-a*(.5-c)+.5,_=Math.min(u,o),m=Math.floor(Math.log(t/_)/Math.log(i)+g),y=Math.max(f,m),x=t/Math.pow(i,y);return Xt(x,e,u)}}}function Qh(i,t,e,n,r){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?dl(i,n,a,r):i;return!e||!l?Xt(s,t,h):gl(s,h,t)}}}function ml(i){if(i!==void 0)return 0}function tu(i){if(i!==void 0)return i}function Dm(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function km(i){const t=i===void 0?Zs(5):i;return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function Mc(i){return Math.pow(i,3)}function mr(i){return 1-Mc(1-i)}function Nm(i){return 3*i*i-2*i*i*i}function Gm(i){return i}new Array(6);function Me(){return[1,0,0,1,0,0]}function zm(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function Zt(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function Xe(i,t,e,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+t,i[5]=o*r*l+a*r*h+e,i}function bo(i,t){const e=Xm(t);mt(e!==0,"Transformation matrix cannot be inverted");const n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-r/e,i[2]=-s/e,i[3]=n/e,i[4]=(s*l-o*a)/e,i[5]=-(n*l-r*a)/e,i}function Xm(i){return i[0]*i[3]-i[1]*i[2]}const eu=[1e6,1e6,1e6,1e6,2,2];function _l(i){return"matrix("+i.map((e,n)=>Math.round(e*eu[n])/eu[n]).join(", ")+")"}function oi(i,t,e,n,r,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function Ac(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],u=s[1];let c=0;for(let f=t;f<e;f+=n){const g=i[f]-h,_=i[f+1]-u;o[c++]=h+g*a-_*l,o[c++]=u+g*l+_*a;for(let m=f+2;m<f+n;++m)o[c++]=i[m]}return o&&o.length!=c&&(o.length=c),o}function Wm(i,t,e,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let c=t;c<e;c+=n){const f=i[c]-l,g=i[c+1]-h;a[u++]=l+r*f,a[u++]=h+s*g;for(let _=c+2;_<c+n;++_)a[u++]=i[_]}return a&&a.length!=u&&(a.length=u),a}function Bm(i,t,e,n,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const nu=Me();class Ym extends pn{constructor(){super(),this.extent_=ze(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=dc((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return nt()}closestPointXY(t,e,n,r){return nt()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return nt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&is(e),this.extentRevision_=this.getRevision()}return pm(this.extent_,t)}rotate(t,e){nt()}scale(t,e,n){nt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return nt()}getType(){return nt()}applyTransform(t){nt()}intersectsExtent(t){return nt()}translate(t,e){nt()}transform(t,e){const n=Wt(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),u=Ot(h)/Ot(l);return Xe(nu,h[0],h[3],u,-u,0,0,0),oi(s,0,s.length,a,nu,o),Nr(n,e)(s,o,a)}:Nr(n,e);return this.applyTransform(r),this}}const Lc=Ym;class Zm extends Lc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return ll(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return nt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=iu(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){nt()}setLayout(t,e,n){let r;if(t)r=iu(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=Ni(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Ac(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=qe(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Wm(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Bm(n,0,n.length,r,t,e,n),this.changed()}}}function Ni(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function iu(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Um(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return oi(n,0,n.length,r,t,e)}const Gi=Zm;function ru(i,t,e,n,r,s,o){const a=i[t],l=i[t+1],h=i[e]-a,u=i[e+1]-l;let c;if(h===0&&u===0)c=t;else{const f=((r-a)*h+(s-l)*u)/(h*h+u*u);if(f>1)c=e;else if(f>0){for(let g=0;g<n;++g)o[g]=Re(i[t+g],i[e+g],f);o.length=n;return}else c=t}for(let f=0;f<n;++f)o[f]=i[c+f];o.length=n}function pl(i,t,e,n,r){let s=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=Ti(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function yl(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=pl(i,t,a,n,r),t=a}return r}function $m(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=yl(i,t,a,n,r),t=a[a.length-1]}return r}function xl(i,t,e,n,r,s,o,a,l,h,u){if(t==e)return h;let c,f;if(r===0){if(f=Ti(o,a,i[t],i[t+1]),f<h){for(c=0;c<n;++c)l[c]=i[t+c];return l.length=n,f}return h}u=u||[NaN,NaN];let g=t+n;for(;g<e;)if(ru(i,g-n,g,n,o,a,u),f=Ti(o,a,u[0],u[1]),f<h){for(h=f,c=0;c<n;++c)l[c]=u[c];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/r|0,1);if(s&&(ru(i,e-n,t,n,o,a,u),f=Ti(o,a,u[0],u[1]),f<h)){for(h=f,c=0;c<n;++c)l[c]=u[c];l.length=n}return h}function El(i,t,e,n,r,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,f=e.length;c<f;++c){const g=e[c];h=xl(i,t,g,n,r,s,o,a,l,h,u),t=g}return h}function Km(i,t,e,n,r,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,f=e.length;c<f;++c){const g=e[c];h=El(i,t,g,n,r,s,o,a,l,h,u),t=g[g.length-1]}return h}function jm(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function To(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function rs(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=To(i,t,e[o],n);r[s++]=l,t=l}return r.length=s,r}function Pc(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=rs(i,t,e[o],n,r[s]);l.length===0&&(l[0]=t),r[s++]=l,t=l[l.length-1]}return r.length=s,r}function Mo(i,t,e,n,r,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=i[t],s[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let u=0;for(;h.length>0;){const c=h.pop(),f=h.pop();let g=0;const _=i[f],m=i[f+1],y=i[c],x=i[c+1];for(let E=f+n;E<c;E+=n){const v=i[E],R=i[E+1],w=em(v,R,_,m,y,x);w>g&&(u=E,g=w)}g>r&&(l[(u-t)/n]=1,f+n<u&&h.push(f,u),u+n<c&&h.push(u,c))}for(let c=0;c<a;++c)l[c]&&(s[o++]=i[t+c*n],s[o++]=i[t+c*n+1]);return o}function Oc(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=Mo(i,t,u,n,r,s,o),a.push(o),t=u}return o}function wi(i,t){return t*Math.round(i/t)}function Vm(i,t,e,n,r,s,o){if(t==e)return o;let a=wi(i[t],r),l=wi(i[t+1],r);t+=n,s[o++]=a,s[o++]=l;let h,u;do if(h=wi(i[t],r),u=wi(i[t+1],r),t+=n,t==e)return s[o++]=h,s[o++]=u,o;while(h==a&&u==l);for(;t<e;){const c=wi(i[t],r),f=wi(i[t+1],r);if(t+=n,c==h&&f==u)continue;const g=h-a,_=u-l,m=c-a,y=f-l;if(g*y==_*m&&(g<0&&m<g||g==m||g>0&&m>g)&&(_<0&&y<_||_==y||_>0&&y>_)){h=c,u=f;continue}s[o++]=h,s[o++]=u,a=h,l=u,h=c,u=f}return s[o++]=h,s[o++]=u,o}function vl(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=Vm(i,t,u,n,r,s,o),a.push(o),t=u}return o}function qm(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l],c=[];o=vl(i,t,u,n,r,s,o,c),a.push(c),t=u[u.length-1]}return o}function ni(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<e;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function Gr(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=ni(i,t,l,n,r[s]),t=l}return r.length=s,r}function Oa(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=l.length===1&&l[0]===t?[]:Gr(i,t,l,n,r[s]),t=l[l.length-1]}return r.length=s,r}function Fc(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=o*a-s*l,s=a,o=l}return r/2}function Dc(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Fc(i,t,a,n),t=a}return r}function Hm(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Dc(i,t,a,n),t=a[a.length-1]}return r}class Js extends Gi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Js(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<Di(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Fc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ni(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Js(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=To(this.flatCoordinates,0,t,this.stride),this.changed()}}const su=Js;class wl extends Gi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new wl(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=Ti(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return xc(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return al(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jm(this.flatCoordinates,0,t,this.stride),this.changed()}}const zr=wl;function Jm(i,t,e,n,r){return!wc(r,function(o){return!Ri(i,t,e,n,o[0],o[1])})}function Ri(i,t,e,n,r,s){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],u=i[t+1];l<=s?u>s&&(h-a)*(s-l)-(r-a)*(u-l)>0&&o++:u<=s&&(h-a)*(s-l)-(r-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function Cl(i,t,e,n,r,s){if(e.length===0||!Ri(i,t,e[0],n,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Ri(i,e[o-1],e[o],n,r,s))return!1;return!0}function Qm(i,t,e,n,r,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(Cl(i,t,l,n,r,s))return!0;t=l[l.length-1]}return!1}function Rl(i,t,e,n,r,s,o){let a,l,h,u,c,f,g;const _=r[s+1],m=[];for(let E=0,v=e.length;E<v;++E){const R=e[E];for(u=i[R-n],f=i[R-n+1],a=t;a<R;a+=n)c=i[a],g=i[a+1],(_<=f&&g<=_||f<=_&&_<=g)&&(h=(_-f)/(g-f)*(c-u)+u,m.push(h)),u=c,f=g}let y=NaN,x=-1/0;for(m.sort(On),u=m[0],a=1,l=m.length;a<l;++a){c=m[a];const E=Math.abs(c-u);E>x&&(h=(u+c)/2,Cl(i,t,e,n,h,_)&&(y=h,x=E)),u=c}return isNaN(y)&&(y=r[s]),o?(o.push(y,_,x),o):[y,_,x]}function kc(i,t,e,n,r){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Rl(i,t,l,n,r,2*o,s),t=l[l.length-1]}return s}function Nc(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function Ao(i,t,e,n,r){const s=vc(ze(),i,t,e,n);return fe(r,s)?An(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:Nc(i,t,e,n,function(o,a){return ym(r,o,a)}):!1}function t_(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){if(Ao(i,t,e[s],n,r))return!0;t=e[s]}return!1}function Gc(i,t,e,n,r){return!!(Ao(i,t,e,n,r)||Ri(i,t,e,n,r[0],r[1])||Ri(i,t,e,n,r[0],r[3])||Ri(i,t,e,n,r[2],r[1])||Ri(i,t,e,n,r[2],r[3]))}function zc(i,t,e,n,r){if(!Gc(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Jm(i,e[s-1],e[s],n,r)&&!Ao(i,e[s-1],e[s],n,r))return!1;return!0}function e_(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(zc(i,t,a,n,r))return!0;t=a[a.length-1]}return!1}function n_(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function Sl(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function Il(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=Sl(i,t,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function Xc(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!Il(i,t,a,n,r))return!1;a.length&&(t=a[a.length-1])}return!0}function Qs(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=Sl(i,t,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&n_(i,t,a,n),t=a}return t}function Fa(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s)t=Qs(i,t,e[s],n,r);return t}function i_(i,t){const e=[];let n=0,r=0,s;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=Sl(i,n,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(r,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=o+1,n=l}return e}class Xr extends Gi{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?gn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Xr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<Di(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),El(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Cl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Dc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Qs(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Gr(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=qe(this.getExtent());this.flatInteriorPoint_=Rl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new zr(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new su(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new su(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Il(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Qs(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=vl(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Xr(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return zc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=rs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Wr=Xr;function ou(i){if(gr(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],r=i[3],s=[t,e,t,r,n,r,n,e,t,e];return new Xr(s,"XY",[s.length])}const ea=0;class r_ extends pn{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=cl(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Sm(),t.center&&(t.center=Sn(t.center,this.projection_)),t.extent&&(t.extent=Ln(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Ke)delete e[a];this.setProperties(e,!0);const n=o_(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const r=s_(t),s=n.constraint,o=a_(t);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const r=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-e[3]+e[1]-r[1]),a=s/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=Sn(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=Sn(r.anchor,this.getProjection())),e[n]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const u=arguments[r];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(r===e){n&&Os(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const u=arguments[r],c={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||Nm,callback:n};if(u.center&&(c.sourceCenter=o,c.targetCenter=u.center.slice(),o=c.targetCenter),u.zoom!==void 0?(c.sourceResolution=a,c.targetResolution=this.getResolutionForZoom(u.zoom),a=c.targetResolution):u.resolution&&(c.sourceResolution=a,c.targetResolution=u.resolution,a=c.targetResolution),u.rotation!==void 0){c.sourceRotation=l;const f=Mi(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=l+f,l=c.targetRotation}l_(c)?c.complete=!0:s+=c.duration,h.push(c)}this.animations_.push(h),this.setHint(Vt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Vt.ANIMATING]>0}getInteracting(){return this.hints_[Vt.INTERACTING]>0}cancelAnimations(){this.setHint(Vt.ANIMATING,-this.hints_[Vt.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const r=this.animations_[e];if(r[0].callback&&Os(r[0].callback,!1),!t)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=t-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const c=l.easing(u);if(l.sourceCenter){const f=l.sourceCenter[0],g=l.sourceCenter[1],_=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const y=f+c*(_-f),x=g+c*(m-g);this.targetCenter_=[y,x]}if(l.sourceResolution&&l.targetResolution){const f=c===1?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(f,0,g,!0);this.targetCenter_=this.calculateCenterZoom(_,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=c===1?Mi(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Vt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Os(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-e[0],r[1]-e[1]],hl(n,t-this.getRotation()),Em(n,e)),n}calculateCenterZoom(t,e){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-r[0])/s,a=e[1]-t*(e[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],r=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Pa(t,this.getProjection())}getCenterInternal(){return this.get(Ke.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return fl(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();mt(e,"The view center is not defined");const n=this.getResolution();mt(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return mt(r!==void 0,"The view rotation is not defined"),qs(e,n,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ke.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ln(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=ft(t)/e[0],r=Ot(t)/e[1];return Math.max(n,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*r)}}getRotation(){return this.get(Ke.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=na(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,r;if(this.resolutions_){const s=Eo(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(n/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Xt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,Xt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(mt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){mt(!gr(t),"Cannot fit empty extent provided as `geometry`");const r=Ln(t,this.getProjection());n=ou(r)}else if(t.getType()==="Circle"){const r=Ln(t.getExtent(),this.getProjection());n=ou(r),n.rotate(this.getRotation(),qe(r))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),r=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let c=0,f=s.length;c<f;c+=o){const g=s[c]*n-s[c+1]*r,_=s[c]*r+s[c+1]*n;a=Math.min(a,g),l=Math.min(l,_),h=Math.max(h,g),u=Math.max(u,_)}return[a,l,h,u]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),u=Math.sin(h),c=Math.cos(h),f=qe(a);f[0]+=(r[1]-r[3])/2*l,f[1]+=(r[0]-r[2])/2*l;const g=f[0]*c-f[1]*u,_=f[1]*c+f[0]*u,m=this.getConstrainedCenter([g,_],l),y=e.callback?e.callback:hr;e.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:e.duration,easing:e.easing},y):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),Os(y,!0))}centerOn(t,e,n){this.centerOnInternal(Sn(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(na(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,r){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=na(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Pa(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Sn(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,r,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Sn(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Sn(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Ke.ROTATION)!==r&&this.set(Ke.ROTATION,r),this.get(Ke.RESOLUTION)!==o&&(this.set(Ke.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ke.CENTER)||!Hs(this.get(Ke.CENTER),a))&&this.set(Ke.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const r=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Hs(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:mr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Vt.INTERACTING,1)}endInteraction(t,e,n){n=n&&Sn(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){!this.getInteracting()||(this.setHint(Vt.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function Os(i,t){setTimeout(function(){i(t)},0)}function s_(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Jh(i.extent,i.constrainOnlyCenter,e)}const t=cl(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Jh(e,!1,!1)}return Pm}function o_(i){let t,e,n,o=i.minZoom!==void 0?i.minZoom:ea,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,u=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,c=i.showFullExtent!==void 0?i.showFullExtent:!1,f=cl(i.projection,"EPSG:3857"),g=f.getExtent();let _=i.constrainOnlyCenter,m=i.extent;if(!h&&!m&&f.isGlobal()&&(_=!1,m=g),i.resolutions!==void 0){const y=i.resolutions;e=y[o],n=y[a]!==void 0?y[a]:y[y.length-1],i.constrainResolution?t=Om(y,u,!_&&m,c):t=Qh(e,n,u,!_&&m,c)}else{const x=(g?Math.max(ft(g),Ot(g)):360*Dr.degrees/f.getMetersPerUnit())/sl/Math.pow(2,ea),E=x/Math.pow(2,28-ea);e=i.maxResolution,e!==void 0?o=0:e=x/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(l,a):n=x/Math.pow(l,a):n=E),a=o+Math.floor(Math.log(e/n)/Math.log(l)),n=e/Math.pow(l,a-o),i.constrainResolution?t=Fm(l,e,n,u,!_&&m,c):t=Qh(e,n,u,!_&&m,c)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:o,zoomFactor:l}}function a_(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?km():e===!1?tu:typeof e=="number"?Dm(e):tu}return ml}function l_(i){return!(i.sourceCenter&&i.targetCenter&&!Hs(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function na(i,t,e,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,u=l*s+a*o;return[h,u]}const hn=r_;class h_ extends _c{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(vt.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(vt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Rt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=dt(t,et.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof hn?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return bl(r,e.viewState)&&(!s||fe(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const r=t instanceof hn?t.getViewStateAndExtent():t;let s=e(r);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();!e||e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(vt.MAP,t)}getMapInternal(){return this.get(vt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Rt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Rt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=dt(t,Fe.PRECOMPOSE,function(e){const r=e.frameState.layerStatesArray,s=this.getLayerState(!1);mt(!r.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=dt(this,et.CHANGE,t.render,t),this.changed())}setSource(t){this.set(vt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function bl(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}const ss=h_;function u_(i,t,e,n,r){Wc(i,t,e||0,n||i.length-1,r||c_)}function Wc(i,t,e,n,r){for(;n>e;){if(n-e>600){var s=n-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(e,Math.floor(t-o*l/s+h)),c=Math.min(n,Math.floor(t+(s-o)*l/s+h));Wc(i,t,u,c,r)}var f=i[t],g=e,_=n;for(Cr(i,e,t),r(i[n],f)>0&&Cr(i,e,n);g<_;){for(Cr(i,g,_),g++,_--;r(i[g],f)<0;)g++;for(;r(i[_],f)>0;)_--}r(i[e],f)===0?Cr(i,e,_):(_++,Cr(i,_,n)),_<=t&&(e=_+1),t<=_&&(n=_-1)}}function Cr(i,t,e){var n=i[t];i[t]=i[e],i[e]=n}function c_(i,t){return i<t?-1:i>t?1:0}class Tl{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Ds(t,e))return n;const r=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?r(a):a;Ds(t,l)&&(e.leaf?n.push(a):ra(t,l)?this._all(a,n):s.push(a))}e=s.pop()}return n}collides(t){let e=this.data;if(!Ds(t,e))return!1;const n=[];for(;e;){for(let r=0;r<e.children.length;r++){const s=e.children[r],o=e.leaf?this.toBBox(s):s;if(Ds(t,o)){if(e.leaf||ra(t,o))return!0;n.push(s)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=tr([]),this}remove(t,e){if(!t)return this;let n=this.data;const r=this.toBBox(t),s=[],o=[];let a,l,h;for(;n||s.length;){if(n||(n=s.pop(),l=s[s.length-1],a=o.pop(),h=!0),n.leaf){const u=f_(t,n.children,e);if(u!==-1)return n.children.splice(u,1),s.push(n),this._condense(s),this}!h&&!n.leaf&&ra(n,r)?(s.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],h=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,r){const s=n-e+1;let o=this._maxEntries,a;if(s<=o)return a=tr(t.slice(e,n+1)),ji(a,this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),a=tr([]),a.leaf=!1,a.height=r;const l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));au(t,e,n,h,this.compareMinX);for(let u=e;u<=n;u+=h){const c=Math.min(u+h-1,n);au(t,u,c,l,this.compareMinY);for(let f=u;f<=c;f+=l){const g=Math.min(f+l-1,c);a.children.push(this._build(t,f,g,r-1))}}return ji(a,this.toBBox),a}_chooseSubtree(t,e,n,r){for(;r.push(e),!(e.leaf||r.length-1===n);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],u=ia(h),c=m_(t,h)-u;c<o?(o=c,s=u<s?u:s,a=h):c===o&&u<s&&(s=u,a=h)}e=a||e.children[0]}return e}_insert(t,e,n){const r=n?t:this.toBBox(t),s=[],o=this._chooseSubtree(r,this.data,e,s);for(o.children.push(t),Ar(o,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)}_split(t,e){const n=t[e],r=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,r);const o=this._chooseSplitIndex(n,s,r),a=tr(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,ji(n,this.toBBox),ji(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,e){this.data=tr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ji(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let r,s=1/0,o=1/0;for(let a=e;a<=n-e;a++){const l=Mr(t,0,a,this.toBBox),h=Mr(t,a,n,this.toBBox),u=__(l,h),c=ia(l)+ia(h);u<s?(s=u,r=a,o=c<o?c:o):u===s&&c<o&&(o=c,r=a)}return r||n-e}_chooseSplitAxis(t,e,n){const r=t.leaf?this.compareMinX:d_,s=t.leaf?this.compareMinY:g_,o=this._allDistMargin(t,e,n,r),a=this._allDistMargin(t,e,n,s);o<a&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const s=this.toBBox,o=Mr(t,0,e,s),a=Mr(t,n-e,n,s);let l=Fs(o)+Fs(a);for(let h=e;h<n-e;h++){const u=t.children[h];Ar(o,t.leaf?s(u):u),l+=Fs(o)}for(let h=n-e-1;h>=e;h--){const u=t.children[h];Ar(a,t.leaf?s(u):u),l+=Fs(a)}return l}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)Ar(e[r],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():ji(t[e],this.toBBox)}}function f_(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function ji(i,t){Mr(i,0,i.children.length,t,i)}function Mr(i,t,e,n,r){r||(r=tr(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<e;s++){const o=i.children[s];Ar(r,i.leaf?n(o):o)}return r}function Ar(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function d_(i,t){return i.minX-t.minX}function g_(i,t){return i.minY-t.minY}function ia(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Fs(i){return i.maxX-i.minX+(i.maxY-i.minY)}function m_(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function __(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),r=Math.min(i.maxX,t.maxX),s=Math.min(i.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,s-n)}function ra(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Ds(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function tr(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function au(i,t,e,n,r){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;u_(i,o,t,e,r),s.push(t,o,o,e)}}const p_=Object.freeze(Object.defineProperty({__proto__:null,default:Tl},Symbol.toStringTag,{value:"Module"})),Y={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function lu(i){return i[0]>0&&i[1]>0}function y_(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function Ie(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}class Ml{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Ie(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ml({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return nt()}getImage(t){return nt()}getHitDetectionImage(){return nt()}getPixelRatio(t){return 1}getImageState(){return nt()}getImageSize(){return nt()}getOrigin(){return nt()}getSize(){return nt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ie(t)}listenImageChange(t){nt()}load(){nt()}unlistenImageChange(t){nt()}ready(){return Promise.resolve()}}const Bc=Ml,Br={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Qt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Qt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Qt.max=Qt.whitepoint[2].D65;Qt.rgb=function(i,t){t=t||Qt.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Br.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,o=e*.21263900587151+n*.71516867876775+r*.072192315360733,a=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||Qt.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};const Al={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,o,a,l,h,u,c,f,g,_,m;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var y=.0011070564598794539;return t=t||"D65",e=e||2,c=Qt.whitepoint[e][t][0],f=Qt.whitepoint[e][t][1],g=Qt.whitepoint[e][t][2],_=4*c/(c+15*f+3*g),m=9*f/(c+15*f+3*g),n=o/(13*s)+_||0,r=a/(13*s)+m||0,h=s>8?f*Math.pow((s+16)/116,3):f*s*y,l=h*9*n/(4*r)||0,u=h*(12-3*n-20*r)/(4*r)||0,[l,h,u]}};Qt.luv=function(i,t,e){var n,r,s,o,a,l,h,u,c,f,g,_,m,y=.008856451679035631,x=903.2962962962961;t=t||"D65",e=e||2,c=Qt.whitepoint[e][t][0],f=Qt.whitepoint[e][t][1],g=Qt.whitepoint[e][t][2],_=4*c/(c+15*f+3*g),m=9*f/(c+15*f+3*g),l=i[0],h=i[1],u=i[2],n=4*l/(l+15*h+3*u)||0,r=9*h/(l+15*h+3*u)||0;var E=h/f;return s=E<=y?x*E:116*Math.pow(E,1/3)-16,o=13*s*(n-_),a=13*s*(r-m),[s,o,a]};var Yc={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],n=i[2],r,s,o;return o=n/360*2*Math.PI,r=e*Math.cos(o),s=e*Math.sin(o),[t,r,s]},xyz:function(i){return Al.xyz(Yc.luv(i))}};Al.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]};Qt.lchuv=function(i){return Al.lchuv(Qt.luv(i))};const hu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var uu={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function x_(i){var u,c;var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),hu[i])e=hu[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=t[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(f,g){if(f[f.length-1]==="%")return f=parseFloat(f)/100,g===3?f:r==="rgb"?f*255:r[0]==="h"||r[0]==="l"&&!g?f*100:r==="lab"?f*125:r==="lch"?g<2?f*150:f*360:r[0]==="o"&&!g?f:r==="oklab"?f*.4:r==="oklch"?g<2?f*.4:f*360:f;if(r[g]==="h"||g===2&&r[r.length-1]==="h"){if(uu[f]!==void 0)return uu[f];if(f.endsWith("deg"))return parseFloat(f);if(f.endsWith("turn"))return parseFloat(f)*360;if(f.endsWith("grad"))return parseFloat(f)*360/400;if(f.endsWith("rad"))return parseFloat(f)*180/Math.PI}return f==="none"?0:parseFloat(f)}),n=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(f){return parseFloat(f)}),r=((c=(u=i.match(/([a-z])/ig))==null?void 0:u.join(""))==null?void 0:c.toLowerCase())||"rgb");return{space:r,values:e,alpha:n}}const sa={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};Br.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),o=s-r,a,l,h;return s===r?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function E_(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=x_(i);if(!e.space)return[];const n=e.space[0]==="h"?sa.min:Br.min,r=e.space[0]==="h"?sa.max:Br.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=sa.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function v_(i){return typeof i=="string"?i:Pl(i)}const w_=1024,Rr={};let oa=0;function C_(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function cu(i){const t=Qt.lchuv(Br.xyz(i));return t[3]=i[3],t}function R_(i){const t=Qt.rgb(Yc.xyz(i));return t[3]=i[3],t}function Ll(i){if(Rr.hasOwnProperty(i))return Rr[i];if(oa>=w_){let e=0;for(const n in Rr)(e++&3)===0&&(delete Rr[n],--oa)}const t=E_(i);if(t.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+i+'" as color');return Zc(t),Rr[i]=t,++oa,t}function Yr(i){return Array.isArray(i)?i:Ll(i)}function Zc(i){return i[0]=Xt(i[0]+.5|0,0,255),i[1]=Xt(i[1]+.5|0,0,255),i[2]=Xt(i[2]+.5|0,0,255),i[3]=Xt(i[3],0,1),i}function Pl(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}function S_(i){try{return Ll(i),!0}catch{return!1}}const ci=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",I_=ci.includes("firefox"),b_=ci.includes("safari")&&!ci.includes("chrom");b_&&(ci.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ci));const T_=ci.includes("webkit")&&!ci.includes("edge"),Uc=ci.includes("macintosh"),$c=typeof devicePixelRatio<"u"?devicePixelRatio:1,Kc=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,jc=typeof Image<"u"&&Image.prototype.decode,Vc=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();function Bt(i,t,e,n){let r;return e&&e.length?r=e.shift():Kc?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}let aa;function Da(){return aa||(aa=Bt(1,1)),aa}function Lo(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function fu(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function ka(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function M_(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function A_(i,t){const e=i.childNodes;for(let n=0;;++n){const r=e[n],s=t[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}class L_ extends es{constructor(t,e,n,r){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof r=="function"?Y.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(et.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==Y.IDLE&&this.loader){this.state=Y.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;gc(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=Y.LOADED}).catch(n=>{this.state=Y.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function P_(i,t,e){const n=i;let r=!0,s=!1,o=!1;const a=[js(n,et.LOAD,function(){o=!0,s||t()})];return n.src&&jc?(s=!0,n.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(js(n,et.ERROR,e)),function(){r=!1,a.forEach(Rt)}}function O_(i,t){return new Promise((e,n)=>{function r(){o(),e(i)}function s(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s),t&&(i.src=t)})}function F_(i,t){return t&&(i.src=t),i.src&&jc?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(r=>i.complete&&i.width?e(i):n(r))):O_(i)}const Ol=L_;class D_{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=la(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=la(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,s){const o=la(t,e,n),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===Y.IDLE&&r.load(),r.getImageState()===Y.LOADING?r.ready().then(()=>{this.patternCache_[o]=Da().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=Da().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function la(i,t,e){const n=e?Yr(e):"null";return t+":"+i+":"+n}const fn=new D_;let Sr=null;class k_ extends es{constructor(t,e,n,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?Y.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Y.LOADED){Sr||(Sr=Bt(1,1,void 0,{willReadFrequently:!0})),Sr.drawImage(this.image_,0,0);try{Sr.getImageData(0,0,1,1),this.tainted_=!1}catch{Sr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(et.CHANGE)}handleImageError_(){this.imageState_=Y.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Y.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Bt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Y.IDLE){this.image_||this.initializeImage_(),this.imageState_=Y.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&F_(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Y.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const r=n.getContext("2d");r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=v_(this.color_),r.fillRect(0,0,n.width/t,n.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===Y.LOADED||this.imageState_===Y.ERROR?t():this.addEventListener(et.CHANGE,function e(){(this.imageState_===Y.LOADED||this.imageState_===Y.ERROR)&&(this.removeEventListener(et.CHANGE,e),t())})})),this.ready_}}function Fl(i,t,e,n,r,s){let o=t===void 0?void 0:fn.get(t,e,r);return o||(o=new k_(i,i instanceof HTMLImageElement?i.src||void 0:t,e,n,r),fn.set(t,e,r,o,s)),s&&o&&!fn.getPattern(t,e,r)&&fn.set(t,e,r,o,s),o}function dn(i){return i?Array.isArray(i)?Pl(i):typeof i=="object"&&"src"in i?N_(i):i:null}function N_(i){if(!i.offset||!i.size)return fn.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=fn.getPattern(t,void 0,i.color);if(e)return e;const n=fn.get(i.src,"anonymous",null);if(n.getImageState()!==Y.LOADED)return null;const r=Bt(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Fl(r.canvas,t,void 0,Y.LOADED,i.color,!0),fn.getPattern(t,void 0,i.color)}const ks="ol-hidden",Po="ol-unselectable",Dl="ol-control",du="ol-collapsed",G_=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),gu=["style","variant","weight","size","lineHeight","family"],qc=function(i){const t=i.match(G_);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,r=gu.length;n<r;++n){const s=t[n+1];s!==void 0&&(e[gu[n]]=s)}return e.families=e.family.split(/,\s?/),e},Hc="10px sans-serif",xe="#000",ur="round",Fn=[],Dn=0,cr="round",Zr=10,Ur="#000",$r="center",to="middle",Si=[0,0,0,0],Kr=1,In=new pn;let er=null,Na;const Ga={},z_=function(){const t="32px ",e=["monospace","serif"],n=e.length,r="wmytzilWMYTZIL@#/&?$%10\uF013";let s,o;function a(h,u,c){let f=!0;for(let g=0;g<n;++g){const _=e[g];if(o=eo(h+" "+u+" "+t+_,r),c!=_){const m=eo(h+" "+u+" "+t+c+","+_,r);f=f&&m!=o}}return!!f}function l(){let h=!0;const u=In.getKeys();for(let c=0,f=u.length;c<f;++c){const g=u[c];In.get(g)<100&&(a.apply(this,g.split(`
`))?(ts(Ga),er=null,Na=void 0,In.set(g,100)):(In.set(g,In.get(g)+1,!0),h=!1))}h&&(clearInterval(s),s=void 0)}return function(h){const u=qc(h);if(!u)return;const c=u.families;for(let f=0,g=c.length;f<g;++f){const _=c[f],m=u.style+`
`+u.weight+`
`+_;In.get(m)===void 0&&(In.set(m,100,!0),a(u.style,u.weight,_)||(In.set(m,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),X_=function(){let i;return function(t){let e=Ga[t];if(e==null){if(Kc){const n=qc(t),r=Jc(t,"\u017Dg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);Ga[t]=e}return e}}();function Jc(i,t){return er||(er=Bt(1,1)),i!=Na&&(er.font=i,Na=er.font),er.measureText(t)}function eo(i,t){return Jc(i,t).width}function mu(i,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((r,s)=>Math.max(r,eo(i,s)),0);return e[t]=n,n}function W_(i,t){const e=[],n=[],r=[];let s=0,o=0,a=0,l=0;for(let h=0,u=t.length;h<=u;h+=2){const c=t[h];if(c===`
`||h===u){s=Math.max(s,o),r.push(o),o=0,a+=l;continue}const f=t[h+1]||i.font,g=eo(f,c);e.push(g),o+=g;const _=X_(f);n.push(_),l=Math.max(l,_)}return{width:s,height:a,widths:e,heights:n,lineWidths:r}}function B_(i,t,e,n,r,s,o,a,l,h,u){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=c=>c.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),n.contextInstructions?(i.translate(l,h),i.scale(u[0],u[1]),Y_(n,i)):u[0]<0||u[1]<0?(i.translate(l,h),i.scale(u[0],u[1]),i.drawImage(n,r,s,o,a,0,0,o,a)):i.drawImage(n,r,s,o,a,l,h,o*u[0],a*u[1]),i.restore()}function Y_(i,t){const e=i.contextInstructions;for(let n=0,r=e.length;n<r;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class kl extends Bc{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Y.LOADING:Y.LOADED,this.imageState_===Y.LOADING&&this.ready().then(()=>this.imageState_=Y.LOADED),this.render()}clone(){const t=this.getScale(),e=new kl({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,r=Bt(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const I=r;r=s,s=I}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),u=r-h,c=Math.sqrt(l*l+u*u),f=c/l;if(t==="miter"&&f<=n)return f*e;const g=e/2/f,_=e/2*(u/c),y=Math.sqrt((r+g)*(r+g)+_*_)-r;if(this.radius2_===void 0||t==="bevel")return y*2;const x=r*Math.sin(a),E=Math.sqrt(r*r-x*x),v=s-E,w=Math.sqrt(x*x+v*v)/x;if(w<=n){const I=w*e/2-s-r;return 2*Math.max(y,I)}return y*2}createRenderOptions(){var c,f,g,_,m,y;let t=ur,e=cr,n=0,r=null,s=0,o,a=0;this.stroke_&&(o=dn((c=this.stroke_.getColor())!=null?c:Ur),a=(f=this.stroke_.getWidth())!=null?f:Kr,r=this.stroke_.getLineDash(),s=(g=this.stroke_.getLineDashOffset())!=null?g:0,e=(_=this.stroke_.getLineJoin())!=null?_:cr,t=(m=this.stroke_.getLineCap())!=null?m:ur,n=(y=this.stroke_.getMiterLimit())!=null?y:Zr);const l=this.calculateLineJoinSize_(e,a,n),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=xe),e.fillStyle=dn(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=Yr(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(e=Bt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?n:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=xe,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const Qc=kl;class Nl extends Qc{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Nl({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const tf=Nl;class Gl{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Gl({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Fl(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===Y.IDLE&&e.load(),e.getImageState()===Y.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const zl=Gl;class Xl{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Xl({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Wl=Xl;class Oo{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=_u,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){var e;let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Oo({geometry:t!=null?t:void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:(e=this.getRenderer())!=null?e:void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=_u,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Z_(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(mt(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let ha=null;function U_(i,t){if(!ha){const e=new zl({color:"rgba(255,255,255,0.4)"}),n=new Wl({color:"#3399CC",width:1.25});ha=[new Oo({image:new tf({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return ha}function _u(i){return i.getGeometry()}const or=Oo;function pu(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class Bl extends Bc{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;mt(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||pt(o)),mt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),mt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=Y.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?Y.LOADED:Y.IDLE:l=Y.LOADING:l=Y.LOADED),this.color_=t.color!==void 0?Yr(t.color):null,this.iconImage_=Fl(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,u;if(t.size)[h,u]=t.size;else{const c=this.getImage(1);if(c.width&&c.height)h=c.width,u=c.height;else if(c instanceof HTMLImageElement){this.initialOptions_=t;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(pu(g[0],g[1],t.width,t.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(pu(h,u,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Bl({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==Y.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==Y.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(et.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(et.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Yl=Bl,$_="#333";class Zl{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Ie(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new zl({color:$_}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Zl({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ie(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const K_=Zl;let _r=0;const pr=0,Lt=1<<_r++,K=1<<_r++,Se=1<<_r++,qt=1<<_r++,Gn=1<<_r++,ie=Math.pow(2,_r)-1,ef={[Lt]:"boolean",[K]:"number",[Se]:"string",[qt]:"color",[Gn]:"number[]"},j_=Object.keys(ef).map(Number).sort(On);function oe(i){const t=[];for(const e of j_)V_(i,e)&&t.push(ef[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function V_(i,t){return(i&t)===t}function mn(i,t){return!!(i&t)}function Fo(i,t){return i===t}class ii{constructor(t,e){this.type=t,this.value=e}}class q_{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function nf(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function H_(i){switch(i){case"string":return Se;case"color":return qt;case"number":return K;case"boolean":return Lt;case"number[]":return Gn;default:throw new Error(`Unrecognized type hint: ${i}`)}}function xt(i,t,e){switch(typeof i){case"boolean":return new ii(Lt,i);case"number":return new ii(K,i);case"string":{let r=Se;return S_(i)&&(r|=qt),Fo(r&e,pr)||(r&=e),new ii(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return hp(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=Gn;return(i.length===3||i.length===4)&&(n|=qt),e&&(n&=e),new ii(n,i)}const L={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},J_={[L.Get]:it(([i,t])=>t!==void 0?H_(t.value):ie,ht(1,2),Q_),[L.Var]:it(([i])=>i.type,ht(1,1),tp),[L.Id]:it(K|Se,Ir,ep),[L.Concat]:it(Se,ht(2,1/0),gt(ie)),[L.GeometryType]:it(Se,Ir,np),[L.Resolution]:it(K,Ir),[L.Zoom]:it(K,Ir),[L.Time]:it(K,Ir),[L.Any]:it(Lt,ht(2,1/0),gt(Lt)),[L.All]:it(Lt,ht(2,1/0),gt(Lt)),[L.Not]:it(Lt,ht(1,1),gt(Lt)),[L.Equal]:it(Lt,ht(2,2),gt(ie),$n),[L.NotEqual]:it(Lt,ht(2,2),gt(ie),$n),[L.GreaterThan]:it(Lt,ht(2,2),gt(ie),$n),[L.GreaterThanOrEqualTo]:it(Lt,ht(2,2),gt(ie),$n),[L.LessThan]:it(Lt,ht(2,2),gt(ie),$n),[L.LessThanOrEqualTo]:it(Lt,ht(2,2),gt(ie),$n),[L.Multiply]:it(i=>{let t=K|qt;for(let e=0;e<i.length;e++)t&=i[e].type;return t},ht(2,1/0),gt(K|qt),$n),[L.Coalesce]:it(i=>{let t=ie;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},ht(2,1/0),gt(ie),$n),[L.Divide]:it(K,ht(2,2),gt(K)),[L.Add]:it(K,ht(2,1/0),gt(K)),[L.Subtract]:it(K,ht(2,2),gt(K)),[L.Clamp]:it(K,ht(3,3),gt(K)),[L.Mod]:it(K,ht(2,2),gt(K)),[L.Pow]:it(K,ht(2,2),gt(K)),[L.Abs]:it(K,ht(1,1),gt(K)),[L.Floor]:it(K,ht(1,1),gt(K)),[L.Ceil]:it(K,ht(1,1),gt(K)),[L.Round]:it(K,ht(1,1),gt(K)),[L.Sin]:it(K,ht(1,1),gt(K)),[L.Cos]:it(K,ht(1,1),gt(K)),[L.Atan]:it(K,ht(1,2),gt(K)),[L.Sqrt]:it(K,ht(1,1),gt(K)),[L.Match]:it(i=>{let t=ie;for(let e=2;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},ht(4,1/0),yu,rp),[L.Between]:it(Lt,ht(3,3),gt(K)),[L.Interpolate]:it(i=>{let t=qt|K;for(let e=3;e<i.length;e+=2)t&=i[e].type;return t},ht(6,1/0),yu,sp),[L.Case]:it(i=>{let t=ie;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},ht(3,1/0),ip,op),[L.In]:it(Lt,ht(2,2),ap),[L.Number]:it(K,ht(1,1/0),gt(ie)),[L.String]:it(Se,ht(1,1/0),gt(ie)),[L.Array]:it(i=>i.length===3||i.length===4?Gn|qt:Gn,ht(1,1/0),gt(K)),[L.Color]:it(qt,ht(1,4),gt(K)),[L.Band]:it(K,ht(1,3),gt(K)),[L.Palette]:it(qt,ht(2,2),lp),[L.ToString]:it(Se,ht(1,1),gt(Lt|K|Se|qt))};function Q_(i,t){const e=xt(i[1],t);if(!(e instanceof ii))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),i.length===3){const n=xt(i[2],t);return[e,n]}return[e]}function tp(i,t,e,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new ii(ie,r)];const s=t.style.variables[r],o=xt(s,t);if(o.value=r,n&&!mn(n,o.type))throw new Error(`The variable ${r} has type ${oe(o.type)} but the following type was expected: ${oe(n)}`);return[o]}function ep(i,t){t.featureId=!0}function np(i,t){t.geometryType=!0}function Ir(i,t){const e=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function ht(i,t){return function(e,n){const r=e[0],s=e.length-1;if(i===t){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>t){const o=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function gt(i){return function(t,e){const n=t[0],r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=xt(t[o+1],e);if(!mn(i,a.type)){const l=oe(i),h=oe(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function $n(i,t,e){const n=i[0],r=i.length-1;let s=ie;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===pr)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=xt(i[a+1],t,s);return o}function ip(i,t){const e=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function yu(i,t){const e=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function rp(i,t,e,n){const r=i.length-1;let o=xt(i[1],t).type;const a=xt(i[i.length-1],t);let l=n!==void 0?n&a.type:a.type;const h=new Array(r-2);for(let c=0;c<r-2;c+=2){const f=xt(i[c+2],t),g=xt(i[c+3],t);o&=f.type,l&=g.type,h[c]=f,h[c+1]=g}const u=Se|K|Lt;if(!mn(u,o))throw new Error(`Expected an input of type ${oe(u)} for the interpolate operation, got ${oe(o)} instead`);if(Fo(l,pr))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let c=0;c<r-2;c+=2){const f=xt(i[c+2],t,o),g=xt(i[c+3],t,l);h[c]=f,h[c+1]=g}return[xt(i[1],t,o),...h,xt(i[i.length-1],t,l)]}function sp(i,t,e,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=xt(s,t);let o=xt(i[2],t);if(!mn(K,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${oe(o.type)} instead`);o=xt(i[2],t,K);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=xt(i[l+3],t);if(!mn(K,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${oe(h.type)} at position ${l+2} instead`);let u=xt(i[l+4],t);if(!mn(K|qt,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${oe(u.type)} at position ${l+3} instead`);h=xt(i[l+3],t,K),u=xt(i[l+4],t,K|qt),a[l]=h,a[l+1]=u}return[s,o,...a]}function op(i,t,e,n){const r=xt(i[i.length-1],t);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=xt(i[a+1],t),h=xt(i[a+2],t);if(!mn(Lt,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${oe(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(Fo(s,pr))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=xt(i[a+2],t,s);return o[o.length-1]=xt(i[i.length-1],t,s),o}function ap(i,t){let e=i[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=Se|K;const r=new Array(e.length);for(let o=0;o<r.length;o++){const a=xt(e[o],t);n&=a.type,r[o]=a}if(Fo(n,pr))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[xt(i[1],t,n),...r]}function lp(i,t){const e=xt(i[1],t,K);if(e.type!==K)throw new Error(`The first argument of palette must be an number, got ${oe(e.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=xt(n[s],t,qt);if(!(o instanceof ii))throw new Error(`The palette color at index ${s} must be a literal value`);if(!mn(o.type,qt))throw new Error(`The palette color at index ${s} should be of type color, got ${oe(o.type)} instead`);r[s]=o}return[e,...r]}function it(i,...t){return function(e,n,r){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!mn(a,r))throw new Error(`The following expression was expected to return ${oe(r)}, but returns ${oe(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===pr)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new q_(a,s,...o)}}function hp(i,t,e){const n=i[0],r=J_[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,t,e)}function rf(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return rf(i.getGeometries()[0]);default:return""}}function sf(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function zn(i,t,e){const n=xt(i,e);if(!mn(t,n.type)){const r=oe(t),s=oe(n.type);throw new Error(`Expected expression to be of type ${r}, got ${s}`)}return He(n)}function He(i,t){if(i instanceof ii){if(i.type===qt&&typeof i.value=="string"){const n=Ll(i.value);return function(){return n}}return function(){return i.value}}const e=i.operator;switch(e){case L.Number:case L.String:case L.Coalesce:return up(i);case L.Get:case L.Var:return cp(i);case L.Id:return n=>n.featureId;case L.GeometryType:return n=>n.geometryType;case L.Concat:{const n=i.args.map(r=>He(r));return r=>"".concat(...n.map(s=>s(r).toString()))}case L.Resolution:return n=>n.resolution;case L.Any:case L.All:case L.Between:case L.In:case L.Not:return dp(i);case L.Equal:case L.NotEqual:case L.LessThan:case L.LessThanOrEqualTo:case L.GreaterThan:case L.GreaterThanOrEqualTo:return fp(i);case L.Multiply:case L.Divide:case L.Add:case L.Subtract:case L.Clamp:case L.Mod:case L.Pow:case L.Abs:case L.Floor:case L.Ceil:case L.Round:case L.Sin:case L.Cos:case L.Atan:case L.Sqrt:return gp(i);case L.Case:return mp(i);case L.Match:return _p(i);case L.Interpolate:return pp(i);case L.ToString:return yp(i);default:throw new Error(`Unsupported operator ${e}`)}}function up(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=He(i.args[s]);switch(e){case L.Coalesce:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case L.Number:case L.String:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function cp(i,t){const n=i.args[0].value;switch(i.operator){case L.Get:return r=>r.properties[n];case L.Var:return r=>r.variables[n];default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function fp(i,t){const e=i.operator,n=He(i.args[0]),r=He(i.args[1]);switch(e){case L.Equal:return s=>n(s)===r(s);case L.NotEqual:return s=>n(s)!==r(s);case L.LessThan:return s=>n(s)<r(s);case L.LessThanOrEqualTo:return s=>n(s)<=r(s);case L.GreaterThan:return s=>n(s)>r(s);case L.GreaterThanOrEqualTo:return s=>n(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function dp(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=He(i.args[s]);switch(e){case L.Any:return s=>{for(let o=0;o<n;++o)if(r[o](s))return!0;return!1};case L.All:return s=>{for(let o=0;o<n;++o)if(!r[o](s))return!1;return!0};case L.Between:return s=>{const o=r[0](s),a=r[1](s),l=r[2](s);return o>=a&&o<=l};case L.In:return s=>{const o=r[0](s);for(let a=1;a<n;++a)if(o===r[a](s))return!0;return!1};case L.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function gp(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=He(i.args[s]);switch(e){case L.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=r[a](s);return o};case L.Divide:return s=>r[0](s)/r[1](s);case L.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=r[a](s);return o};case L.Subtract:return s=>r[0](s)-r[1](s);case L.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case L.Mod:return s=>r[0](s)%r[1](s);case L.Pow:return s=>Math.pow(r[0](s),r[1](s));case L.Abs:return s=>Math.abs(r[0](s));case L.Floor:return s=>Math.floor(r[0](s));case L.Ceil:return s=>Math.ceil(r[0](s));case L.Round:return s=>Math.round(r[0](s));case L.Sin:return s=>Math.sin(r[0](s));case L.Cos:return s=>Math.cos(r[0](s));case L.Atan:return n===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case L.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function mp(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=He(i.args[r]);return r=>{for(let s=0;s<e-1;s+=2)if(n[s](r))return n[s+1](r);return n[e-1](r)}}function _p(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=He(i.args[r]);return r=>{const s=n[0](r);for(let o=1;o<e;o+=2)if(s===n[o](r))return n[o+1](r);return n[e-1](r)}}function pp(i,t){const e=i.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=He(i.args[r]);return r=>{const s=n[0](r),o=n[1](r);let a,l;for(let h=2;h<e;h+=2){const u=n[h](r);let c=n[h+1](r);const f=Array.isArray(c);if(f&&(c=C_(c)),u>=o)return h===2?c:f?xp(s,o,a,l,u,c):Lr(s,o,a,l,u,c);a=u,l=c}return l}}function yp(i,t){const e=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=He(i.args[s]);switch(e){case L.ToString:return s=>{const o=r[0](s);return i.args[0].type===qt?Pl(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Lr(i,t,e,n,r,s){const o=r-e;if(o===0)return n;const a=t-e,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(s-n)}function xp(i,t,e,n,r,s){if(r-e===0)return n;const a=cu(n),l=cu(s);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const u=[Lr(i,t,e,a[0],r,l[0]),Lr(i,t,e,a[1],r,l[1]),a[2]+Lr(i,t,e,0,r,h),Lr(i,t,e,n[3],r,s[3])];return Zc(R_(u))}function Ep(i){return!0}function vp(i){const t=nf(),e=wp(i,t),n=sf();return function(r,s){if(n.properties=r.getPropertiesInternal(),n.resolution=s,t.featureId){const o=r.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=rf(r.getGeometry())),e(n)}}function xu(i){const t=nf(),e=i.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=za(i[o],t);const r=sf(),s=new Array(e);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,t.featureId){const h=o.getId();h!==void 0?r.featureId=h:r.featureId=null}let l=0;for(let h=0;h<e;++h){const u=n[h](r);u&&(s[l]=u,l+=1)}return s.length=l,s}}function wp(i,t){const e=i.length,n=new Array(e);for(let r=0;r<e;++r){const s=i[r],o="filter"in s?zn(s.filter,Lt,t):Ep;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=za(s.style[h],t)}else a=[za(s.style,t)];n[r]={filter:o,styles:a}}return function(r){const s=[];let o=!1;for(let a=0;a<e;++a){const l=n[a].filter;if(!!l(r)&&!(i[a].else&&o)){o=!0;for(const h of n[a].styles){const u=h(r);!u||s.push(u)}}}return s}}function za(i,t){const e=jr(i,"",t),n=Vr(i,"",t),r=Cp(i,t),s=Rp(i,t),o=ve(i,"z-index",t);if(!e&&!n&&!r&&!s&&!Oi(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new or;return function(l){let h=!0;if(e){const u=e(l);u&&(h=!1),a.setFill(u)}if(n){const u=n(l);u&&(h=!1),a.setStroke(u)}if(r){const u=r(l);u&&(h=!1),a.setText(u)}if(s){const u=s(l);u&&(h=!1),a.setImage(u)}return o&&a.setZIndex(o(l)),h?null:a}}function jr(i,t,e){let n;if(t+"fill-pattern-src"in i?n=Tp(i,t+"fill-",e):n=Ul(i,t+"fill-color",e),!n)return null;const r=new zl;return function(s){const o=n(s);return o==="none"?null:(r.setColor(o),r)}}function Vr(i,t,e){const n=ve(i,t+"stroke-width",e),r=Ul(i,t+"stroke-color",e);if(!n&&!r)return null;const s=Tn(i,t+"stroke-line-cap",e),o=Tn(i,t+"stroke-line-join",e),a=of(i,t+"stroke-line-dash",e),l=ve(i,t+"stroke-line-dash-offset",e),h=ve(i,t+"stroke-miter-limit",e),u=new Wl;return function(c){if(r){const f=r(c);if(f==="none")return null;u.setColor(f)}if(n&&u.setWidth(n(c)),s){const f=s(c);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(f)}if(o){const f=o(c);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(f)}return a&&u.setLineDash(a(c)),l&&u.setLineDashOffset(l(c)),h&&u.setMiterLimit(h(c)),u}}function Cp(i,t){const e="text-",n=Tn(i,e+"value",t);if(!n)return null;const r=jr(i,e,t),s=jr(i,e+"background-",t),o=Vr(i,e,t),a=Vr(i,e+"background-",t),l=Tn(i,e+"font",t),h=ve(i,e+"max-angle",t),u=ve(i,e+"offset-x",t),c=ve(i,e+"offset-y",t),f=qr(i,e+"overflow",t),g=Tn(i,e+"placement",t),_=ve(i,e+"repeat",t),m=Do(i,e+"scale",t),y=qr(i,e+"rotate-with-view",t),x=ve(i,e+"rotation",t),E=Tn(i,e+"align",t),v=Tn(i,e+"justify",t),R=Tn(i,e+"baseline",t),w=of(i,e+"padding",t),I=ko(i,e+"declutter-mode"),b=new K_({declutterMode:I});return function(S){if(b.setText(n(S)),r&&b.setFill(r(S)),s&&b.setBackgroundFill(s(S)),o&&b.setStroke(o(S)),a&&b.setBackgroundStroke(a(S)),l&&b.setFont(l(S)),h&&b.setMaxAngle(h(S)),u&&b.setOffsetX(u(S)),c&&b.setOffsetY(c(S)),f&&b.setOverflow(f(S)),g){const T=g(S);if(T!=="point"&&T!=="line")throw new Error("Expected point or line for text-placement");b.setPlacement(T)}if(_&&b.setRepeat(_(S)),m&&b.setScale(m(S)),y&&b.setRotateWithView(y(S)),x&&b.setRotation(x(S)),E){const T=E(S);if(T!=="left"&&T!=="center"&&T!=="right"&&T!=="end"&&T!=="start")throw new Error("Expected left, right, center, start, or end for text-align");b.setTextAlign(T)}if(v){const T=v(S);if(T!=="left"&&T!=="right"&&T!=="center")throw new Error("Expected left, right, or center for text-justify");b.setJustify(T)}if(R){const T=R(S);if(T!=="bottom"&&T!=="top"&&T!=="middle"&&T!=="alphabetic"&&T!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");b.setTextBaseline(T)}return w&&b.setPadding(w(S)),b}}function Rp(i,t){return"icon-src"in i?Sp(i,t):"shape-points"in i?Ip(i,t):"circle-radius"in i?bp(i,t):null}function Sp(i,t){const e="icon-",n=e+"src",r=af(i[n],n),s=no(i,e+"anchor",t),o=Do(i,e+"scale",t),a=ve(i,e+"opacity",t),l=no(i,e+"displacement",t),h=ve(i,e+"rotation",t),u=qr(i,e+"rotate-with-view",t),c=vu(i,e+"anchor-origin"),f=wu(i,e+"anchor-x-units"),g=wu(i,e+"anchor-y-units"),_=Pp(i,e+"color"),m=Ap(i,e+"cross-origin"),y=Lp(i,e+"offset"),x=vu(i,e+"offset-origin"),E=io(i,e+"width"),v=io(i,e+"height"),R=Mp(i,e+"size"),w=ko(i,e+"declutter-mode"),I=new Yl({src:r,anchorOrigin:c,anchorXUnits:f,anchorYUnits:g,color:_,crossOrigin:m,offset:y,offsetOrigin:x,height:v,width:E,size:R,declutterMode:w});return function(b){return a&&I.setOpacity(a(b)),l&&I.setDisplacement(l(b)),h&&I.setRotation(h(b)),u&&I.setRotateWithView(u(b)),o&&I.setScale(o(b)),s&&I.setAnchor(s(b)),I}}function Ip(i,t){const e="shape-",n=e+"points",r=e+"radius",s=Xa(i[n],n),o=Xa(i[r],r),a=jr(i,e,t),l=Vr(i,e,t),h=Do(i,e+"scale",t),u=no(i,e+"displacement",t),c=ve(i,e+"rotation",t),f=qr(i,e+"rotate-with-view",t),g=io(i,e+"radius2"),_=io(i,e+"angle"),m=ko(i,e+"declutter-mode"),y=new Qc({points:s,radius:o,radius2:g,angle:_,declutterMode:m});return function(x){return a&&y.setFill(a(x)),l&&y.setStroke(l(x)),u&&y.setDisplacement(u(x)),c&&y.setRotation(c(x)),f&&y.setRotateWithView(f(x)),h&&y.setScale(h(x)),y}}function bp(i,t){const e="circle-",n=jr(i,e,t),r=Vr(i,e,t),s=ve(i,e+"radius",t),o=Do(i,e+"scale",t),a=no(i,e+"displacement",t),l=ve(i,e+"rotation",t),h=qr(i,e+"rotate-with-view",t),u=ko(i,e+"declutter-mode"),c=new tf({radius:5,declutterMode:u});return function(f){return s&&c.setRadius(s(f)),n&&c.setFill(n(f)),r&&c.setStroke(r(f)),a&&c.setDisplacement(a(f)),l&&c.setRotation(l(f)),h&&c.setRotateWithView(h(f)),o&&c.setScale(o(f)),c}}function ve(i,t,e){if(!(t in i))return;const n=zn(i[t],K,e);return function(r){return Xa(n(r),t)}}function Tn(i,t,e){if(!(t in i))return null;const n=zn(i[t],Se,e);return function(r){return af(n(r),t)}}function Tp(i,t,e){const n=Tn(i,t+"pattern-src",e),r=Eu(i,t+"pattern-offset",e),s=Eu(i,t+"pattern-size",e),o=Ul(i,t+"color",e);return function(a){return{src:n(a),offset:r&&r(a),size:s&&s(a),color:o&&o(a)}}}function qr(i,t,e){if(!(t in i))return null;const n=zn(i[t],Lt,e);return function(r){const s=n(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function Ul(i,t,e){if(!(t in i))return null;const n=zn(i[t],qt|Se,e);return function(r){return lf(n(r),t)}}function of(i,t,e){if(!(t in i))return null;const n=zn(i[t],Gn,e);return function(r){return os(n(r),t)}}function no(i,t,e){if(!(t in i))return null;const n=zn(i[t],Gn,e);return function(r){const s=os(n(r),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function Eu(i,t,e){if(!(t in i))return null;const n=zn(i[t],Gn,e);return function(r){return hf(n(r),t)}}function Do(i,t,e){if(!(t in i))return null;const n=zn(i[t],Gn|K,e);return function(r){return Op(n(r),t)}}function io(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Mp(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return Ie(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Ap(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function vu(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function wu(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Lp(i,t){const e=i[t];if(e!==void 0)return os(e,t)}function ko(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Pp(i,t){const e=i[t];if(e!==void 0)return lf(e,t)}function os(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let n=0;n<e;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function af(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function Xa(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function lf(i,t){if(typeof i=="string")return i;const e=os(i,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function hf(i,t){const e=os(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Op(i,t){return typeof i=="number"?i:hf(i,t)}const Cu={RENDER_ORDER:"renderOrder"};class Fp extends ss{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Cu.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Tl(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(Cu.RENDER_ORDER,t)}setStyle(t){this.style_=Dp(t),this.styleFunction_=t===null?void 0:Z_(this.style_),this.changed()}}function Dp(i){if(i===void 0)return U_;if(!i)return null;if(typeof i=="function"||i instanceof or)return i;if(!Array.isArray(i))return xu([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof or){const r=new Array(t);for(let s=0;s<t;++s){const o=i[s];if(!(o instanceof or))throw new Error("Expected a list of style instances");r[s]=o}return r}if("style"in e){const r=new Array(t);for(let s=0;s<t;++s){const o=i[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");r[s]=o}return vp(r)}return xu(i)}const uf=Fp;class kp extends xo{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){nt()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;Xe(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),bo(r,n)}forEachFeatureAtCoordinate(t,e,n,r,s,o,a,l){let h;const u=e.viewState;function c(R,w,I,b){return s.call(o,w,R?I:null,b)}const f=u.projection,g=Rc(t.slice(),f),_=[[0,0]];if(f.canWrapX()&&r){const R=f.getExtent(),w=ft(R);_.push([-w,0],[w,0])}const m=e.layerStatesArray,y=m.length,x=[],E=[];for(let R=0;R<_.length;R++)for(let w=y-1;w>=0;--w){const I=m[w],b=I.layer;if(b.hasRenderer()&&bl(I,u)&&a.call(l,b)){const S=b.getRenderer(),T=b.getSource();if(S&&T){const O=T.getWrapX()?g:t,P=c.bind(null,I.managed);E[0]=O[0]+_[R][0],E[1]=O[1]+_[R][1],h=S.forEachFeatureAtCoordinate(E,e,n,P,x)}if(h)return h}}if(x.length===0)return;const v=1/x.length;return x.forEach((R,w)=>R.distanceSq+=w*v),x.sort((R,w)=>R.distanceSq-w.distanceSq),x.some(R=>h=R.callback(R.feature,R.layer,R.geometry)),h}hasFeatureAtCoordinate(t,e,n,r,s,o){return this.forEachFeatureAtCoordinate(t,e,n,r,Fr,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){nt()}scheduleExpireIconCache(t){fn.canExpireCache()&&t.postRenderFunctions.push(Np)}}function Np(i,t){fn.expire()}const Gp=kp;class zp extends Je{constructor(t,e,n,r){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=r}}const cf=zp;class Xp extends Gp{constructor(t){super(t),this.fontChangeListenerKey_=dt(In,lr.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Po+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const r=new cf(t,void 0,e);n.dispatchEvent(r)}}disposeInternal(){Rt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Fe.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});e.some(a=>a.layer instanceof uf&&a.layer.getDeclutter())&&(t.declutter={});const r=t.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=e.length;a<l;++a){const h=e[a];t.layerIndex=a;const u=h.layer,c=u.getSourceState();if(!bl(h,r)||c!="ready"&&c!="undefined"){u.unrender();continue}const f=u.render(t,o);!f||(f!==o&&(this.children_.push(f),o=f),s.push(h))}this.declutter(t,s),A_(this.element_,this.children_),this.dispatchRenderEvent(Fe.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){for(let n=e.length-1;n>=0;--n){const r=e[n],s=r.layer;s.getDeclutter()&&s.renderDeclutter(t,r)}e.forEach(n=>n.layer.renderDeferred(t))}}const Wp=Xp;class Qn extends Je{constructor(t,e){super(t),this.layer=e}}const ua={LAYERS:"layers"};class $l extends _c{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ua.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new cn(n.slice(),{unique:!0}):mt(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new cn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Rt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(dt(t,ye.ADD,this.handleLayersAdd_,this),dt(t,ye.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Rt);ts(this.listenerKeys_);const e=t.getArray();for(let n=0,r=e.length;n<r;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new Qn("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[dt(t,lr.PROPERTYCHANGE,this.handleLayerChange_,this),dt(t,et.CHANGE,this.handleLayerChange_,this)];t instanceof $l&&e.push(dt(t,"addlayer",this.handleLayerGroupAdd_,this),dt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[pt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Qn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Qn("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Qn("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=pt(e);this.listenerKeys_[n].forEach(Rt),delete this.listenerKeys_[n],this.dispatchEvent(new Qn("removelayer",e)),this.changed()}getLayers(){return this.get(ua.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new Qn("removelayer",n[r]))}this.set(ua.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Ai(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const No=$l;class Bp extends Je{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}const nr=Bp;class Yp extends nr{constructor(t,e,n,r,s,o){super(t,e,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Hn=Yp,Pt={SINGLECLICK:"singleclick",CLICK:et.CLICK,DBLCLICK:et.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Wa={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Zp extends es{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=dt(n,Wa.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=dt(n,Wa.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(et.TOUCHMOVE,this.boundHandleTouchMove_,Vc?{passive:!1}:!1)}emulateClick_(t){let e=new Hn(Pt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Hn(Pt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Hn(Pt.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==Pt.POINTERUP||e.type==Pt.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==Pt.POINTERDOWN||e.type==Pt.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Hn(Pt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Rt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Hn(Pt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(dt(n,Pt.POINTERMOVE,this.handlePointerMove_,this),dt(n,Pt.POINTERUP,this.handlePointerUp_,this),dt(this.element_,Pt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(dt(this.element_.getRootNode(),Pt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Hn(Pt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Hn(Pt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Rt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(et.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Rt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Rt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Up=Zp,Jn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},se={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ro=1/0;class $p{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ts(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(t){mt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=ro?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,r=e.length,s=e[t],o=n[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<r&&n[h]<n[l]?h:l;e[t]=e[u],n[t]=n[u],t=u}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,r=this.priorities_,s=n[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(r[a]>o)n[e]=n[a],r[e]=r[a],e=a;else break}n[e]=s,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let r=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==ro?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,e[r++]=o);e.length=r,n.length=r,this.heapify_()}}const Kp=$p,q={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class jp extends Kp{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(et.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===q.LOADED||n===q.ERROR||n===q.EMPTY){n!==q.ERROR&&e.removeEventListener(et.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,r,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===q.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}const ff=jp;function Vp(i,t,e,n,r){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return ro;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class qp extends pn{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){ka(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&ka(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)Rt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==hr&&this.listenerKeys.push(dt(t,Jn.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const Kl=qp;class Hp extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(et.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+Po+" "+Dl+(this.collapsed_&&this.collapsible_?" "+du:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(r=>gc(()=>r))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!di(e,this.renderedAttributions_)){M_(this.ulElement_);for(let r=0,s=e.length;r<s;++r){const o=document.createElement("li");o.innerHTML=e[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(du),this.collapsed_?fu(this.collapseLabel_,this.label_):fu(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const Jp=Hp;class Qp extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"\u21E7",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(et.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+Po+" "+Dl,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ks)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:mr}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(ks);!s&&n===0?this.element.classList.add(ks):s&&n!==0&&this.element.classList.remove(ks)}this.label_.style.transform=r}this.rotation_=n}}const ty=Qp;class ey extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(et.CLICK,this.handleClick_.bind(this,n),!1);const c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=h,c.appendChild(typeof a=="string"?document.createTextNode(a):a),c.addEventListener(et.CLICK,this.handleClick_.bind(this,-n),!1);const f=e+" "+Po+" "+Dl,g=this.element;g.className=f,g.appendChild(u),g.appendChild(c),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const r=n.getZoom();if(r!==void 0){const s=n.getConstrainedZoom(r+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:mr})):n.setZoom(s)}}}const ny=ey;function iy(i){i=i||{};const t=new cn;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new ny(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new ty(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new Jp(i.attributionOptions)),t}const Ru={ACTIVE:"active"};class ry extends pn{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ru.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Ru.ACTIVE,t)}setMap(t){this.map_=t}}function sy(i,t,e){const n=i.getCenterInternal();if(n){const r=[n[0]+t[0],n[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:Gm,center:i.getConstrainedCenter(r)})}}function jl(i,t,e,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+t),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:n!==void 0?n:250,easing:mr})}const as=ry;class oy extends as{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Pt.DBLCLICK){const n=t.originalEvent,r=t.map,s=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();jl(a,o,s,this.duration_),n.preventDefault(),e=!0}return!e}}const ay=oy;class ly extends as{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Pt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Pt.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Pt.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==Pt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Vl(i){const t=i.length;let e=0,n=0;for(let r=0;r<t;r++)e+=i[r].clientX,n+=i[r].clientY;return{clientX:e/t,clientY:n/t}}const ls=ly;function Ba(i){const t=arguments;return function(e){let n=!0;for(let r=0,s=t.length;r<s&&(n=n&&t[r](e),!!n);++r);return n}}const hy=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},uy=function(i){const t=i.map.getTargetElement(),e=i.map.getOwnerDocument().activeElement;return t.contains(e)},df=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?uy(i):!0},cy=Fr,gf=function(i){const t=i.originalEvent;return t.button==0&&!(T_&&Uc&&t.ctrlKey)},mf=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},fy=function(i){const t=i.originalEvent;return Uc?t.metaKey:t.ctrlKey},dy=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},_f=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},ca=function(i){const t=i.originalEvent;return mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},gy=function(i){const t=i.originalEvent;return mt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class my extends ls{constructor(t){super({stopDown:vo}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Ba(mf,gy);this.condition_=t.onFocusOnly?Ba(df,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,r=e.getEventPixel(Vl(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=t.map.getView();vm(s,a.getResolution()),hl(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:mr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const _y=my;class py extends ls{constructor(t){t=t||{},super({stopDown:vo}),this.condition_=t.condition?t.condition:hy,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!ca(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===ml)return;const r=e.getSize(),s=t.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return ca(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return ca(t)&&gf(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const yy=py;class xy extends xo{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+n,r.top=Math.min(t[1],e[1])+n,r.width=Math.abs(e[0]-t[0])+n,r.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Wr([r])}getGeometry(){return this.geometry_}}const Ey=xy,Ns={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class fa extends Je{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class vy extends ls{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Ey(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:gf,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const r=n[0]-e[0],s=n[1]-e[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new fa(Ns.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new fa(e?Ns.BOXEND:Ns.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new fa(Ns.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}const wy=vy;class Cy extends wy{constructor(t){t=t||{};const e=t.condition?t.condition:dy;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(r),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;r=r.clone(),r.scale(a*a)}n.fitInternal(r,{duration:this.duration_,easing:mr})}}const Ry=Cy,Ei={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Sy extends as{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return mf(e)&&_f(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==et.KEYDOWN){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==Ei.DOWN||r==Ei.LEFT||r==Ei.RIGHT||r==Ei.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;r==Ei.DOWN?h=-a:r==Ei.LEFT?l=-a:r==Ei.RIGHT?l=a:h=a;const u=[l,h];hl(u,o.getRotation()),sy(o,u,this.duration_),n.preventDefault(),e=!0}}return!e}}const Iy=Sy;class by extends as{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!fy(e)&&_f(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==et.KEYDOWN||t.type==et.KEYPRESS){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==="+"||r==="-")){const s=t.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();jl(a,o,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}const Ty=by;class My{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const r=this.points_[e+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[e]-this.points_[n],o=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Ay=My;class Ly extends as{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:cy;this.condition_=t.onFocusOnly?Ba(df,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==et.WHEEL)return!0;const n=t.map,r=t.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let s;if(t.type==et.WHEEL&&(s=r.deltaY,I_&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=$c),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-Xt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),jl(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const Py=Ly;class Oy extends ls{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=vo),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;const o=t.map,a=o.getView();a.getConstraints().rotation!==ml&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Vl(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const Fy=Oy;class Dy extends ls{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=vo),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Vl(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const ky=Dy;function Ny(i){i=i||{};const t=new cn,e=new Ay(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new yy),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new ay({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new _y({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new Fy),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new ky({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new Iy),t.push(new Ty({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new Py({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new Ry({duration:i.zoomDuration})),t}function pf(i){if(i instanceof ss){i.setMapInternal(null);return}i instanceof No&&i.getLayers().forEach(pf)}function yf(i,t){if(i instanceof ss){i.setMapInternal(t);return}if(i instanceof No){const e=i.getLayers().getArray();for(let n=0,r=e.length;n<r;++n)yf(e[n],t)}}class Gy extends pn{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=zy(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:$c,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Me(),this.pixelToCoordinateTransform_=Me(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||iy(),this.interactions=e.interactions||Ny({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ff(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(se.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(se.VIEW,this.handleViewChanged_),this.addChangeListener(se.SIZE,this.handleSizeChanged_),this.addChangeListener(se.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof hn)&&t.view.then(function(r){n.setView(new hn(r))}),this.controls.addEventListener(ye.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(ye.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(ye.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(ye.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(ye.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(ye.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){yf(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:Fr,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(r){n.push(r)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(r){r instanceof No?e(r.getLayers()):t.push(r)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const r=e.layerFilter!==void 0?e.layerFilter:Fr,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,r,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=n.width/r[0],o=n.height/r[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/s,(a.clientY-n.top)/o]}getTarget(){return this.get(se.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Pa(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Zt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(se.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof cn){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Sn(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Zt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(se.SIZE)}getView(){return this.get(se.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,r){return Vp(this.frameState_,t,e,n,r)}handleBrowserEvent(t,e){e=e||t.type;const n=new Hn(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===Wa.POINTERDOWN||n===et.WHEEL||n===et.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===r?r.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,s=r;if(t){const o=t.viewHints;if(o[Vt.ANIMATING]||o[Vt.INTERACTING]){const a=Date.now()-t.time>8;r=a?0:8,s=a?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(Fe.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Fe.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new nr(Jn.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new nr(Jn.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let r=0,s=n.length;r<s;++r)n[r](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,r=this.targetChangeHandlerKeys_.length;n<r;++n)Rt(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(et.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(et.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ka(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Wp(this)),this.mapBrowserEventHandler_=new Up(this,this.moveTolerance_);for(const s in Pt)this.mapBrowserEventHandler_.addEventListener(Pt[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(et.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(et.WHEEL,this.boundHandleBrowserEvent_,Vc?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[dt(n,et.KEYDOWN,this.handleBrowserEvent,this),dt(n,et.KEYPRESS,this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Rt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Rt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=dt(t,lr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=dt(t,et.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Rt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Qn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[dt(t,lr.PROPERTYCHANGE,this.render,this),dt(t,et.CHANGE,this.render,this),dt(t,"addlayer",this.handleLayerAdd_,this),dt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){pf(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),r=this.frameState_;let s=null;if(e!==void 0&&lu(e)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:qs(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:pt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=qs(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!gr(this.previousExtent_)&&!ui(s.extent,this.previousExtent_))&&(this.dispatchEvent(new nr(Jn.MOVESTART,this,r)),this.previousExtent_=is(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Vt.ANIMATING]&&!s.viewHints[Vt.INTERACTING]&&!ui(s.extent,this.previousExtent_)&&(this.dispatchEvent(new nr(Jn.MOVEEND,this,s)),yc(s.extent,this.previousExtent_))),this.dispatchEvent(new nr(Jn.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Jn.LOADSTART)||this.hasListener(Jn.LOADEND)||this.hasListener(Fe.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Qn("removelayer",e)),this.set(se.LAYERGROUP,t)}setSize(t){this.set(se.SIZE,t)}setTarget(t){this.set(se.TARGET,t)}setView(t){if(!t||t instanceof hn){this.set(se.VIEW,t);return}this.set(se.VIEW,new hn);const e=this;t.then(function(n){e.setView(new hn(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),s=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(e=[s,o],!lu(e)&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Ic("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!di(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function zy(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new No({layers:i.layers});e[se.LAYERGROUP]=n,e[se.TARGET]=i.target,e[se.VIEW]=i.view instanceof hn?i.view:new hn;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new cn(i.controls.slice()):(mt(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new cn(i.interactions.slice()):(mt(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new cn(i.overlays.slice()):(mt(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new cn,{controls:r,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}const Xy=Gy;class ql extends pn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new ql(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Rt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=dt(t,et.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Wy(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Wy(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(mt(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}const yr=ql;function so(i,t,e,n,r,s,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=r;else if(h!==0){let u=i[t],c=i[t+1],f=0;const g=[0];for(let y=t+n;y<e;y+=n){const x=i[y],E=i[y+1];f+=Math.sqrt((x-u)*(x-u)+(E-c)*(E-c)),g.push(f),u=x,c=E}const _=r*f,m=Kg(g,_);m<0?(l=(_-g[-m-2])/(g[-m-1]-g[-m-2]),a=t+(-m-2)*n):a=t+m*n}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?i[a+u]:Re(i[a+u],i[a+n+u],l);return s}function Ya(i,t,e,n,r,s){if(e==t)return null;let o;if(r<i[t+n-1])return s?(o=i.slice(t,t+n),o[n-1]=r,o):null;if(i[e-1]<r)return s?(o=i.slice(e-n,e),o[n-1]=r,o):null;if(r==i[t+n-1])return i.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const f=a+l>>1;r<i[(f+1)*n-1]?l=f:a=f+1}const h=i[a*n-1];if(r==h)return i.slice((a-1)*n,(a-1)*n+n);const u=i[(a+1)*n-1],c=(r-h)/(u-h);o=[];for(let f=0;f<n-1;++f)o.push(Re(i[(a-1)*n+f],i[a*n+f],c));return o.push(r),o}function By(i,t,e,n,r,s,o){if(o)return Ya(i,t,e[e.length-1],n,r,s);let a;if(r<i[n-1])return s?(a=i.slice(0,n),a[n-1]=r,a):null;if(i[i.length-1]<r)return s?(a=i.slice(i.length-n),a[n-1]=r,a):null;for(let l=0,h=e.length;l<h;++l){const u=e[l];if(t!=u){if(r<i[t+n-1])return null;if(r<=i[u-1])return Ya(i,t,u,n,r,!1);t=u}}return null}function xf(i,t,e,n){let r=i[t],s=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return o}class oo extends Gi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){gn(this.flatCoordinates,t),this.changed()}clone(){const t=new oo(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<Di(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))}forEachSegment(t){return Nc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return ni(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return so(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return xf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){var t;return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,(t=this.flatMidpoint_)!=null?t:void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new oo(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=To(this.flatCoordinates,0,t,this.stride),this.changed()}}const Hr=oo,hs={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Gs=[hs.FILL],ri=[hs.STROKE],Ii=[hs.BEGIN_PATH],Su=[hs.CLOSE_PATH],Q=hs;class Yy{drawCustom(t,e,n,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const Ef=Yy;class Zy extends Ef{constructor(t,e,n,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)r[0]=t[a],r[1]=t[a+1],Fi(n,r)&&(s[o++]=r[0],s[o++]=r[1]);return o}appendFlatLineCoordinates(t,e,n,r,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=r);let u=t[e],c=t[e+1];const f=this.tmpCoordinate_;let g=!0,_,m,y;for(_=e+r;_<n;_+=r)f[0]=t[_],f[1]=t[_+1],y=Ta(h,f),y!==m?(g&&(a[l++]=u,a[l++]=c,g=!1),a[l++]=f[0],a[l++]=f[1]):y===jt.INTERSECTING?(a[l++]=f[0],a[l++]=f[1],g=!1):g=!0,u=f[0],c=f[1],m=y;return(s&&g||_===e+r)&&(a[l++]=u,a[l++]=c),l}drawCustomCoordinates_(t,e,n,r,s){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(t,e,l,r,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,n,r,s){this.beginGeometry(t,e,s);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,u,c,f,g;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),f=[];const _=t.getEndss();g=0;for(let m=0,y=_.length;m<y;++m){const x=[];g=this.drawCustomCoordinates_(h,g,_[m],a,x),f.push(x)}this.instructions.push([Q.CUSTOM,l,f,t,n,Oa,s]),this.hitDetectionInstructions.push([Q.CUSTOM,l,f,t,r||n,Oa,s]);break;case"Polygon":case"MultiLineString":c=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(h,0,t.getEnds(),a,c),this.instructions.push([Q.CUSTOM,l,c,t,n,Gr,s]),this.hitDetectionInstructions.push([Q.CUSTOM,l,c,t,r||n,Gr,s]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([Q.CUSTOM,l,u,t,n,ni,s]),this.hitDetectionInstructions.push([Q.CUSTOM,l,u,t,r||n,ni,s]);break;case"MultiPoint":h=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,a),u>l&&(this.instructions.push([Q.CUSTOM,l,u,t,n,ni,s]),this.hitDetectionInstructions.push([Q.CUSTOM,l,u,t,r||n,ni,s]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([Q.CUSTOM,l,u,t,n,void 0,s]),this.hitDetectionInstructions.push([Q.CUSTOM,l,u,t,r||n,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[Q.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Q.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let r,s,o=-1;for(e=0;e<n;++e)r=t[e],s=r[0],s==Q.END_GEOMETRY?o=e:s==Q.BEGIN_GEOMETRY&&(r[2]=e,jg(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const r=t.getColor();n.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,n.fillStyle=dn(r||xe)}else n.fillStyle=void 0;if(e){const r=e.getColor();n.strokeStyle=dn(r||Ur);const s=e.getLineCap();n.lineCap=s!==void 0?s:ur;const o=e.getLineDash();n.lineDash=o?o.slice():Fn;const a=e.getLineDashOffset();n.lineDashOffset=a||Dn;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:cr;const h=e.getWidth();n.lineWidth=h!==void 0?h:Kr;const u=e.getMiterLimit();n.miterLimit=u!==void 0?u:Zr,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[Q.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Q.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,r=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=r||s!=t.currentLineDash&&!di(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=r,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Q.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=yc(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ol(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const us=Zy;class Uy extends us{constructor(t,e,n,r){super(t,e,n,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!Fi(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const r=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,s);this.instructions.push([Q.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Q.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const r=t.getFlatCoordinates(),s=[];for(let l=0,h=r.length;l<h;l+=t.getStride())(!this.maxExtent||Fi(this.maxExtent,r.slice(l,l+2)))&&s.push(r[l],r[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([Q.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Q.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),r=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const $y=Uy;class Ky extends us{constructor(t,e,n,r){super(t,e,n,r)}drawFlatCoordinates_(t,e,n,r){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,r,!1,!1),a=[Q.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,e,n){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Q.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Fn,Dn],Ii);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(ri),this.endGeometry(e)}drawMultiLineString(t,e,n){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Q.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Fn,Dn],Ii);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let u=0;for(let c=0,f=a.length;c<f;++c)u=this.drawFlatCoordinates_(l,u,a[c],h);this.hitDetectionInstructions.push(ri),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ri),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ri),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Ii)}}const jy=Ky;class Vy extends us{constructor(t,e,n,r){super(t,e,n,r)}drawFlatCoordinatess_(t,e,n,r){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=n.length;this.instructions.push(Ii),this.hitDetectionInstructions.push(Ii);for(let h=0;h<l;++h){const u=n[h],c=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,u,r,!0,!a),g=[Q.MOVE_TO_LINE_TO,c,f];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(Su),this.hitDetectionInstructions.push(Su)),e=u}return o&&(this.instructions.push(Gs),this.hitDetectionInstructions.push(Gs)),a&&(this.instructions.push(ri),this.hitDetectionInstructions.push(ri)),e}drawCircle(t,e,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_FILL_STYLE,xe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Fn,Dn]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const u=[Q.CIRCLE,h];this.instructions.push(Ii,u),this.hitDetectionInstructions.push(Ii,u),r.fillStyle!==void 0&&(this.instructions.push(Gs),this.hitDetectionInstructions.push(Gs)),r.strokeStyle!==void 0&&(this.instructions.push(ri),this.hitDetectionInstructions.push(ri)),this.endGeometry(e)}drawPolygon(t,e,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_FILL_STYLE,xe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Fn,Dn]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_FILL_STYLE,xe]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Q.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Fn,Dn]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let u=0;for(let c=0,f=a.length;c<f;++c)u=this.drawFlatCoordinatess_(l,u,a[c],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,r=e.length;n<r;++n)e[n]=wi(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const Iu=Vy;function qy(i,t,e,n,r){const s=[];let o=e,a=0,l=t.slice(e,2);for(;a<i&&o+r<n;){const[h,u]=l.slice(-2),c=t[o+r],f=t[o+r+1],g=Math.sqrt((c-h)*(c-h)+(f-u)*(f-u));if(a+=g,a>=i){const _=(i-a+g)/g,m=Re(h,c,_),y=Re(u,f,_);l.push(m,y),s.push(l),l=[m,y],a==i&&(o+=r),a=0}else if(a<i)l.push(t[o+r],t[o+r+1]),o+=r;else{const _=g-a,m=Re(h,c,_/g),y=Re(u,f,_/g);l.push(m,y),s.push(l),l=[m,y],a=0,o+=r}}return a>0&&s.push(l),s}function Hy(i,t,e,n,r){let s=e,o=e,a=0,l=0,h=e,u,c,f,g,_,m,y,x,E,v;for(c=e;c<n;c+=r){const R=t[c],w=t[c+1];_!==void 0&&(E=R-_,v=w-m,g=Math.sqrt(E*E+v*v),y!==void 0&&(l+=f,u=Math.acos((y*E+x*v)/(f*g)),u>i&&(l>a&&(a=l,s=h,o=c),l=0,h=c-r)),f=g,y=E,x=v),_=R,m=w}return l+=g,l>a?[h,c]:[s,o]}const ao={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Jy extends us{constructor(t,e,n,r){super(t,e,n,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[xe]={fillStyle:xe},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const r=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!r&&!s)return;const a=this.coordinates;let l=a.length;const h=t.getType();let u=null,c=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!fe(this.maxExtent,t.getExtent()))return;let f;if(u=t.getFlatCoordinates(),h=="LineString")f=[u.length];else if(h=="MultiLineString")f=t.getEnds();else if(h=="Polygon")f=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const y=t.getEndss();f=[];for(let x=0,E=y.length;x<E;++x)f.push(y[x][0])}this.beginGeometry(t,e,n);const g=o.repeat,_=g?void 0:o.textAlign;let m=0;for(let y=0,x=f.length;y<x;++y){let E;g?E=qy(g*this.resolution,u,m,f[y],c):E=[u.slice(m,f[y])];for(let v=0,R=E.length;v<R;++v){const w=E[v];let I=0,b=w.length;if(_==null){const T=Hy(o.maxAngle,w,0,w.length,2);I=T[0],b=T[1]}for(let T=I;T<b;T+=c)a.push(w[T],w[T+1]);const S=a.length;m=f[y],this.drawChars_(l,S),l=S}}this.endGeometry(e)}else{let f=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),c=2;break;case"Polygon":u=t.getFlatInteriorPoint(),o.overflow||f.push(u[2]/this.resolution),c=3;break;case"MultiPolygon":const E=t.getFlatInteriorPoints();u=[];for(let v=0,R=E.length;v<R;v+=3)o.overflow||f.push(E[v+2]/this.resolution),u.push(E[v],E[v+1]);if(u.length===0)return;c=2;break}const g=this.appendFlatPointCoordinates(u,c);if(g===l)return;if(f&&(g-l)/2!==u.length/c){let E=l/2;f=f.filter((v,R)=>{const w=a[(E+R)*2]===u[R*c]&&a[(E+R)*2+1]===u[R*c+1];return w||--E,w})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let _=o.padding;if(_!=Si&&(o.scale[0]<0||o.scale[1]<0)){let E=o.padding[0],v=o.padding[1],R=o.padding[2],w=o.padding[3];o.scale[0]<0&&(v=-v,w=-w),o.scale[1]<0&&(E=-E,R=-R),_=[E,v,R,w]}const m=this.pixelRatio;this.instructions.push([Q.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==Si?Si:_.map(function(E){return E*m}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const y=1/m,x=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=xe,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Q.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,_,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?xe:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),o.backgroundFill&&(this.state.fillStyle=x,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||$r,justify:e.justify,textBaseline:e.textBaseline||to,scale:e.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=ao[r.textBaseline],u=this.textOffsetY_*l,c=this.text_,f=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Q.DRAW_CHARS,t,e,h,r.overflow,a,r.maxAngle,l,u,s,f*l,c,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([Q.DRAW_CHARS,t,e,h,r.overflow,a&&xe,r.maxAngle,l,u,s,f*l,c,o,1/l,this.declutterMode_])}setTextStyle(t,e){let n,r,s;if(!t)this.text_="";else{const o=t.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=dn(o.getColor()||xe)):(r=null,this.textFillState_=r);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const _=a.getLineDash(),m=a.getLineDashOffset(),y=a.getWidth(),x=a.getMiterLimit();s.lineCap=a.getLineCap()||ur,s.lineDash=_?_.slice():Fn,s.lineDashOffset=m===void 0?Dn:m,s.lineJoin=a.getLineJoin()||cr,s.lineWidth=y===void 0?Kr:y,s.miterLimit=x===void 0?Zr:x,s.strokeStyle=dn(a.getColor()||Ur)}n=this.textState_;const l=t.getFont()||Hc;z_(l);const h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||to,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Si,n.scale=h===void 0?[1,1]:h;const u=t.getOffsetX(),c=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=c===void 0?0:c,this.textRotateWithView_=f===void 0?!1:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:pt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+pt(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Qy={Circle:Iu,Default:us,Image:$y,LineString:jy,Polygon:Iu,Text:Jy};class t0{constructor(t,e,n,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const r in n){const s=n[r].finish();t[e][r]=s}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[n];r===void 0&&(r={},this.buildersByZIndex_[n]=r);let s=r[e];if(s===void 0){const o=Qy[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=s}return s}}const e0=t0;class n0 extends mc{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return nt()}getData(t){return null}prepareFrame(t){return nt()}renderFrame(t,e){return nt()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,s,o)}}forEachFeatureAtCoordinate(t,e,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===Y.LOADED||e.getState()===Y.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Y.LOADED&&e!=Y.ERROR&&t.addEventListener(et.CHANGE,this.boundHandleImageChange_),e==Y.IDLE&&(t.load(),e=t.getState()),e==Y.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const i0=n0;class r0{constructor(){pe(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof Da()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,r=e.length;n<r;n+=2){const s=e[n],o=e[n+1];if(typeof t[s]=="function")t[s](...o);else{if(typeof o=="function"){t[s]=o(t);continue}t[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const vf=r0,bu=[];let ir=null;function s0(){ir=Bt(1,1,void 0,{willReadFrequently:!0})}class o0 extends i0{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Me(),this.pixelTransform=Me(),this.inversePixelTransform=Me(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){ir||s0(),ir.clearRect(0,0,1,1);let r;try{ir.drawImage(t,e,n,1,1,0,0,1,1),r=ir.getImageData(0,0,1,1).data}catch{return ir=null,null}return r}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const r=this.getLayer().getClassName();let s,o;if(t&&t.className===r&&(!n||t&&t.style.backgroundColor&&di(Yr(t.style.backgroundColor),Yr(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=Bt();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const r=ki(n),s=So(n),o=Ro(n),a=Co(n);Zt(e.coordinateToPixelTransform,r),Zt(e.coordinateToPixelTransform,s),Zt(e.coordinateToPixelTransform,o),Zt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Zt(l,r),Zt(l,s),Zt(l,o),Zt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){const s=new cf(t,this.inversePixelTransform,n,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Fe.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Fe.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new vf),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){!t.declutter||(this.dispatchRenderEvent_(Fe.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Fe.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,r,s,o,a){const l=s/2,h=o/2,u=r/e,c=-u,f=-t[0]+a,g=-t[1];return Xe(this.tempTransform,l,h,u,c,-n,f,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const Hl=o0;function a0(i,t,e,n,r,s,o,a,l,h,u,c){let f=i[t],g=i[t+1],_=0,m=0,y=0,x=0;function E(){_=f,m=g,t+=n,f=i[t],g=i[t+1],x+=y,y=Math.sqrt((f-_)*(f-_)+(g-m)*(g-m))}do E();while(t<e-n&&x+y<s);let v=y===0?0:(s-x)/y;const R=Re(_,f,v),w=Re(m,g,v),I=t-n,b=x,S=s+a*l(h,r,u);for(;t<e-n&&x+y<S;)E();v=y===0?0:(S-x)/y;const T=Re(_,f,v),O=Re(m,g,v);let P;if(c){const z=[R,w,T,O];Ac(z,0,4,2,c,z,z),P=z[0]>z[2]}else P=R>T;const F=Math.PI,W=[],G=I+n===t;t=I,y=0,x=b,f=i[t],g=i[t+1];let $;if(G){E(),$=Math.atan2(g-m,f-_),P&&($+=$>0?-F:F);const z=(T+R)/2,Z=(O+w)/2;return W[0]=[z,Z,(S-s)/2,$,r],W}r=r.replace(/\n/g," ");for(let z=0,Z=r.length;z<Z;){E();let H=Math.atan2(g-m,f-_);if(P&&(H+=H>0?-F:F),$!==void 0){let A=H-$;if(A+=A>F?-2*F:A<-F?2*F:0,Math.abs(A)>o)return null}$=H;const lt=z;let k=0;for(;z<Z;++z){const A=P?Z-z-1:z,tt=a*l(h,r[A],u);if(t+n<e&&x+y<s+k+tt/2)break;k+=tt}if(z===lt)continue;const N=P?r.substring(Z-lt,Z-z):r.substring(lt,z);v=y===0?0:(s+k/2-x)/y;const rt=Re(_,f,v),Et=Re(m,g,v);W.push([rt,Et,k/2,H,N]),s+=k}return W}const Vi=ze(),Kn=[],Cn=[],Rn=[],jn=[];function Tu(i){return i[3].declutterBox}const Mu=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function da(i,t){return t==="start"?t=Mu.test(i)?"right":"left":t==="end"&&(t=Mu.test(i)?"left":"right"),ao[t]}function l0(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}class h0{constructor(t,e,n,r,s){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Me(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new vf:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,r){const s=t+e+n+r;if(this.labels_[s])return this.labels_[s];const o=r?this.strokeStates[r]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],c=Array.isArray(t),f=l.justify?ao[l.justify]:da(Array.isArray(t)?t[0]:t,l.textAlign||$r),g=r&&o.lineWidth?o.lineWidth:0,_=c?t:t.split(`
`).reduce(l0,[]),{width:m,height:y,widths:x,heights:E,lineWidths:v}=W_(l,_),R=m+g,w=[],I=(R+2)*u[0],b=(y+g)*u[1],S={width:I<0?Math.floor(I):Math.ceil(I),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:w};(u[0]!=1||u[1]!=1)&&w.push("scale",u),r&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",g),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset)),n&&w.push("fillStyle",a.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const T=.5-f;let O=f*R+T*g;const P=[],F=[];let W=0,G=0,$=0,z=0,Z;for(let H=0,lt=_.length;H<lt;H+=2){const k=_[H];if(k===`
`){G+=W,W=0,O=f*R+T*g,++z;continue}const N=_[H+1]||l.font;N!==Z&&(r&&P.push("font",N),n&&F.push("font",N),Z=N),W=Math.max(W,E[$]);const rt=[k,O+T*x[$]+f*(x[$]-v[z]),.5*(g+W)+G];O+=x[$],r&&P.push("strokeText",rt),n&&F.push("fillText",rt),++$}return Array.prototype.push.apply(w,P),Array.prototype.push.apply(w,F),this.labels_[s]=S,S}replayTextBackground_(t,e,n,r,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,r,s,o,a,l,h,u,c,f,g,_,m,y){a*=f[0],l*=f[1];let x=n-a,E=r-l;const v=s+h>t?t-h:s,R=o+u>e?e-u:o,w=_[3]+v*f[0]+_[1],I=_[0]+R*f[1]+_[2],b=x-_[3],S=E-_[0];(m||c!==0)&&(Kn[0]=b,jn[0]=b,Kn[1]=S,Cn[1]=S,Cn[0]=b+w,Rn[0]=Cn[0],Rn[1]=S+I,jn[1]=Rn[1]);let T;return c!==0?(T=Xe(Me(),n,r,1,1,c,-n,-r),Zt(T,Kn),Zt(T,Cn),Zt(T,Rn),Zt(T,jn),hi(Math.min(Kn[0],Cn[0],Rn[0],jn[0]),Math.min(Kn[1],Cn[1],Rn[1],jn[1]),Math.max(Kn[0],Cn[0],Rn[0],jn[0]),Math.max(Kn[1],Cn[1],Rn[1],jn[1]),Vi)):hi(Math.min(b,b+w),Math.min(S,S+I),Math.max(b,b+w),Math.max(S,S+I),Vi),g&&(x=Math.round(x),E=Math.round(E)),{drawImageX:x,drawImageY:E,drawImageW:v,drawImageH:R,originX:h,originY:u,declutterBox:{minX:Vi[0],minY:Vi[1],maxX:Vi[2],maxY:Vi[3],value:y},canvasTransform:T,scale:f}}replayImageOrLabel_(t,e,n,r,s,o,a){const l=!!(o||a),h=r.declutterBox,u=a?a[2]*r.scale[0]/2:0;return h.minX-u<=e[0]&&h.maxX+u>=0&&h.minY-u<=e[1]&&h.maxY+u>=0&&(l&&this.replayTextBackground_(t,Kn,Cn,Rn,jn,o,a),B_(t,r.canvasTransform,s,n,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=Zt(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(n[0]%r,n[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,r){const s=this.textStates[e],o=this.createLabel(t,e,r,n),a=this.strokeStates[n],l=this.pixelRatio,h=da(Array.isArray(t)?t[0]:t,s.textAlign||$r),u=ao[s.textBaseline||to],c=a&&a.lineWidth?a.lineWidth:0,f=o.width/l-2*s.scale[0],g=h*f+2*(.5-h)*c,_=u*o.height/l+2*(.5-u)*c;return{label:o,anchorX:g,anchorY:_}}execute_(t,e,n,r,s,o,a,l){const h=this.zIndexContext_;let u;this.pixelCoordinates_&&di(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=oi(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),zm(this.renderedTransform_,n));let c=0;const f=r.length;let g=0,_,m,y,x,E,v,R,w,I,b,S,T,O,P=0,F=0,W=null,G=null;const $=this.coordinateCache_,z=this.viewRotation_,Z=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,H={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:z},lt=this.instructions!=r||this.overlaps?0:200;let k,N,rt,Et;for(;c<f;){const A=r[c];switch(A[0]){case Q.BEGIN_GEOMETRY:k=A[1],Et=A[3],k.getGeometry()?a!==void 0&&!fe(a,Et.getExtent())?c=A[2]+1:++c:c=A[2],h&&(h.zIndex=A[4]);break;case Q.BEGIN_PATH:P>lt&&(this.fill_(t),P=0),F>lt&&(t.stroke(),F=0),!P&&!F&&(t.beginPath(),E=NaN,v=NaN),++c;break;case Q.CIRCLE:g=A[1];const V=u[g],J=u[g+1],Ct=u[g+2],At=u[g+3],_t=Ct-V,st=At-J,j=Math.sqrt(_t*_t+st*st);t.moveTo(V+j,J),t.arc(V,J,j,0,2*Math.PI,!0),++c;break;case Q.CLOSE_PATH:t.closePath(),++c;break;case Q.CUSTOM:g=A[1],_=A[2];const Yt=A[3],we=A[4],Ut=A[5];H.geometry=Yt,H.feature=k,c in $||($[c]=[]);const $t=$[c];Ut?Ut(u,g,_,2,$t):($t[0]=u[g],$t[1]=u[g+1],$t.length=2),h&&(h.zIndex=A[6]),we($t,H),++c;break;case Q.DRAW_IMAGE:g=A[1],_=A[2],I=A[3],m=A[4],y=A[5];let te=A[6];const Qe=A[7],Ce=A[8],tn=A[9],en=A[10];let ut=A[11];const bt=A[12];let Nt=A[13];x=A[14]||"declutter";const Gt=A[15];if(!I&&A.length>=20){b=A[19],S=A[20],T=A[21],O=A[22];const _e=this.drawLabelWithPointPlacement_(b,S,T,O);I=_e.label,A[3]=I;const on=A[23];m=(_e.anchorX-on)*this.pixelRatio,A[4]=m;const ae=A[24];y=(_e.anchorY-ae)*this.pixelRatio,A[5]=y,te=I.height,A[6]=te,Nt=I.width,A[13]=Nt}let ge;A.length>25&&(ge=A[25]);let Ae,Ht,St;A.length>17?(Ae=A[16],Ht=A[17],St=A[18]):(Ae=Si,Ht=!1,St=!1),en&&Z?ut+=z:!en&&!Z&&(ut-=z);let Be=0;for(;g<_;g+=2){if(ge&&ge[Be++]<Nt/this.pixelRatio)continue;const _e=this.calculateImageOrLabelDimensions_(I.width,I.height,u[g],u[g+1],Nt,te,m,y,Ce,tn,ut,bt,s,Ae,Ht||St,k),on=[t,e,I,_e,Qe,Ht?W:null,St?G:null];if(l){let ae,le,he;if(Gt){const It=_-g;if(!Gt[It]){Gt[It]={args:on,declutterMode:x};continue}const Kt=Gt[It];ae=Kt.args,le=Kt.declutterMode,delete Gt[It],he=Tu(ae)}let Ye,Le;if(ae&&(le!=="declutter"||!l.collides(he))&&(Ye=!0),(x!=="declutter"||!l.collides(_e.declutterBox))&&(Le=!0),le==="declutter"&&x==="declutter"){const It=Ye&&Le;Ye=It,Le=It}Ye&&(le!=="none"&&l.insert(he),this.replayImageOrLabel_.apply(this,ae)),Le&&(x!=="none"&&l.insert(_e.declutterBox),this.replayImageOrLabel_.apply(this,on))}else this.replayImageOrLabel_.apply(this,on)}++c;break;case Q.DRAW_CHARS:const Ft=A[1],Xn=A[2],me=A[3],yn=A[4];O=A[5];const Wn=A[6],nn=A[7],Wi=A[8];T=A[9];const Bn=A[10];b=A[11],S=A[12];const xn=[A[13],A[13]];x=A[14]||"declutter";const gi=this.textStates[S],Yn=gi.font,rn=[gi.scale[0]*nn,gi.scale[1]*nn];let zt;Yn in this.widths_?zt=this.widths_[Yn]:(zt={},this.widths_[Yn]=zt);const gs=xf(u,Ft,Xn,2),sn=Math.abs(rn[0])*mu(Yn,b,zt);if(yn||sn<=gs){const _e=this.textStates[S].textAlign,on=(gs-sn)*da(b,_e),ae=a0(u,Ft,Xn,2,b,on,Wn,Math.abs(rn[0]),mu,Yn,zt,Z?0:this.viewRotation_);t:if(ae){const le=[];let he,Ye,Le,It,Kt;if(T)for(he=0,Ye=ae.length;he<Ye;++he){Kt=ae[he],Le=Kt[4],It=this.createLabel(Le,S,"",T),m=Kt[2]+(rn[0]<0?-Bn:Bn),y=me*It.height+(.5-me)*2*Bn*rn[1]/rn[0]-Wi;const Ze=this.calculateImageOrLabelDimensions_(It.width,It.height,Kt[0],Kt[1],It.width,It.height,m,y,0,0,Kt[3],xn,!1,Si,!1,k);if(l&&x==="declutter"&&l.collides(Ze.declutterBox))break t;le.push([t,e,It,Ze,1,null,null])}if(O)for(he=0,Ye=ae.length;he<Ye;++he){Kt=ae[he],Le=Kt[4],It=this.createLabel(Le,S,O,""),m=Kt[2],y=me*It.height-Wi;const Ze=this.calculateImageOrLabelDimensions_(It.width,It.height,Kt[0],Kt[1],It.width,It.height,m,y,0,0,Kt[3],xn,!1,Si,!1,k);if(l&&x==="declutter"&&l.collides(Ze.declutterBox))break t;le.push([t,e,It,Ze,1,null,null])}l&&x!=="none"&&l.load(le.map(Tu));for(let Ze=0,ms=le.length;Ze<ms;++Ze)this.replayImageOrLabel_.apply(this,le[Ze])}}++c;break;case Q.END_GEOMETRY:if(o!==void 0){k=A[1];const _e=o(k,Et);if(_e)return _e}++c;break;case Q.FILL:lt?P++:this.fill_(t),++c;break;case Q.MOVE_TO_LINE_TO:for(g=A[1],_=A[2],N=u[g],rt=u[g+1],R=N+.5|0,w=rt+.5|0,(R!==E||w!==v)&&(t.moveTo(N,rt),E=R,v=w),g+=2;g<_;g+=2)N=u[g],rt=u[g+1],R=N+.5|0,w=rt+.5|0,(g==_-2||R!==E||w!==v)&&(t.lineTo(N,rt),E=R,v=w);++c;break;case Q.SET_FILL_STYLE:W=A,this.alignAndScaleFill_=A[2],P&&(this.fill_(t),P=0,F&&(t.stroke(),F=0)),t.fillStyle=A[1],++c;break;case Q.SET_STROKE_STYLE:G=A,F&&(t.stroke(),F=0),this.setStrokeStyle_(t,A),++c;break;case Q.STROKE:lt?F++:t.stroke(),++c;break;default:++c;break}}P&&this.fill_(t),F&&t.stroke()}execute(t,e,n,r,s,o){this.viewRotation_=r,this.execute_(t,e,n,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,n,r,s){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,s)}}const u0=h0,Or=["Polygon","Circle","LineString","Image","Text","Default"],wf=["Image","Text"],c0=Or.filter(i=>!wf.includes(i));class f0{constructor(t,e,n,r,s,o,a){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Me(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let r=this.executorsByZIndex_[n];r===void 0&&(r={},this.executorsByZIndex_[n]=r);const s=t[n];for(const o in s){const a=s[o];r[o]=new u0(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let r=0,s=t.length;r<s;++r)if(t[r]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,r,s,o){r=Math.round(r);const a=r*2+1,l=Xe(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Bt(a,a,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let c;this.renderBuffer_!==void 0&&(c=ze(),Pr(c,t),ol(c,e*(this.renderBuffer_+r),c));const f=d0(r);let g;function _(w,I){const b=u.getImageData(0,0,a,a).data;for(let S=0,T=f.length;S<T;S++)if(b[f[S]]>0){if(!o||g!=="Image"&&g!=="Text"||o.includes(w)){const O=(f[S]-3)/4,P=r-O%a,F=r-(O/a|0),W=s(w,I,P*P+F*F);if(W)return W}u.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(On);let y,x,E,v,R;for(y=m.length-1;y>=0;--y){const w=m[y].toString();for(E=this.executorsByZIndex_[w],x=Or.length-1;x>=0;--x)if(g=Or[x],v=E[g],v!==void 0&&(R=v.executeHitDetection(u,l,n,_,c),R))return R}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],r=e[1],s=e[2],o=e[3],a=[n,r,n,o,s,o,s,r];return oi(a,0,8,2,t,a),a}isEmpty(){return Oi(this.executorsByZIndex_)}execute(t,e,n,r,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(On),o=o||Or;let h,u,c,f,g,_;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const m=l[h].toString();for(g=this.executorsByZIndex_[m],c=0,f=o.length;c<f;++c){const y=o[c];if(_=g[y],_!==void 0){const x=a===null?void 0:_.getZIndexContext(),E=x?x.getContext():t,v=this.maxExtent_&&y!=="Image"&&y!=="Text";if(v&&(E.save(),this.clip(E,n)),_.execute(E,e,n,r,s,a),v&&E.restore(),x){x.offset();const R=l[h];this.deferredZIndexContexts_[R]||(this.deferredZIndexContexts_[R]=[]),this.deferredZIndexContexts_[R].push(x)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(On);for(let n=0,r=e.length;n<r;++n)t[e[n]].forEach(s=>{s.draw(this.renderedContext_),s.clear()})}}const ga={};function d0(i){if(ga[i]!==void 0)return ga[i];const t=i*2+1,e=i*i,n=new Array(e+1);for(let s=0;s<=i;++s)for(let o=0;o<=i;++o){const a=s*s+o*o;if(a>e)break;let l=n[a];l||(l=[],n[a]=l),l.push(((i+s)*t+(i+o))*4+3),s>0&&l.push(((i-s)*t+(i+o))*4+3),o>0&&(l.push(((i+s)*t+(i-o))*4+3),s>0&&l.push(((i-s)*t+(i-o))*4+3))}const r=[];for(let s=0,o=n.length;s<o;++s)n[s]&&r.push(...n[s]);return ga[i]=r,r}const g0=f0;class m0 extends Ef{constructor(t,e,n,r,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?rl(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Me()}drawImages_(t,e,n,r){if(!this.image_)return;const s=oi(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,c=s.length;u<c;u+=2){const f=s[u]-this.imageAnchorX_,g=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const _=f+this.imageAnchorX_,m=g+this.imageAnchorY_;Xe(a,_,m,1,1,h,-_,-m),o.save(),o.transform.apply(o,a),o.translate(_,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=oi(t,e,n,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=r){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,r,s){const o=this.context_,a=oi(t,e,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),n}drawRings_(t,e,n,r){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!fe(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Um(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);!n||(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!fe(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(!!fe(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(r,s,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!fe(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!fe(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];r=this.drawRings_(n,r,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),di(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:$r;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:dn(n||xe)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),u=s||Fn;this.strokeState_={lineCap:r!==void 0?r:ur,lineDash:this.pixelRatio_===1?u:u.map(c=>c*this.pixelRatio_),lineDashOffset:(o||Dn)*this.pixelRatio_,lineJoin:a!==void 0?a:cr,lineWidth:(l!==void 0?l:Kr)*this.pixelRatio_,miterLimit:h!==void 0?h:Zr,strokeStyle:dn(n||Ur)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:dn(g||xe)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const g=n.getColor(),_=n.getLineCap(),m=n.getLineDash(),y=n.getLineDashOffset(),x=n.getLineJoin(),E=n.getWidth(),v=n.getMiterLimit();this.textStrokeState_={lineCap:_!==void 0?_:ur,lineDash:m||Fn,lineDashOffset:y||Dn,lineJoin:x!==void 0?x:cr,lineWidth:E!==void 0?E:Kr,miterLimit:v!==void 0?v:Zr,strokeStyle:dn(g||Ur)}}const r=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),u=t.getText(),c=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:r!==void 0?r:Hc,textAlign:c!==void 0?c:$r,textBaseline:f!==void 0?f:to},this.text_=u!==void 0?Array.isArray(u)?u.reduce((g,_,m)=>g+=m%2?" ":_,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const _0=m0,un=.5;function p0(i,t,e,n,r,s,o,a,l){const h=l?fl(r):r,u=i[0]*un,c=i[1]*un,f=Bt(u,c);f.imageSmoothingEnabled=!1;const g=f.canvas,_=new _0(f,un,r,null,o,a,l?Io(Am(),l):null),m=e.length,y=Math.floor((256*256*256-1)/m),x={};for(let v=1;v<=m;++v){const R=e[v-1],w=R.getStyleFunction()||n;if(!w)continue;let I=w(R,s);if(!I)continue;Array.isArray(I)||(I=[I]);const S=(v*y).toString(16).padStart(7,"#00000");for(let T=0,O=I.length;T<O;++T){const P=I[T],F=P.getGeometryFunction()(R);if(!F||!fe(h,F.getExtent()))continue;const W=P.clone(),G=W.getFill();G&&G.setColor(S);const $=W.getStroke();$&&($.setColor(S),$.setLineDash(null)),W.setText(void 0);const z=P.getImage();if(z){const k=z.getImageSize();if(!k)continue;const N=Bt(k[0],k[1],void 0,{alpha:!1}),rt=N.canvas;N.fillStyle=S,N.fillRect(0,0,rt.width,rt.height),W.setImage(new Yl({img:rt,anchor:z.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:z.getOrigin(),opacity:1,size:z.getSize(),scale:z.getScale(),rotation:z.getRotation(),rotateWithView:z.getRotateWithView()}))}const Z=W.getZIndex()||0;let H=x[Z];H||(H={},x[Z]=H,H.Polygon=[],H.Circle=[],H.LineString=[],H.Point=[]);const lt=F.getType();if(lt==="GeometryCollection"){const k=F.getGeometriesArrayRecursive();for(let N=0,rt=k.length;N<rt;++N){const Et=k[N];H[Et.getType().replace("Multi","")].push(Et,W)}}else H[lt.replace("Multi","")].push(F,W)}}const E=Object.keys(x).map(Number).sort(On);for(let v=0,R=E.length;v<R;++v){const w=x[E[v]];for(const I in w){const b=w[I];for(let S=0,T=b.length;S<T;S+=2){_.setStyle(b[S+1]);for(let O=0,P=t.length;O<P;++O)_.setTransform(t[O]),_.drawGeometry(b[S])}}}return f.getImageData(0,0,g.width,g.height)}function y0(i,t,e){const n=[];if(e){const r=Math.floor(Math.round(i[0])*un),s=Math.floor(Math.round(i[1])*un),o=(Xt(r,0,e.width-1)+Xt(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],u=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);u&&u%c===0&&n.push(t[u/c-1])}return n}const x0=.5,Cf={Point:b0,LineString:R0,Polygon:M0,MultiPoint:T0,MultiLineString:S0,MultiPolygon:I0,GeometryCollection:C0,Circle:v0};function E0(i,t){return parseInt(pt(i),10)-parseInt(pt(t),10)}function Au(i,t){const e=Rf(i,t);return e*e}function Rf(i,t){return x0*i/t}function v0(i,t,e,n,r){const s=e.getFill(),o=e.getStroke();if(s||o){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,n,r)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Lu(i,t,e,n,r,s,o,a){const l=[],h=e.getImage();if(h){let f=!0;const g=h.getImageState();g==Y.LOADED||g==Y.ERROR?f=!1:g==Y.IDLE&&h.load(),f&&l.push(h.ready())}const u=e.getFill();u&&u.loading()&&l.push(u.ready());const c=l.length>0;return c&&Promise.all(l).then(()=>r(null)),w0(i,t,e,n,s,o,a),c}function w0(i,t,e,n,r,s,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,r);if(e.getRenderer())Sf(i,l,e,t,o);else{const u=Cf[l.getType()];u(i,l,e,t,o,s)}}function Sf(i,t,e,n,r){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let a=0,l=o.length;a<l;++a)Sf(i,o[a],e,n,r);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),r)}function C0(i,t,e,n,r,s){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=Cf[o[a].getType()];h(i,o[a],e,n,r,s)}}function R0(i,t,e,n,r){const s=e.getStroke();if(s){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,n,r)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,r)}}function S0(i,t,e,n,r){const s=e.getStroke();if(s){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,n,r)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,r)}}function I0(i,t,e,n,r){const s=e.getFill(),o=e.getStroke();if(o||s){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,n,r)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,r)}}function b0(i,t,e,n,r,s){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=Y.LOADED)return;const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,h),u.drawPoint(t,n,r)}if(l){const u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(a,h),u.drawText(t,n,r)}}function T0(i,t,e,n,r,s){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),u=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=Y.LOADED)return;const c=i.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,u),c.drawMultiPoint(t,n,r)}if(h){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(l,u),c.drawText(t,n,r)}}function M0(i,t,e,n,r){const s=e.getFill(),o=e.getStroke();if(s||o){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,n,r)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,r)}}class A0 extends Hl{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ze(),this.wrappedRenderedExtent_=ze(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const r=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,u=l.getExtent(),c=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),g=e.pixelRatio,_=e.viewHints,m=!(_[Vt.ANIMATING]||_[Vt.INTERACTING]),y=this.context,x=Math.round(ft(r)/a*g),E=Math.round(Ot(r)/a*g),v=c.getWrapX()&&l.canWrapX(),R=v?ft(u):null,w=v?Math.ceil((r[2]-u[2])/R)+1:1;let I=v?Math.floor((r[0]-u[0])/R):0;do{const b=this.getRenderTransform(o,a,h,g,x,E,I*R);t.execute(y,[y.canvas.width,y.canvas.height],b,h,m,n===void 0?Or:n?wf:c0,n?f&&e.declutter[f]:void 0)}while(++I<w)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Bt(this.context.canvas.width,this.context.canvas.height,bu))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Lo(this.context),bu.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){!this.replayGroup_||(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const n=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];this.opacity_=r.opacity;const s=t.extent,o=t.viewState.resolution,a=Math.round(ft(s)/o*n),l=Math.round(Ot(s)/o*n);Xe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,0,-a/2,-l/2),bo(this.inversePixelTransform,this.pixelTransform);const h=_l(this.pixelTransform);this.useContainer(e,h,this.getBackground(t));const u=this.context,c=u.canvas,f=this.replayGroup_;let g=f&&!f.isEmpty();if(!g&&!(this.getLayer().hasListener(Fe.PRERENDER)||this.getLayer().hasListener(Fe.POSTRENDER)))return null;c.width!=a||c.height!=l?(c.width=a,c.height=l,c.style.transform!==h&&(c.style.transform=h)):this.containerReused||u.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(u,t);const _=t.viewState;_.projection;let m=!1;if(g&&r.extent&&this.clipping){const y=Ln(r.extent);g=fe(y,t.extent),m=g&&!An(y,t.extent),m&&this.clipUnrotated(u,t,y)}return g&&this.renderWorlds(f,t,this.getLayer().getDeclutter()?!1:void 0),m&&u.restore(),this.postRender(u,t),this.renderedRotation_!==_.rotation&&(this.renderedRotation_=_.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];Zt(this.pixelTransform,n);const r=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],c=n[0]*un,f=n[1]*un;u.push(this.getRenderTransform(r,s,o,un,c,f,0).slice());const g=h.getSource(),_=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!An(_,l)){let m=l[0];const y=ft(_);let x=0,E;for(;m<_[0];)--x,E=y*x,u.push(this.getRenderTransform(r,s,o,un,c,f,E).slice()),m+=y;for(x=0,m=l[2];m>_[2];)++x,E=y*x,u.push(this.getRenderTransform(r,s,o,un,c,f,E).slice()),m-=y}this.hitDetectionImageData_=p0(n,u,this.renderedFeatures_,h.getStyleFunction(),l,s,o,Au(s,this.renderedPixelRatio_),null)}e(y0(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,r,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},u=function(_,m,y){const x=pt(_),E=h[x];if(E){if(E!==!0&&y<E.distanceSq){if(y===0)return h[x]=!0,s.splice(s.lastIndexOf(E),1),r(_,l,m);E.geometry=m,E.distanceSq=y}}else{if(y===0)return h[x]=!0,r(_,l,m);s.push(h[x]={feature:_,layer:l,geometry:m,distanceSq:y,callback:r})}};let c;const f=[this.replayGroup_],g=this.getLayer().getDeclutter();return f.some(_=>c=_.forEachFeatureAtCoordinate(t,o,a,n,u,g&&e.declutter[g]?e.declutter[g].all().map(m=>m.value):null)),c}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const r=t.viewHints[Vt.ANIMATING],s=t.viewHints[Vt.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,u=h.projection,c=h.resolution,f=t.pixelRatio,g=e.getRevision(),_=e.getRenderBuffer();let m=e.getRenderOrder();m===void 0&&(m=E0);const y=h.center.slice(),x=ol(l,_*c),E=x.slice(),v=[x.slice()],R=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!An(R,t.extent)){const G=ft(R),$=Math.max(ft(x)/2,G);x[0]=R[0]-$,x[2]=R[2]+$,Rc(y,u);const z=Cc(v[0],u);z[0]<R[0]&&z[2]<R[2]?v.push([z[0]+G,z[1],z[2]+G,z[3]]):z[0]>R[0]&&z[2]>R[2]&&v.push([z[0]-G,z[1],z[2]-G,z[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==g&&this.renderedRenderOrder_==m&&An(this.wrappedRenderedExtent_,x))return di(this.renderedExtent_,E)||(this.hitDetectionImageData_=null,this.renderedExtent_=E),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new e0(Rf(c,f),x,c,f);let I;for(let G=0,$=v.length;G<$;++G)n.loadFeatures(v[G],c,u);const b=Au(c,f);let S=!0;const T=(G,$)=>{let z;const Z=G.getStyleFunction()||e.getStyleFunction();if(Z&&(z=Z(G,c)),z){const H=this.renderFeature(G,b,z,w,I,this.getLayer().getDeclutter(),$);S=S&&!H}},O=fl(x),P=n.getFeaturesInExtent(O);m&&P.sort(m);for(let G=0,$=P.length;G<$;++G)T(P[G],G);this.renderedFeatures_=P,this.ready=S;const F=w.finish(),W=new g0(x,c,f,n.getOverlaps(),F,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=c,this.renderedRevision_=g,this.renderedRenderOrder_=m,this.renderedExtent_=E,this.wrappedRenderedExtent_=x,this.renderedCenter_=y,this.renderedProjection_=u,this.renderedPixelRatio_=f,this.replayGroup_=W,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,r,s,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,u=n.length;h<u;++h)l=Lu(r,t,n[h],e,this.boundHandleStyleImageChange_,s,o,a)||l;else l=Lu(r,t,n,e,this.boundHandleStyleImageChange_,s,o,a);return l}}const L0=A0;class P0 extends uf{constructor(t){super(t)}createRenderer(){return new L0(this)}}const Jl=P0;class O0{constructor(t){this.rbush_=new Tl(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[pt(e)]=n}load(t,e){const n=new Array(e.length);for(let r=0,s=e.length;r<s;r++){const o=t[r],a=e[r],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[r]=l,this.items_[pt(a)]=l}this.rbush_.load(n)}remove(t){const e=pt(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[pt(e)],r=[n.minX,n.minY,n.maxX,n.maxY];ui(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(r){return r.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let r=0,s=t.length;r<s;r++)if(n=e(t[r]),n)return n;return n}isEmpty(){return Oi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return hi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Pu=O0;class lo extends Lc{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Rt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(dt(t[e],et.CHANGE,this.changed,this))}clone(){const t=new lo(ma(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<Di(this.getExtent(),t,e))return r;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)r=s[o].closestPointXY(t,e,n,r);return r}containsXY(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)if(n[r].containsXY(t,e))return!0;return!1}computeExtent(t){is(t);const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)Ec(t,e[n].getExtent());return t}getGeometries(){return ma(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let r=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(r=!0)}return r?new lo(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].rotate(t,e);this.changed()}scale(t,e,n){n||(n=qe(this.getExtent()));const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)r[s].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(ma(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let r=0,s=n.length;r<s;++r)n[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ma(i){return i.map(t=>t.clone())}const F0=lo;class ho extends Gi{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const r=t,s=[],o=[];for(let l=0,h=r.length;l<h;++l){const u=r[l];gn(s,u.getFlatCoordinates()),o.push(s.length)}const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){gn(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ho(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<Di(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),El(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,r))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,By(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Gr(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Hr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,r=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new Hr(t.slice(s,l),n);r.push(h),s=l}return r}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const r=this.ends_,s=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],h=so(e,n,l,s,.5);gn(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Oc(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new ho(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return t_(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=rs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const D0=ho;class Ql extends Gi{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){gn(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Ql(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<Di(this.getExtent(),t,e))return r;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=Ti(t,e,s[a],s[a+1]);if(h<r){r=h;for(let u=0;u<o;++u)n[u]=s[a+u];n.length=o}}return r}getCoordinates(){return ni(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new zr(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,r=[];for(let s=0,o=t.length;s<o;s+=n){const a=new zr(t.slice(s,s+n),e);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let r=0,s=e.length;r<s;r+=n){const o=e[r],a=e[r+1];if(al(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=To(this.flatCoordinates,0,t,this.stride),this.changed()}}const If=Ql;function bf(i,t,e,n){const r=[];let s=ze();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=ll(i,t,l[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return r}class uo extends Gi{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const r=t,s=[],o=[];for(let a=0,l=r.length;a<l;++a){const h=r[a],u=s.length,c=h.getEnds();for(let f=0,g=c.length;f<g;++f)c[f]+=u;gn(s,h.getFlatCoordinates()),o.push(c)}e=r.length===0?this.getLayout():r[0].getLayout(),t=s,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;gn(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,s=e.length;r<s;++r)e[r]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const n=new uo(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,r){return r<Di(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($m(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Km(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Qm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Hm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Fa(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Oa(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=bf(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=kc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new If(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Xc(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Fa(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=qm(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new uo(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const n=this.endss_[t].slice(),r=n[n.length-1];if(e!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=e;return new Wr(this.flatCoordinates.slice(e,r),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(s!==0)for(let c=0,f=l.length;c<f;++c)l[c]-=s;const u=new Wr(e.slice(s,h),t,l);r.push(u),s=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return e_(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Pc(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const r=n[n.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const k0=uo,Ou=Me();class fr{constructor(t,e,n,r,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?xc(this.flatCoordinates_):ll(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=qe(this.getExtent());this.flatInteriorPoints_=Rl(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=i_(this.flatCoordinates_,this.ends_),e=bf(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=kc(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=so(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let r=0,s=n.length;r<s;++r){const o=n[r],a=so(t,e,o,2,.5);gn(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Wt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const r=Ot(n)/Ot(e);Xe(Ou,n[0],n[3],r,-r,0,0,0),oi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Ou,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new fr(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=dc((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":n.length=Mo(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),r=[n.length];break;case"MultiLineString":r=[],n.length=Oc(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,r);break;case"Polygon":r=[],n.length=vl(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,r);break}return r&&(this.simplifiedGeometry_=new fr(this.type_,n,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}fr.prototype.getFlatCoordinates=fr.prototype.getOrientedFlatCoordinates;const bn=fr;class N0 extends pn{constructor(t){super(),this.projection=Wt(t.projection),this.attributions_=Fu(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,r){e.viewResolver=n,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Fu(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Fu(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}const cs=N0,Pe={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function G0(i,t){return[[-1/0,-1/0,1/0,1/0]]}let z0=!1;function X0(i,t,e,n,r,s,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(e,n,r):i,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=z0,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let u;h=="json"?u=JSON.parse(a.responseText):h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?s(t.readFeatures(u,{extent:e,featureProjection:r}),t.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function Du(i,t){return function(e,n,r,s,o){const a=this;X0(i,t,e,n,r,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||hr)}}class Vn extends Je{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class W0 extends cs{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=hr,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(mt(this.format_,"`format` must be set when `url` is set"),this.loader_=Du(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:G0;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Pu:null,this.loadedExtentsRtree_=new Pu,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,r;Array.isArray(t.features)?r=t.features:t.features&&(n=t.features,r=n.getArray()),!e&&n===void 0&&(n=new cn(r)),r!==void 0&&this.addFeaturesInternal(r),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=pt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const r=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Vn(Pe.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof bn||(this.featureChangeKeys_[t]=[dt(e,et.CHANGE,this.handleFeatureChange_,this),dt(e,lr.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof bn){const s=this.idIndex_[r];s instanceof bn?Array.isArray(s)?s.push(e):this.idIndex_[r]=[s,e]:n=!1}else n=!1}return n&&(mt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],r=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=pt(a);this.addToIndex_(l,a)&&n.push(a)}for(let s=0,o=n.length;s<o;s++){const a=n[s],l=pt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();e.push(u),r.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(Pe.ADDFEATURE))for(let s=0,o=n.length;s<o;s++)this.dispatchEvent(new Vn(Pe.ADDFEATURE,n[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Pe.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(Pe.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(ye.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(ye.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Rt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(n);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Vn(Pe.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(r){const s=r.getGeometry();if(s instanceof bn||s.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const r=n.getGeometry();if(r instanceof bn||r.intersectsExtent(t)){const s=e(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Oi(this.nullGeometryFeatures_)||gn(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const r=xm(t,e);return[].concat(...r.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],r=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Fr,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const u=h.getGeometry(),c=a;if(a=u instanceof bn?0:u.closestPointXY(n,r,o,a),a<c){s=h;const f=Math.sqrt(a);l[0]=n-f,l[1]=r-f,l[2]=n+f,l[3]=r+f}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=pt(e),r=e.getGeometry();if(!r)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const o=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Vn(Pe.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:pt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Oi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const r=this.loadedExtentsRtree_,s=this.strategy_(t,e,n);for(let o=0,a=s.length;o<a;++o){const l=s[o];r.forEachInExtent(l,function(u){return An(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Vn(Pe.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vn(Pe.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vn(Pe.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(r){if(ui(r.extent,t))return n=r,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,r=t.length;n<r;++n){const s=t[n],o=this.removeFeatureInternal(s);o&&e.push(o)}e.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=pt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const n=this.featureChangeKeys_[e];if(!n)return;n.forEach(Rt),delete this.featureChangeKeys_[e];const r=t.getId();return r!==void 0&&delete this.idIndex_[r.toString()],delete this.uidIndex_[e],this.hasListener(Pe.REMOVEFEATURE)&&this.dispatchEvent(new Vn(Pe.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const r=this.idIndex_[n];if(t instanceof bn&&Array.isArray(r)&&r.includes(t))r.splice(r.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){mt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Du(t,this.format_))}}const th=W0;var br=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Go(i){var t=i.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),e}const Tf=.5;class B0 extends es{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(et.CHANGE)}release(){this.state===q.ERROR&&this.setState(q.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==q.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==q.LOADED){t.interimTile=null;break}t.getState()==q.LOADING?e=t:t.getState()==q.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==q.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){nt()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const r=e-n+1e3/60;return r>=this.transition_?1:Mc(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const Mf=B0,Y0=10,ku=.25;class Z0{constructor(t,e,n,r,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=Nr(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const v=E[0]+"/"+E[1];return a[v]||(a[v]=l(E)),a[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ft(r)>=ft(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ft(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ft(this.targetProj_.getExtent()):null;const h=ki(n),u=So(n),c=Ro(n),f=Co(n),g=this.transformInv_(h),_=this.transformInv_(u),m=this.transformInv_(c),y=this.transformInv_(f),x=Y0+(o?Math.max(0,Math.ceil(Math.log2(Ma(n)/(o*o*256*256)))):0);if(this.addQuad_(h,u,c,f,g,_,m,y,x),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(v,R,w){E=Math.min(E,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-E>this.sourceWorldWidth_/2){const R=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];R[0][0]-E>this.sourceWorldWidth_/2&&(R[0][0]-=this.sourceWorldWidth_),R[1][0]-E>this.sourceWorldWidth_/2&&(R[1][0]-=this.sourceWorldWidth_),R[2][0]-E>this.sourceWorldWidth_/2&&(R[2][0]-=this.sourceWorldWidth_);const w=Math.min(R[0][0],R[1][0],R[2][0]);Math.max(R[0][0],R[1][0],R[2][0])-w<this.sourceWorldWidth_/2&&(v.source=R)}})}a={}}addTriangle_(t,e,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,n]})}addQuad_(t,e,n,r,s,o,a,l,h){const u=jh([s,o,a,l]),c=this.sourceWorldWidth_?ft(u)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&c>.5&&c<1;let _=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const y=jh([t,e,n,r]);_=ft(y)/this.targetWorldWidth_>ku||_}!g&&this.sourceProj_.isGlobal()&&c&&(_=c>ku||_)}if(!_&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!fe(u,this.maxSourceExtent_))return;let m=0;if(!_&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)_=!0;else if(m=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(h>0){if(!_){const y=[(t[0]+n[0])/2,(t[1]+n[1])/2],x=this.transformInv_(y);let E;g?E=(Mi(s[0],f)+Mi(a[0],f))/2-Mi(x[0],f):E=(s[0]+a[0])/2-x[0];const v=(s[1]+a[1])/2-x[1];_=E*E+v*v>this.errorThresholdSquared_}if(_){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const y=[(e[0]+n[0])/2,(e[1]+n[1])/2],x=this.transformInv_(y),E=[(r[0]+t[0])/2,(r[1]+t[1])/2],v=this.transformInv_(E);this.addQuad_(t,e,y,E,s,o,x,v,h-1),this.addQuad_(E,y,n,r,v,x,a,l,h-1)}else{const y=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(y),E=[(n[0]+r[0])/2,(n[1]+r[1])/2],v=this.transformInv_(E);this.addQuad_(t,y,E,r,s,x,v,l,h-1),this.addQuad_(y,e,n,E,x,o,a,v,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(m&11)==0&&this.addTriangle_(t,n,r,s,a,l),(m&14)==0&&this.addTriangle_(t,n,e,s,a,o),m&&((m&13)==0&&this.addTriangle_(e,r,t,o,l,s),(m&7)==0&&this.addTriangle_(e,r,n,o,l,a))}calculateSourceExtent(){const t=ze();return this.triangles_.forEach(function(e,n,r){const s=e.source;Pr(t,s[0]),Pr(t,s[1]),Pr(t,s[2])}),t}getTriangles(){return this.triangles_}}const Af=Z0;let _a;const ar=[];function Nu(i,t,e,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,r)),i.restore()}function pa(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function U0(){if(_a===void 0){const i=Bt(6,6,ar);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Nu(i,4,5,4,0),Nu(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;_a=pa(t,0)||pa(t,4)||pa(t,8),Lo(i),ar.push(i.canvas)}return _a}function Za(i,t,e,n){const r=Tc(e,t,i);let s=qh(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||Fi(l,r)){const h=qh(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function $0(i,t,e,n){const r=qe(e);let s=Za(i,t,r,n);return(!isFinite(s)||s<=0)&&wc(e,function(o){return s=Za(i,t,o,n),isFinite(s)&&s>0}),s}function Lf(i,t,e,n,r,s,o,a,l,h,u,c,f,g){const _=Bt(Math.round(e*i),Math.round(e*t),ar);if(c||(_.imageSmoothingEnabled=!1),l.length===0)return _.canvas;_.scale(e,e);function m(w){return Math.round(w*e)/e}_.globalCompositeOperation="lighter";const y=ze();l.forEach(function(w,I,b){Ec(y,w.extent)});let x;const E=e/n,v=(c?1:1+Math.pow(2,-24))/E;if(!f||l.length!==1||h!==0){if(x=Bt(Math.round(ft(y)*E),Math.round(Ot(y)*E),ar),c||(x.imageSmoothingEnabled=!1),r&&g){const w=(r[0]-y[0])*E,I=-(r[3]-y[3])*E,b=ft(r)*E,S=Ot(r)*E;x.rect(w,I,b,S),x.clip()}l.forEach(function(w,I,b){const S=(w.extent[0]-y[0])*E,T=-(w.extent[3]-y[3])*E,O=ft(w.extent)*E,P=Ot(w.extent)*E;w.image.width>0&&w.image.height>0&&x.drawImage(w.image,h,h,w.image.width-2*h,w.image.height-2*h,c?S:Math.round(S),c?T:Math.round(T),c?O:Math.round(S+O)-Math.round(S),c?P:Math.round(T+P)-Math.round(T))})}const R=ki(o);return a.getTriangles().forEach(function(w,I,b){const S=w.source,T=w.target;let O=S[0][0],P=S[0][1],F=S[1][0],W=S[1][1],G=S[2][0],$=S[2][1];const z=m((T[0][0]-R[0])/s),Z=m(-(T[0][1]-R[1])/s),H=m((T[1][0]-R[0])/s),lt=m(-(T[1][1]-R[1])/s),k=m((T[2][0]-R[0])/s),N=m(-(T[2][1]-R[1])/s),rt=O,Et=P;O=0,P=0,F-=rt,W-=Et,G-=rt,$-=Et;const A=[[F,W,0,0,H-z],[G,$,0,0,k-z],[0,0,F,W,lt-Z],[0,0,G,$,N-Z]],tt=nm(A);if(!tt)return;if(_.save(),_.beginPath(),U0()||!c){_.moveTo(H,lt);const J=4,Ct=z-H,At=Z-lt;for(let _t=0;_t<J;_t++)_.lineTo(H+m((_t+1)*Ct/J),lt+m(_t*At/(J-1))),_t!=J-1&&_.lineTo(H+m((_t+1)*Ct/J),lt+m((_t+1)*At/(J-1)));_.lineTo(k,N)}else _.moveTo(H,lt),_.lineTo(z,Z),_.lineTo(k,N);_.clip(),_.transform(tt[0],tt[2],tt[1],tt[3],z,Z),_.translate(y[0]-rt,y[3]-Et);let V;if(x)V=x.canvas,_.scale(v,-v);else{const J=l[0],Ct=J.extent;V=J.image,_.scale(ft(Ct)/V.width,-Ot(Ct)/V.height)}_.drawImage(V,0,0),_.restore()}),x&&(Lo(x),ar.push(x.canvas)),u&&(_.save(),_.globalCompositeOperation="source-over",_.strokeStyle="black",_.lineWidth=1,a.getTriangles().forEach(function(w,I,b){const S=w.target,T=(S[0][0]-R[0])/s,O=-(S[0][1]-R[1])/s,P=(S[1][0]-R[0])/s,F=-(S[1][1]-R[1])/s,W=(S[2][0]-R[0])/s,G=-(S[2][1]-R[1])/s;_.beginPath(),_.moveTo(P,F),_.lineTo(T,O),_.lineTo(W,G),_.closePath(),_.stroke()}),_.restore()),_.canvas}class K0 extends Mf{constructor(t,e,n,r,s,o,a,l,h,u,c,f){super(s,q.IDLE,f),this.renderEdges_=c!==void 0?c:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const y=_?Ai(g,_):g;if(Ma(y)===0){this.state=q.EMPTY;return}const x=t.getExtent();x&&(m?m=Ai(m,x):m=x);const E=r.getResolution(this.wrappedTileCoord_[0]),v=$0(t,n,y,E);if(!isFinite(v)||v<=0){this.state=q.EMPTY;return}const R=u!==void 0?u:Tf;if(this.triangulation_=new Af(t,n,y,m,v*R,E),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=e.getZForResolution(v);let w=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(w[1]=Xt(w[1],m[1],m[3]),w[3]=Xt(w[3],m[1],m[3])):w=Ai(w,m)),!Ma(w))this.state=q.EMPTY;else{const I=e.getTileRangeForExtentAndZ(w,this.sourceZ_);for(let b=I.minX;b<=I.maxX;b++)for(let S=I.minY;S<=I.maxY;S++){const T=h(this.sourceZ_,b,S,a);T&&this.sourceTiles_.push(T)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==q.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Lf(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=q.LOADED}this.changed()}load(){if(this.state==q.IDLE){this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==q.IDLE||n==q.LOADING){t++;const r=dt(e,et.CHANGE,function(s){const o=e.getState();(o==q.LOADED||o==q.ERROR||o==q.EMPTY)&&(Rt(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,r){e.getState()==q.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Rt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Lo(this.canvas_.getContext("2d")),ar.push(this.canvas_),this.canvas_=null),super.release()}}const Ua=K0;class j0 extends Mf{constructor(t,e,n,r,s,o){super(t,e,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=q.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=q.ERROR,this.unlistenImage_(),this.image_=V0(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=q.LOADED:this.state=q.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==q.ERROR&&(this.state=q.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==q.IDLE&&(this.state=q.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=P_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function V0(){const i=Bt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const Pf=j0;class q0{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return mt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return mt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){mt(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}const H0=q0;class Of{constructor(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function qi(i,t,e,n,r){return r!==void 0?(r.minX=i,r.maxX=t,r.minY=e,r.maxY=n,r):new Of(i,t,e,n)}const Ff=Of;function Gu(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function zo(i,t,e){return i+"/"+t+"/"+e}function Df(i){return zo(i[0],i[1],i[2])}function J0(i){return i.split("/").map(Number)}function Q0(i){return(i[1]<<i[0])+i[2]}function tx(i,t){const e=i[0],n=i[1],r=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,r):!0}class ex extends ss{constructor(t){t=t||{},super(t)}}const nx=ex;class ix extends Hl{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,r=t.viewState,s=r.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=Ai(l,Ln(e.extent,r.projection))),!a[Vt.ANIMATING]&&!a[Vt.INTERACTING]&&!gr(l))if(o){const h=r.projection,u=o.getImage(l,s,n,h);u&&(this.loadImage(u)?this.image_=u:u.getState()===Y.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=Zt(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!Fi(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=ft(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const u=Ot(o),c=Math.floor(a.height*((o[3]-r[1])/u));return c<0||c>=a.height?null:this.getImageData(a,h,c)}renderFrame(t,e){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],u=t.pixelRatio,c=t.viewState,f=c.center,g=c.resolution,_=u*o/(g*l),m=u*a/(g*l),y=t.extent,x=c.resolution,E=c.rotation,v=Math.round(ft(y)/x*u),R=Math.round(Ot(y)/x*u);Xe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,E,-v/2,-R/2),bo(this.inversePixelTransform,this.pixelTransform);const w=_l(this.pixelTransform);this.useContainer(e,w,this.getBackground(t));const I=this.getRenderContext(t),b=this.context.canvas;b.width!=v||b.height!=R?(b.width=v,b.height=R):this.containerReused||I.clearRect(0,0,v,R);let S=!1,T=!0;if(h.extent){const G=Ln(h.extent,c.projection);T=fe(G,t.extent),S=T&&!An(G,t.extent),S&&this.clipUnrotated(I,t,G)}const O=n.getImage(),P=Xe(this.tempTransform,v/2,R/2,_,m,0,l*(r[0]-f[0])/o,l*(f[1]-r[3])/a);this.renderedResolution=a*u/l;const F=O.width*P[0],W=O.height*P[3];if(this.getLayer().getSource().getInterpolate()||(I.imageSmoothingEnabled=!1),this.preRender(I,t),T&&F>=.5&&W>=.5){const G=P[4],$=P[5],z=h.opacity;z!==1&&(I.save(),I.globalAlpha=z),I.drawImage(O,0,0,+O.width,+O.height,G,$,F,W),z!==1&&I.restore()}return this.postRender(this.context,t),S&&I.restore(),I.imageSmoothingEnabled=!0,w!==b.style.transform&&(b.style.transform=w),this.container}}const rx=ix;class sx extends nx{constructor(t){super(t)}createRenderer(){return new rx(this)}getData(t){return super.getData(t)}}const kf=sx,zs={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class ox extends ss{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(zs.PRELOAD)}setPreload(t){this.set(zs.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(zs.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(zs.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const ax=ox;class lx extends Hl{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ze(),this.tmpTileRange_=new Ff(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!r}getTile(t,e,n,r){const s=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(t,e,n,s,o);return h.getState()==q.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=Zt(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!Fi(s,r))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=n.getRenderSource(),u=h.getTileGridForProjection(l.projection),c=h.getTilePixelRatio(e.pixelRatio);for(let f=u.getZForResolution(l.resolution);f>=u.getMinZoom();--f){const g=u.getTileCoordForCoordAndZ(r,f),_=h.getTile(f,g[1],g[2],o,a);if(!(_ instanceof Pf||_ instanceof Ua)||_ instanceof Ua&&_.getState()===q.EMPTY)return null;if(_.getState()!==q.LOADED)continue;const m=u.getOrigin(f),y=Ie(u.getTileSize(f)),x=u.getResolution(f),E=Math.floor(c*((r[0]-m[0])/x-g[1]*y[0])),v=Math.floor(c*((m[1]-r[1])/x-g[2]*y[1])),R=Math.round(c*h.getGutterForProjection(l.projection));return this.getImageData(_.getImage(),E+R,v+R)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],r=t.viewState,s=r.projection,o=r.resolution,a=r.center,l=r.rotation,h=t.pixelRatio,u=this.getLayer(),c=u.getSource(),f=c.getRevision(),g=c.getTileGridForProjection(s),_=g.getZForResolution(o,c.zDirection),m=g.getResolution(_);let y=t.extent;const x=t.viewState.resolution,E=c.getTilePixelRatio(h),v=Math.round(ft(y)/x*h),R=Math.round(Ot(y)/x*h),w=n.extent&&Ln(n.extent);w&&(y=Ai(y,Ln(n.extent)));const I=m*v/2/E,b=m*R/2/E,S=[a[0]-I,a[1]-b,a[0]+I,a[1]+b],T=g.getTileRangeForExtentAndZ(y,_),O={};O[_]={};const P=this.createLoadedTileFinder(c,s,O),F=this.tmpExtent,W=this.tmpTileRange_;this.newTiles_=!1;const G=l?Aa(r.center,x,l,t.size):void 0;for(let Et=T.minX;Et<=T.maxX;++Et)for(let A=T.minY;A<=T.maxY;++A){if(l&&!g.tileCoordIntersectsViewport([_,Et,A],G))continue;const tt=this.getTile(_,Et,A,t);if(this.isDrawableTile(tt)){const Ct=pt(this);if(tt.getState()==q.LOADED){O[_][tt.tileCoord.toString()]=tt;let At=tt.inTransition(Ct);At&&n.opacity!==1&&(tt.endTransition(Ct),At=!1),!this.newTiles_&&(At||!this.renderedTiles.includes(tt))&&(this.newTiles_=!0)}if(tt.getAlpha(Ct,t.time)===1)continue}const V=g.getTileCoordChildTileRange(tt.tileCoord,W,F);let J=!1;V&&(J=P(_+1,V)),J||g.forEachTileCoordParentTileRange(tt.tileCoord,P,W,F)}const $=m/o*h/E;Xe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-v/2,-R/2);const z=_l(this.pixelTransform);this.useContainer(e,z,this.getBackground(t));const Z=this.getRenderContext(t),H=this.context.canvas;bo(this.inversePixelTransform,this.pixelTransform),Xe(this.tempTransform,v/2,R/2,$,$,0,-v/2,-R/2),H.width!=v||H.height!=R?(H.width=v,H.height=R):this.containerReused||Z.clearRect(0,0,v,R),w&&this.clipUnrotated(Z,t,w),c.getInterpolate()||(Z.imageSmoothingEnabled=!1),this.preRender(Z,t),this.renderedTiles.length=0;let lt=Object.keys(O).map(Number);lt.sort(On);let k,N,rt;n.opacity===1&&(!this.containerReused||c.getOpaque(t.viewState.projection))?lt=lt.reverse():(k=[],N=[]);for(let Et=lt.length-1;Et>=0;--Et){const A=lt[Et],tt=c.getTilePixelSize(A,h,s),J=g.getResolution(A)/m,Ct=tt[0]*J*$,At=tt[1]*J*$,_t=g.getTileCoordForCoordAndZ(ki(S),A),st=g.getTileCoordExtent(_t),j=Zt(this.tempTransform,[E*(st[0]-S[0])/m,E*(S[3]-st[3])/m]),Yt=E*c.getGutterForProjection(s),we=O[A];for(const Ut in we){const $t=we[Ut],te=$t.tileCoord,Qe=_t[1]-te[1],Ce=Math.round(j[0]-(Qe-1)*Ct),tn=_t[2]-te[2],en=Math.round(j[1]-(tn-1)*At),ut=Math.round(j[0]-Qe*Ct),bt=Math.round(j[1]-tn*At),Nt=Ce-ut,Gt=en-bt,ge=_===A,Ae=ge&&$t.getAlpha(pt(this),t.time)!==1;let Ht=!1;if(!Ae)if(k){rt=[ut,bt,ut+Nt,bt,ut+Nt,bt+Gt,ut,bt+Gt];for(let St=0,Be=k.length;St<Be;++St)if(_!==A&&A<N[St]){const Ft=k[St];fe([ut,bt,ut+Nt,bt+Gt],[Ft[0],Ft[3],Ft[4],Ft[7]])&&(Ht||(Z.save(),Ht=!0),Z.beginPath(),Z.moveTo(rt[0],rt[1]),Z.lineTo(rt[2],rt[3]),Z.lineTo(rt[4],rt[5]),Z.lineTo(rt[6],rt[7]),Z.moveTo(Ft[6],Ft[7]),Z.lineTo(Ft[4],Ft[5]),Z.lineTo(Ft[2],Ft[3]),Z.lineTo(Ft[0],Ft[1]),Z.clip())}k.push(rt),N.push(A)}else Z.clearRect(ut,bt,Nt,Gt);this.drawTileImage($t,t,ut,bt,Nt,Gt,Yt,ge),k&&!Ae?(Ht&&Z.restore(),this.renderedTiles.unshift($t)):this.renderedTiles.push($t),this.updateUsedTiles(t.usedTiles,c,$t)}}return this.renderedRevision=f,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!ui(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,c,g,h,s,y,_,u.getPreload()),this.scheduleExpireCache(t,c),this.postRender(this.context,t),n.extent&&Z.restore(),Z.imageSmoothingEnabled=!0,z!==H.style.transform&&(H.style.transform=z),this.container}drawTileImage(t,e,n,r,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const u=this.getRenderContext(e),c=pt(this),f=e.layerStatesArray[e.layerIndex],g=f.opacity*(l?t.getAlpha(c,e.time):1),_=g!==u.globalAlpha;_&&(u.save(),u.globalAlpha=g),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,r,s,o),_&&u.restore(),g!==f.opacity?e.animate=!0:l&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(r,s,o){const a=pt(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const r=pt(e);r in t||(t[r]={}),t[r][n.getKey()]=!0}manageTilePyramid(t,e,n,r,s,o,a,l,h){const u=pt(e);u in t.wantedTiles||(t.wantedTiles[u]={});const c=t.wantedTiles[u],f=t.tileQueue,g=n.getMinZoom(),_=t.viewState.rotation,m=_?Aa(t.viewState.center,t.viewState.resolution,_,t.size):void 0;let y=0,x,E,v,R,w,I;for(I=g;I<=a;++I)for(E=n.getTileRangeForExtentAndZ(o,I,E),v=n.getResolution(I),R=E.minX;R<=E.maxX;++R)for(w=E.minY;w<=E.maxY;++w)_&&!n.tileCoordIntersectsViewport([I,R,w],m)||(a-I<=l?(++y,x=e.getTile(I,R,w,r,s),x.getState()==q.IDLE&&(c[x.getKey()]=!0,f.isKeyQueued(x.getKey())||f.enqueue([x,u,n.getTileCoordCenter(x.tileCoord),v])),h!==void 0&&h(x)):e.useTile(I,R,w,s));e.updateCacheSize(y,s)}}const hx=lx;class ux extends ax{constructor(t){super(t)}createRenderer(){return new hx(this)}}const Nf=ux;class cx extends Ol{constructor(t,e,n,r,s){const o=s!==void 0?Y.IDLE:Y.LOADED;super(t,e,n,o),this.loader_=s!==void 0?s:null,this.canvas_=r,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=Y.ERROR):this.state=Y.LOADED,this.changed()}load(){this.state==Y.IDLE&&(this.state=Y.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const fx=cx;function $a(i){return Array.isArray(i)?Math.min(...i):i}class dx extends H0{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=J0(t)[0];this.forEach(r=>{r.tileCoord[0]!==n&&(this.remove(Df(r.tileCoord)),r.release())})}}const Gf=dx,ya={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Hi=[0,0,0],qn=5;class gx{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,mt(Vg(this.resolutions_,(r,s)=>s-r,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,mt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ki(n)),mt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,mt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:sl,mt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new Ff(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,r){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=qi(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return qi(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return qi(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(s*l),u=Math.floor(o*l);if(e<r)return qi(h,h,u,u,n);const c=Math.floor(l*(s+1))-1,f=Math.floor(l*(o+1))-1;return qi(h,c,u,f,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Hi);const r=Hi[1],s=Hi[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Hi);const o=Hi[1],a=Hi[2];return qi(r,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=Ie(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=Ie(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*r,a=n[1]-(t[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return hi(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=Ie(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/n/h[0],c=a*(l[1]-e)/n/h[1];return r?(u=ei(u,qn)-1,c=ei(c,qn)-1):(u=Ls(u,qn),c=Ls(c,qn)),Gu(o,u,c,s)}getTileCoordForXYAndZ_(t,e,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=Ie(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return r?(h=ei(h,qn)-1,u=ei(u,qn)-1):(h=Ls(h,qn),u=Ls(u,qn)),Gu(n,h,u,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Eo(this.resolutions_,t,e||0);return Xt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Gc(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n}}const zf=gx;function Xf(i){let t=i.getDefaultTileGrid();return t||(t=px(i),i.setDefaultTileGrid(t)),t}function mx(i,t,e){const n=t[0],r=i.getTileCoordCenter(t),s=nh(e);if(!Fi(s,r)){const o=ft(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return t}function _x(i,t,e,n){n=n!==void 0?n:"top-left";const r=Wf(i,t,e);return new zf({extent:i,origin:_m(i,n),resolutions:r,tileSize:e})}function eh(i){const t=i||{},e=t.extent||Wt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Wf(e,t.maxZoom,t.tileSize,t.maxResolution)};return new zf(n)}function Wf(i,t,e,n){t=t!==void 0?t:rm,e=Ie(e!==void 0?e:sl);const r=Ot(i),s=ft(i);n=n>0?n:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function px(i,t,e,n){const r=nh(i);return _x(r,t,e,n)}function nh(i){i=Wt(i);let t=i.getExtent();if(!t){const e=180*Dr.degrees/i.getMetersPerUnit();t=hi(-e,-e,e,e)}return t}class yx extends cs{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Ie(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Gf(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,r){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let u=n.minX;u<=n.maxX;++u)for(let c=n.minY;c<=n.maxY;++c)l=zo(e,u,c),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===q.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,r,s){return nt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Xf(t)}getTileCacheForProjection(t){const e=this.getProjection();return mt(e===null||Mn(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=Ie(r.getTileSize(t),this.tmpSize);return s==1?o:y_(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=mx(n,t,e)),tx(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,r){}}class xx extends Je{constructor(t,e){super(t),this.tile=e}}const Bf=yx;function Ex(i,t){const e=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(!!o)return i.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],u=t.getFullTileRange(h);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-o[2]-1).toString()})}}function vx(i,t){const e=i.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Ex(i[r],t);return wx(n)}function wx(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const r=Q0(t),s=Mi(r,i.length);return i[s](t,e,n)}}function Cx(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=n;s<=r;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=n;r++)t.push(i.replace(e[0],r.toString()));return t}return t.push(i),t}class ih extends Bf{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ih.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=pt(e),r=e.getState();let s;r==q.LOADING?(this.tileLoadingKeys_[n]=!0,s=ya.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==q.ERROR?ya.TILELOADERROR:r==q.LOADED?ya.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new xx(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Cx(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(vx(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const r=zo(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const Rx=ih;class Sx extends Rx{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Ix,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Pf,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Mn(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Mn(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Mn(e,t)))return this.tileGrid;const n=pt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Xf(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Mn(e,t))return this.tileCache;const n=pt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Gf(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,r,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,u=new this.tileClass(a,h!==void 0?q.IDLE:q.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(et.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,n,r,s){const o=this.getProjection();if(!o||!s||Mn(o,s))return this.getTileInternal(t,e,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,n];let h;const u=Df(l);a.containsKey(u)&&(h=a.get(u));const c=this.getKey();if(h&&h.key==c)return h;const f=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),_=this.getTileCoordForTileUrlFunction(l,s),m=new Ua(o,f,s,g,l,_,this.getTilePixelRatio(r),this.getGutter(),(y,x,E,v)=>this.getTileInternal(y,x,E,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return m.key=c,h?(m.interimTile=h,m.refreshInterimChain(),a.replace(u,m)):a.set(u,m),m}getTileInternal(t,e,n,r,s){let o=null;const a=zo(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,r,s,l),h.getState()==q.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=Wt(t);if(n){const r=pt(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Ix(i,t){i.getImage().src=t}const bx=Sx;class Tx extends bx{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:eh({extent:nh(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const Yf=Tx;class Mx extends Ol{constructor(t,e,n,r,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const u=h?Ai(n,h):n,c=qe(u),f=Za(t,e,c,r),g=Tf,_=new Af(t,e,u,l,f*g,r),m=_.calculateSourceExtent(),y=gr(m)?null:o(m,f,s),x=y?Y.IDLE:Y.EMPTY,E=y?y.getPixelRatio():1;super(n,r,E,x),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=_,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=y,this.sourcePixelRatio_=E,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Y.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==Y.LOADED){const e=ft(this.targetExtent_)/this.targetResolution_,n=Ot(this.targetExtent_)/this.targetResolution_;this.canvas_=Lf(e,n,this.sourcePixelRatio_,$a(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==Y.IDLE){this.state=Y.LOADING,this.changed();const t=this.sourceImage_.getState();t==Y.LOADED||t==Y.ERROR?this.reproject_():(this.sourceListenerKey_=dt(this.sourceImage_,et.CHANGE,function(e){const n=this.sourceImage_.getState();(n==Y.LOADED||n==Y.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){Rt(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Ax=Mx,Xs=4,xa={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Lx extends Je{constructor(t,e){super(t),this.image=e}}class Px extends cs{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=Eo(e,t,0);t=e[n]}return t}getImage(t,e,n,r){const s=this.getProjection();if(!s||!r||Mn(s,r))return s&&(r=s),this.getImageInternal(t,e,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Mn(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&ui(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ax(s,r,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,r){if(this.loader){const s=Ox(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&An(this.wantedExtent_,s)||An(this.image.getExtent(),s))&&(this.wantedResolution_&&$a(this.wantedResolution_)===o||$a(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Ol(s,o,n,this.loader),this.image.addEventListener(et.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case Y.LOADING:this.loading=!0,n=xa.IMAGELOADSTART;break;case Y.LOADED:this.loading=!1,n=xa.IMAGELOADEND;break;case Y.ERROR:this.loading=!1,n=xa.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Lx(n,e))}}function Ox(i,t,e,n){const r=t/e,s=qe(i),o=ei(ft(i)/r,Xs),a=ei(Ot(i)/r,Xs),l=ei((n-1)*o/2,Xs),h=o+2*l,u=ei((n-1)*a/2,Xs),c=a+2*u;return qs(s,r,0,[h,c])}const Zf=Px,Fx='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Dx extends Yf{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[Fx];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",r=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:r,wrapX:t.wrapX,zDirection:t.zDirection})}}const kx=Dx;let Uf=!0;try{new ImageData(10,10)}catch{Uf=!1}let Ea;function Nx(i,t,e){if(Uf)return new ImageData(i,t,e);Ea||(Ea=document.createElement("canvas").getContext("2d"));const n=Ea.createImageData(t,e);return n.data.set(i),n}function $f(i){let t=!0;try{new ImageData(10,10)}catch{t=!1}function e(n,r,s){return t?new ImageData(n,r,s):{data:n,width:r,height:s}}return function(n){const r=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,h=r.length,u=r[0].byteLength;if(o){const _=new Array(h);for(let y=0;y<h;++y)_[y]=e(new Uint8ClampedArray(r[y]),a,l);return i(_,s).data.buffer}const c=new Uint8ClampedArray(u),f=new Array(h),g=new Array(h);for(let _=0;_<h;++_)f[_]=new Uint8ClampedArray(r[_]),g[_]=[0,0,0,0];for(let _=0;_<u;_+=4){for(let y=0;y<h;++y){const x=f[y];g[y][0]=x[_],g[y][1]=x[_+1],g[y][2]=x[_+2],g[y][3]=x[_+3]}const m=i(g,s);c[_]=m[0],c[_+1]=m[1],c[_+2]=m[2],c[_+3]=m[3]}return c.buffer}}function Gx(i,t){const n=Object.keys(i.lib||{}).map(function(s){return"const "+s+" = "+i.lib[s].toString()+";"}).concat(["const __minion__ = ("+$f.toString()+")(",i.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return r.addEventListener("message",t),r}function zx(i,t){const e=$f(i.operation);let n=!1;return{postMessage:function(r){setTimeout(function(){n||t({data:{buffer:e(r),meta:r.meta}})},0)},terminate:function(){n=!0}}}class Xx extends xo{constructor(t){super(),this._imageOps=!!t.imageOps;let e;t.threads===0?e=0:this._imageOps?e=1:e=t.threads||1;const n=new Array(e);if(e)for(let r=0;r<e;++r)n[r]=Gx(t,this._onWorkerMessage.bind(this,r));else n[0]=zx(t,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,e,n){this._enqueue({inputs:t,meta:e,callback:n}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const e=t.inputs[0].width,n=t.inputs[0].height,r=t.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:r,meta:t.meta,imageOps:this._imageOps,width:e,height:n},r);return}const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const h=l*a,u=[];for(let c=0,f=r.length;c<f;++c)u.push(r[c].slice(h,h+a));this._workers[l].postMessage({buffers:u,meta:t.meta,imageOps:this._imageOps,width:e,height:n},u)}}_onWorkerMessage(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,e=this._workers.length;let n,r;if(e===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{const s=t.inputs[0].data.length;n=new Uint8ClampedArray(s),r=new Array(e);const o=4*Math.ceil(s/4/e);for(let a=0;a<e;++a){const l=this._dataLookup[a].buffer,h=a*o;n.set(new Uint8ClampedArray(l),h),r[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,Nx(n,t.inputs[0].width,t.inputs[0].height),r),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const zu={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Xu extends Je{constructor(t,e,n){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=n}}class Kf extends Zf{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=Yx(t.sources);const e=this.changed.bind(this);for(let n=0,r=this.layers_.length;n<r;++n)this.layers_[n].addEventListener(et.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new ff(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Me(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:Bx(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Me(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:pt(this),renderTargets:{}},this.setAttributions(function(n){const r=[];for(let s=0,o=t.sources.length;s<o;++s){const a=t.sources[s],l=a instanceof cs?a:a.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const u=h(n);r.push.apply(r,u)}}return r.length!==0?r:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new Xx({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,n){const r=Object.assign({},this.frameState_);r.viewState=Object.assign({},r.viewState);const s=qe(t);r.size[0]=Math.ceil(ft(t)/e),r.size[1]=Math.ceil(Ot(t)/e),r.extent=[s[0]-r.size[0]*e/2,s[1]-r.size[1]*e/2,s[0]+r.size[0]*e/2,s[1]+r.size[1]*e/2],r.time=Date.now();const o=r.viewState;return o.center=s,o.projection=n,o.resolution=e,r}allSourcesReady_(){let t=!0,e;for(let n=0,r=this.layers_.length;n<r;++n)if(e=this.layers_[n].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,n,r){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const s=this.updateFrameState_(t,e,r);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!ui(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,n=new Array(e);for(let s=0;s<e;++s){t.layerIndex=s,t.renderTargets={};const o=Wx(this.layers_[s],t);if(o)n[s]=o;else return}const r={};this.dispatchEvent(new Xu(zu.BEFOREOPERATIONS,t,r)),this.processor_.process(n,r,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,n,r){if(e||!n)return;const s=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ui(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(ft(s)/o),h=Math.round(Ot(s)/o);a=Bt(l,h),this.renderedImageCanvas_=new fx(s,o,1,a.canvas)}a.putImageData(n,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Xu(zu.AFTEROPERATIONS,t,r))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let n=0,r=this.layers_.length;n<r&&(e=this.layers_[n].getSource().getResolutions(t),!e);++n);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Kf.prototype.dispose;let vi=null;function Wx(i,t){const e=i.getRenderer();if(!e)throw new Error("Unsupported layer type: "+i);if(!e.prepareFrame(t))return null;const n=t.size[0],r=t.size[1];if(n===0||r===0)return null;const s=e.renderFrame(t,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===r)return o.getContext("2d").getImageData(0,0,n,r)}if(!vi)vi=Bt(n,r,void 0,{willReadFrequently:!0});else{const a=vi.canvas;a.width!==n||a.height!==r?vi=Bt(n,r,void 0,{willReadFrequently:!0}):vi.clearRect(0,0,n,r)}return vi.drawImage(o,0,0,n,r),vi.getImageData(0,0,n,r)}function Bx(i){return i.map(function(t){return t.getLayerState()})}function Yx(i){const t=i.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=Zx(i[n]);return e}function Zx(i){let t;return i instanceof cs?i instanceof Bf?t=new Nf({source:i}):i instanceof Zf&&(t=new kf({source:i})):t=i,t}const Ux=Kf;var $x;Array.prototype.remove=function(i){if(this.indexOf(i)==-1)throw console.log(this),console.log(i),console.log(this.includes($x.start)),"Please comment if you see this error";return this.splice(this.indexOf(i),1),this};Array.prototype.includes=function(i){return this.indexOf(i)!=-1};function Kx(i,t,e,n){let r=Math.abs(i.x-t.x),s=Math.abs(i.y-t.y);return n.dictZoomPixelLen.get(e)*(r+s+(Math.sqrt(2)-2)*Math.min(r,s))}function jx(i,t,e,n,r,s){let o=i.h-t[0].h;o=Math.abs(o)*r;let a;return t[1]==1?a=Math.sqrt(Math.pow(e.get(n),2)+o*o):a=Math.sqrt(Math.pow(e.get(n)*Math.sqrt(2),2)+o*o),t[0].isForest&&(a+=s*e.get(n)),i.gScore+a}class Vx{constructor(t,e,n,r,s,o,a){pe(this,"columns",0);pe(this,"rows",0);pe(this,"cameFrom",new Map);pe(this,"dictZoomPixelLen",new Map);pe(this,"openSet",[]);pe(this,"closedSet",[]);pe(this,"start",[]);pe(this,"end",[]);pe(this,"_arr",[]);pe(this,"at",function(t,e){return e===void 0?this._arr[t[0]][t[1]]:this._arr[t][e]});pe(this,"lowest_f",function(){let t=this.openSet[0];for(let e of this.openSet)t.fScore>e.fScore&&(t=e);return t});pe(this,"reset",function(){this.openSet=[this.start],this.cameFrom.clear(),this.closedSet=[];for(let t of this._arr)for(let e of t)e.gScore=1/0,e.fScore=0;this.start.visited=!0,this.start.gScore=0});this.columns=t,this.rows=e,this.cameFrom=new Map,this.dictZoomPixelLen.set(15,4.7773),this.dictZoomPixelLen.set(14,9.5546),this.dictZoomPixelLen.set(13,19.1093),this.dictZoomPixelLen.set(12,38.2185),this.dictZoomPixelLen.set(11,76.437),this.dictZoomPixelLen.set(10,152.8741),this.dictZoomPixelLen.set(9,305.7481),this.dictZoomPixelLen.set(8,611.4962),this.dictZoomPixelLen.set(7,1222.9925),this.dictZoomPixelLen.set(6,2445.9849),this.dictZoomPixelLen.set(5,4891.9698),this.dictZoomPixelLen.set(4,9783.9396),this.dictZoomPixelLen.set(3,19567.8792),this.dictZoomPixelLen.set(2,39135.7585),this.dictZoomPixelLen.set(1,78271.5169),this.openSet=[],this.closedSet=[];let l=0;for(let h=0;h<t;h++){let u=[];for(let c=0;c<e;c++){let f=new qx(h,c,s[c][h],++l,o[c][h],a[c][h]);h==n[0]&&c==n[1]&&(f.is_start=!0),h==r[0]&&c==r[1]&&(f.is_end=!0),u.push(f)}this._arr.push(u)}this.start=this._arr[n[0]][n[1]],this.start.is_start=!0,this.start.visited=!0,this.start.gScore=0,this.openSet.push(this.start),this.end=this._arr[r[0]][r[1]],this.end.is_end=!0}}function qx(i,t,e,n,r,s){this.x=i,this.y=t,this.h=e,this.id=n,this.isWater=r,this.isForest=s,this.isObstacle=r,this.gScore=1/0,this.fScore=0,this.get_id=function(){return this.id},this.neighbors=function(o){let a=[];return this.x<o.columns-1&&a.push([o.at(this.x+1,this.y),1]),this.x>0&&a.push([o.at(this.x-1,this.y),1]),this.y>0&&a.push([o.at(this.x,this.y-1),1]),this.y<o.rows-1&&a.push([o.at(this.x,this.y+1),1]),this.y<o.rows-1&&this.x<o.columns-1&&a.push([o.at(this.x+1,this.y+1),0]),this.y>0&&this.x>0&&a.push([o.at(this.x-1,this.y-1),0]),this.y<o.rows-1&&this.x>0&&a.push([o.at(this.x-1,this.y+1),0]),this.y>0&&this.x<o.columns-1&&a.push([o.at(this.x+1,this.y-1),0]),a}}function Wu(i,t){let e=[];for(;t.get(i);)e.push(i),i=t.get(i);return e}function Hx(i,t,e,n){for(;i.openSet.length;){let r=i.lowest_f();if(r==i.end){let s=Wu(r,i.cameFrom);return s.push(i.start),s}i.openSet.remove(r),i.closedSet.push(r);for(let s of r.neighbors(i)){if(s[0]==i.end){let a=Wu(r,i.cameFrom);return a.push(i.start),a}if(i.closedSet.includes(s[0])||s[0].isObstacle||s[0].isForest&&n==3)continue;i.openSet.includes(s[0])||i.openSet.push(s[0]);let o=jx(r,s,i.dictZoomPixelLen,t,e,n);o>=s[0].gScore||(i.cameFrom.set(s[0],r),s[0].gScore=o,s[0].fScore=s[0].gScore+Kx(s[0],i.end,t,i))}}return[]}class Jx{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=yr,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?Wt(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=Wt(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return nt()}readFeature(t,e){return nt()}readFeatures(t,e){return nt()}readGeometry(t,e){return nt()}readProjection(t){return nt()}writeFeature(t,e){return nt()}writeFeatures(t,e){return nt()}writeGeometry(t,e){return nt()}}function rh(i,t,e){const n=e?Wt(e.featureProjection):null,r=e?Wt(e.dataProjection):null;let s=i;if(n&&r&&!Mn(n,r)){t&&(s=i.clone());const o=t?n:r,a=t?r:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(Nr(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,u=l.length;h<u;++h)l[h]=Math.round(l[h]*o)/o;return l};s===i&&(s=i.clone()),s.applyTransform(a)}return s}const Qx={Point:zr,LineString:Hr,Polygon:Wr,MultiPoint:If,MultiLineString:D0,MultiPolygon:k0};function tE(i,t,e){return Array.isArray(t[0])?(Xc(i,0,t,e)||(i=i.slice(),Fa(i,0,t,e)),i):(Il(i,0,t,e)||(i=i.slice(),Qs(i,0,t,e)),i)}function jf(i,t){var s;const e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(o=>jf({...i,geometry:o})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const r=e.layout.length;return rh(new bn(n,n==="Polygon"?tE(e.flatCoordinates,e.ends,r):e.flatCoordinates,(s=e.ends)==null?void 0:s.flat(),r,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function sh(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(r=>sh(r,t));return new F0(n)}const e=Qx[i.type];return rh(new e(i.flatCoordinates,i.layout,i.ends),!1,t)}class eE extends Jx{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Ws(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Ws(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return nt()}readFeaturesFromObject(t,e){return nt()}readGeometry(t,e){return this.readGeometryFromObject(Ws(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return nt()}readProjection(t){return this.readProjectionFromObject(Ws(t))}readProjectionFromObject(t){return nt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return nt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return nt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return nt()}}function Ws(i){if(typeof i=="string"){const t=JSON.parse(i);return t||null}return i!==null?i:null}const nE=eE;class iE extends nE{constructor(t){t=t||{},super(),this.dataProjection=Wt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Wt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const r=oh(n.geometry);if(this.featureClass===bn)return jf({geometry:r,id:n.id,properties:n.properties},e);const s=new yr;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(sh(r,e)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(t,e){const n=t;let r=null;if(n.type==="FeatureCollection"){const s=t;r=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);!h||r.push(h)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return rE(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=Wt(e.properties.name);else if(e.type==="EPSG")n=Wt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(n.id=r),!t.hasProperties())return n;const s=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=Ka(o,e),delete s[t.getGeometryName()]),Oi(s)||(n.properties=s),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let r=0,s=t.length;r<s;++r)n.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Ka(t,this.adaptOptions(e))}}function oh(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=oE(i);break}case"LineString":{e=aE(i);break}case"Polygon":{e=cE(i);break}case"MultiPoint":{e=hE(i);break}case"MultiLineString":{e=lE(i);break}case"MultiPolygon":{e=uE(i);break}case"GeometryCollection":{e=sE(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function rE(i,t){const e=oh(i);return sh(e,t)}function sE(i,t){return i.geometries.map(function(n){return oh(n)})}function oE(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:Ni(t.length)}}function aE(i){var n;const t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:Ni(((n=t[0])==null?void 0:n.length)||2)}}function lE(i){var s,o;const t=i.coordinates,e=((o=(s=t[0])==null?void 0:s[0])==null?void 0:o.length)||2,n=[],r=rs(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:r,layout:Ni(e)}}function hE(i){var e;const t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:Ni(((e=t[0])==null?void 0:e.length)||2)}}function uE(i){var s,o;const t=i.coordinates,e=[],n=((o=(s=t[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,r=Pc(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:r,layout:Ni(n)}}function cE(i){var s,o;const t=i.coordinates,e=[],n=(o=(s=t[0])==null?void 0:s[0])==null?void 0:o.length,r=rs(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:r,layout:Ni(n)}}function Ka(i,t){i=rh(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=pE(i);break}case"LineString":{n=dE(i);break}case"Polygon":{n=yE(i,t);break}case"MultiPoint":{n=mE(i);break}case"MultiLineString":{n=gE(i);break}case"MultiPolygon":{n=_E(i,t);break}case"GeometryCollection":{n=fE(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function fE(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return Ka(n,t)})}}function dE(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function gE(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function mE(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function _E(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function pE(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function yE(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}const xE=iE;var re=63710088e-1,ah={centimeters:re*100,centimetres:re*100,degrees:re/111325,feet:re*3.28084,inches:re*39.37,kilometers:re/1e3,kilometres:re/1e3,meters:re,metres:re,miles:re/1609.344,millimeters:re*1e3,millimetres:re*1e3,nauticalmiles:re/1852,radians:1,yards:re*1.0936},EE={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/re,yards:1.0936133},ja={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function We(i,t,e){e===void 0&&(e={});var n={type:"Feature"};return(e.id===0||e.id)&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.properties=t||{},n.geometry=i,n}function vE(i,t,e){switch(i){case"Point":return Ee(t).geometry;case"LineString":return de(t).geometry;case"Polygon":return Xo(t).geometry;case"MultiPoint":return qf(t).geometry;case"MultiLineString":return Vf(t).geometry;case"MultiPolygon":return lh(t).geometry;default:throw new Error(i+" is invalid")}}function Ee(i,t,e){if(e===void 0&&(e={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!co(i[0])||!co(i[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:i};return We(n,t,e)}function wE(i,t,e){return e===void 0&&(e={}),Ge(i.map(function(n){return Ee(n,t)}),e)}function Xo(i,t,e){e===void 0&&(e={});for(var n=0,r=i;n<r.length;n++){var s=r[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<s[s.length-1].length;o++)if(s[s.length-1][o]!==s[0][o])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:i};return We(a,t,e)}function CE(i,t,e){return e===void 0&&(e={}),Ge(i.map(function(n){return Xo(n,t)}),e)}function de(i,t,e){if(e===void 0&&(e={}),i.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:i};return We(n,t,e)}function RE(i,t,e){return e===void 0&&(e={}),Ge(i.map(function(n){return de(n,t)}),e)}function Ge(i,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=i,e}function Vf(i,t,e){e===void 0&&(e={});var n={type:"MultiLineString",coordinates:i};return We(n,t,e)}function qf(i,t,e){e===void 0&&(e={});var n={type:"MultiPoint",coordinates:i};return We(n,t,e)}function lh(i,t,e){e===void 0&&(e={});var n={type:"MultiPolygon",coordinates:i};return We(n,t,e)}function SE(i,t,e){e===void 0&&(e={});var n={type:"GeometryCollection",geometries:i};return We(n,t,e)}function IE(i,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var e=Math.pow(10,t||0);return Math.round(i*e)/e}function hh(i,t){t===void 0&&(t="kilometers");var e=ah[t];if(!e)throw new Error(t+" units is invalid");return i*e}function Wo(i,t){t===void 0&&(t="kilometers");var e=ah[t];if(!e)throw new Error(t+" units is invalid");return i/e}function bE(i,t){return Jr(Wo(i,t))}function TE(i){var t=i%360;return t<0&&(t+=360),t}function Jr(i){var t=i%(2*Math.PI);return t*180/Math.PI}function De(i){var t=i%360;return t*Math.PI/180}function ME(i,t,e){if(t===void 0&&(t="kilometers"),e===void 0&&(e="kilometers"),!(i>=0))throw new Error("length must be a positive number");return hh(Wo(i,t),e)}function AE(i,t,e){if(t===void 0&&(t="meters"),e===void 0&&(e="kilometers"),!(i>=0))throw new Error("area must be a positive number");var n=ja[t];if(!n)throw new Error("invalid original units");var r=ja[e];if(!r)throw new Error("invalid final units");return i/n*r}function co(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function uh(i){return!!i&&i.constructor===Object}function LE(i){if(!i)throw new Error("bbox is required");if(!Array.isArray(i))throw new Error("bbox must be an Array");if(i.length!==4&&i.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");i.forEach(function(t){if(!co(t))throw new Error("bbox must only contain numbers")})}function PE(i){if(!i)throw new Error("id is required");if(["string","number"].indexOf(typeof i)===-1)throw new Error("id must be a number or a string")}const OE=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:re,factors:ah,unitsFactors:EE,areaFactors:ja,feature:We,geometry:vE,point:Ee,points:wE,polygon:Xo,polygons:CE,lineString:de,lineStrings:RE,featureCollection:Ge,multiLineString:Vf,multiPoint:qf,multiPolygon:lh,geometryCollection:SE,round:IE,radiansToLength:hh,lengthToRadians:Wo,lengthToDegrees:bE,bearingToAzimuth:TE,radiansToDegrees:Jr,degreesToRadians:De,convertLength:ME,convertArea:AE,isNumber:co,isObject:uh,validateBBox:LE,validateId:PE},Symbol.toStringTag,{value:"Module"}));function zi(i,t,e){if(i!==null)for(var n,r,s,o,a,l,h,u=0,c=0,f,g=i.type,_=g==="FeatureCollection",m=g==="Feature",y=_?i.features.length:1,x=0;x<y;x++){h=_?i.features[x].geometry:m?i.geometry:i,f=h?h.type==="GeometryCollection":!1,a=f?h.geometries.length:1;for(var E=0;E<a;E++){var v=0,R=0;if(o=f?h.geometries[E]:h,o!==null){l=o.coordinates;var w=o.type;switch(u=e&&(w==="Polygon"||w==="MultiPolygon")?1:0,w){case null:break;case"Point":if(t(l,c,x,v,R)===!1)return!1;c++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(t(l[n],c,x,v,R)===!1)return!1;c++,w==="MultiPoint"&&v++}w==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-u;r++){if(t(l[n][r],c,x,v,R)===!1)return!1;c++}w==="MultiLineString"&&v++,w==="Polygon"&&R++}w==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(R=0,r=0;r<l[n].length;r++){for(s=0;s<l[n][r].length-u;s++){if(t(l[n][r][s],c,x,v,R)===!1)return!1;c++}R++}v++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(zi(o.geometries[n],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function FE(i,t,e,n){var r=e;return zi(i,function(s,o,a,l,h){o===0&&e===void 0?r=s:r=t(r,s,o,a,l,h)},n),r}function Hf(i,t){var e;switch(i.type){case"FeatureCollection":for(e=0;e<i.features.length&&t(i.features[e].properties,e)!==!1;e++);break;case"Feature":t(i.properties,0);break}}function DE(i,t,e){var n=e;return Hf(i,function(r,s){s===0&&e===void 0?n=r:n=t(n,r,s)}),n}function dr(i,t){if(i.type==="Feature")t(i,0);else if(i.type==="FeatureCollection")for(var e=0;e<i.features.length&&t(i.features[e],e)!==!1;e++);}function Jf(i,t,e){var n=e;return dr(i,function(r,s){s===0&&e===void 0?n=r:n=t(n,r,s)}),n}function kE(i){var t=[];return zi(i,function(e){t.push(e)}),t}function ch(i,t){var e,n,r,s,o,a,l,h,u,c,f=0,g=i.type==="FeatureCollection",_=i.type==="Feature",m=g?i.features.length:1;for(e=0;e<m;e++){for(a=g?i.features[e].geometry:_?i.geometry:i,h=g?i.features[e].properties:_?i.properties:{},u=g?i.features[e].bbox:_?i.bbox:void 0,c=g?i.features[e].id:_?i.id:void 0,l=a?a.type==="GeometryCollection":!1,o=l?a.geometries.length:1,r=0;r<o;r++){if(s=l?a.geometries[r]:a,s===null){if(t(null,f,h,u,c)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,f,h,u,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(t(s.geometries[n],f,h,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}f++}}function NE(i,t,e){var n=e;return ch(i,function(r,s,o,a,l){s===0&&e===void 0?n=r:n=t(n,r,s,o,a,l)}),n}function Xi(i,t){ch(i,function(e,n,r,s,o){var a=e===null?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(We(e,r,{bbox:s,id:o}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var h=0;h<e.coordinates.length;h++){var u=e.coordinates[h],c={type:l,coordinates:u};if(t(We(c,r),n,h)===!1)return!1}})}function GE(i,t,e){var n=e;return Xi(i,function(r,s,o){s===0&&o===0&&e===void 0?n=r:n=t(n,r,s,o)}),n}function Qf(i,t){Xi(i,function(e,n,r){var s=0;if(!!e.geometry){var o=e.geometry.type;if(!(o==="Point"||o==="MultiPoint")){var a,l=0,h=0,u=0;if(zi(e,function(c,f,g,_,m){if(a===void 0||n>l||_>h||m>u){a=c,l=n,h=_,u=m,s=0;return}var y=de([a,c],e.properties);if(t(y,n,r,m,s)===!1)return!1;s++,a=c})===!1)return!1}}})}function zE(i,t,e){var n=e,r=!1;return Qf(i,function(s,o,a,l,h){r===!1&&e===void 0?n=s:n=t(n,s,o,a,l,h),r=!0}),n}function td(i,t){if(!i)throw new Error("geojson is required");Xi(i,function(e,n,r){if(e.geometry!==null){var s=e.geometry.type,o=e.geometry.coordinates;switch(s){case"LineString":if(t(e,n,r,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<o.length;a++)if(t(de(o[a],e.properties),n,r,a)===!1)return!1;break}}})}function XE(i,t,e){var n=e;return td(i,function(r,s,o,a){s===0&&e===void 0?n=r:n=t(n,r,s,o,a)}),n}function WE(i,t){if(t=t||{},!uh(t))throw new Error("options is invalid");var e=t.featureIndex||0,n=t.multiFeatureIndex||0,r=t.geometryIndex||0,s=t.segmentIndex||0,o=t.properties,a;switch(i.type){case"FeatureCollection":e<0&&(e=i.features.length+e),o=o||i.features[e].properties,a=i.features[e].geometry;break;case"Feature":o=o||i.properties,a=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=i;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),de([l[s],l[s+1]],o,t);case"Polygon":return r<0&&(r=l.length+r),s<0&&(s=l[r].length+s-1),de([l[r][s],l[r][s+1]],o,t);case"MultiLineString":return n<0&&(n=l.length+n),s<0&&(s=l[n].length+s-1),de([l[n][s],l[n][s+1]],o,t);case"MultiPolygon":return n<0&&(n=l.length+n),r<0&&(r=l[n].length+r),s<0&&(s=l[n][r].length-s-1),de([l[n][r][s],l[n][r][s+1]],o,t)}throw new Error("geojson is invalid")}function BE(i,t){if(t=t||{},!uh(t))throw new Error("options is invalid");var e=t.featureIndex||0,n=t.multiFeatureIndex||0,r=t.geometryIndex||0,s=t.coordIndex||0,o=t.properties,a;switch(i.type){case"FeatureCollection":e<0&&(e=i.features.length+e),o=o||i.features[e].properties,a=i.features[e].geometry;break;case"Feature":o=o||i.properties,a=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=i;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return Ee(l,o,t);case"MultiPoint":return n<0&&(n=l.length+n),Ee(l[n],o,t);case"LineString":return s<0&&(s=l.length+s),Ee(l[s],o,t);case"Polygon":return r<0&&(r=l.length+r),s<0&&(s=l[r].length+s),Ee(l[r][s],o,t);case"MultiLineString":return n<0&&(n=l.length+n),s<0&&(s=l[n].length+s),Ee(l[n][s],o,t);case"MultiPolygon":return n<0&&(n=l.length+n),r<0&&(r=l[n].length+r),s<0&&(s=l[n][r].length-s),Ee(l[n][r][s],o,t)}throw new Error("geojson is invalid")}const YE=Object.freeze(Object.defineProperty({__proto__:null,coordAll:kE,coordEach:zi,coordReduce:FE,featureEach:dr,featureReduce:Jf,findPoint:BE,findSegment:WE,flattenEach:Xi,flattenReduce:GE,geomEach:ch,geomReduce:NE,lineEach:td,lineReduce:XE,propEach:Hf,propReduce:DE,segmentEach:Qf,segmentReduce:zE},Symbol.toStringTag,{value:"Module"}));function fo(i){var t=[1/0,1/0,-1/0,-1/0];return zi(i,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}fo.default=fo;const ZE=Object.freeze(Object.defineProperty({__proto__:null,default:fo},Symbol.toStringTag,{value:"Module"}));function ai(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kn(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bu(i){return i.type==="Feature"?i.geometry:i}function Yu(i,t){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}const UE=Go(p_);function Ci(i,t,e){e===void 0&&(e={});var n=ai(i),r=ai(t),s=De(r[1]-n[1]),o=De(r[0]-n[0]),a=De(n[1]),l=De(r[1]),h=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(l);return hh(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),e.units)}function $E(i){var t=i[0],e=i[1],n=i[2],r=i[3],s=Ci(i.slice(0,2),[n,e]),o=Ci(i.slice(0,2),[t,r]);if(s>=o){var a=(e+r)/2;return[t,a-(n-t)/2,n,a+(n-t)/2]}else{var l=(t+n)/2;return[l-(r-e)/2,e,l+(r-e)/2,r]}}function Zu(i,t,e,n){n===void 0&&(n={});var r=ai(i),s=De(r[0]),o=De(r[1]),a=De(e),l=Wo(t,n.units),h=Math.asin(Math.sin(o)*Math.cos(l)+Math.cos(o)*Math.sin(l)*Math.cos(a)),u=s+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(o),Math.cos(l)-Math.sin(o)*Math.sin(h)),c=Jr(u),f=Jr(h);return Ee([c,f],n.properties)}function ed(i,t,e){if(e===void 0&&(e={}),e.final===!0)return KE(i,t);var n=ai(i),r=ai(t),s=De(n[0]),o=De(r[0]),a=De(n[1]),l=De(r[1]),h=Math.sin(o-s)*Math.cos(l),u=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(o-s);return Jr(Math.atan2(h,u))}function KE(i,t){var e=ed(t,i);return e=(e+180)%360,e}function Va(i){if(!i)throw new Error("geojson is required");var t=[];return Xi(i,function(e){jE(e,t)}),Ge(t)}function jE(i,t){var e=[],n=i.geometry;if(n!==null){switch(n.type){case"Polygon":e=kn(n);break;case"LineString":e=[kn(n)]}e.forEach(function(r){var s=VE(r,i.properties);s.forEach(function(o){o.id=t.length,t.push(o)})})}}function VE(i,t){var e=[];return i.reduce(function(n,r){var s=de([n,r],t);return s.bbox=qE(n,r),e.push(s),r}),e}function qE(i,t){var e=i[0],n=i[1],r=t[0],s=t[1],o=e<r?e:r,a=n<s?n:s,l=e>r?e:r,h=n>s?n:s;return[o,a,l,h]}var fs={exports:{}};const HE=Go(OE),JE=Go(YE),QE=Go(ZE);var ln=UE,nd=HE,id=JE,Ji=QE.default,t1=id.featureEach;id.coordEach;nd.polygon;var Uu=nd.featureCollection;function rd(i){var t=new ln(i);return t.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:Ji(e),ln.prototype.insert.call(this,e)},t.load=function(e){var n=[];return Array.isArray(e)?e.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Ji(r),n.push(r)}):t1(e,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Ji(r),n.push(r)}),ln.prototype.load.call(this,n)},t.remove=function(e,n){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:Ji(e),ln.prototype.remove.call(this,e,n)},t.clear=function(){return ln.prototype.clear.call(this)},t.search=function(e){var n=ln.prototype.search.call(this,this.toBBox(e));return Uu(n)},t.collides=function(e){return ln.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=ln.prototype.all.call(this);return Uu(e)},t.toJSON=function(){return ln.prototype.toJSON.call(this)},t.fromJSON=function(e){return ln.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var n;if(e.bbox)n=e.bbox;else if(Array.isArray(e)&&e.length===4)n=e;else if(Array.isArray(e)&&e.length===6)n=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")n=Ji(e);else if(e.type==="FeatureCollection")n=Ji(e);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},t}fs.exports=rd;fs.exports.default=rd;function sd(i,t){var e={},n=[];if(i.type==="LineString"&&(i=We(i)),t.type==="LineString"&&(t=We(t)),i.type==="Feature"&&t.type==="Feature"&&i.geometry!==null&&t.geometry!==null&&i.geometry.type==="LineString"&&t.geometry.type==="LineString"&&i.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var r=$u(i,t);return r&&n.push(r),Ge(n)}var s=fs.exports();return s.load(Va(t)),dr(Va(i),function(o){dr(s.search(o),function(a){var l=$u(o,a);if(l){var h=kn(l).join(",");e[h]||(e[h]=!0,n.push(l))}})}),Ge(n)}function $u(i,t){var e=kn(i),n=kn(t);if(e.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=e[0][0],s=e[0][1],o=e[1][0],a=e[1][1],l=n[0][0],h=n[0][1],u=n[1][0],c=n[1][1],f=(c-h)*(o-r)-(u-l)*(a-s),g=(u-l)*(s-h)-(c-h)*(r-l),_=(o-r)*(s-h)-(a-s)*(r-l);if(f===0)return g===0&&_===0,null;var m=g/f,y=_/f;if(m>=0&&m<=1&&y>=0&&y<=1){var x=r+m*(o-r),E=s+m*(a-s);return Ee([x,E])}return null}function e1(i,t,e){e===void 0&&(e={});var n=Ee([1/0,1/0],{dist:1/0}),r=0;return Xi(i,function(s){for(var o=kn(s),a=0;a<o.length-1;a++){var l=Ee(o[a]);l.properties.dist=Ci(t,l,e);var h=Ee(o[a+1]);h.properties.dist=Ci(t,h,e);var u=Ci(l,h,e),c=Math.max(l.properties.dist,h.properties.dist),f=ed(l,h),g=Zu(t,c,f+90,e),_=Zu(t,c,f-90,e),m=sd(de([g.geometry.coordinates,_.geometry.coordinates]),de([l.geometry.coordinates,h.geometry.coordinates])),y=null;m.features.length>0&&(y=m.features[0],y.properties.dist=Ci(t,y,e),y.properties.location=r+Ci(l,y,e)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=r),h.properties.dist<n.properties.dist&&(n=h,n.properties.index=a+1,n.properties.location=r+u),y&&y.properties.dist<n.properties.dist&&(n=y,n.properties.index=a),r+=u}}),n}function n1(i,t){t===void 0&&(t={});var e=t.precision,n=t.coordinates,r=t.mutate;if(e=e==null||isNaN(e)?6:e,n=n==null||isNaN(n)?3:n,!i)throw new Error("<geojson> is required");if(typeof e!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(r===!1||r===void 0)&&(i=JSON.parse(JSON.stringify(i)));var s=Math.pow(10,e);return zi(i,function(o){i1(o,s,n)}),i}function i1(i,t,e){i.length>e&&i.splice(e,i.length);for(var n=0;n<i.length;n++)i[n]=Math.round(i[n]*t)/t;return i}function r1(i,t){if(!i)throw new Error("line is required");if(!t)throw new Error("splitter is required");var e=Yu(i),n=Yu(t);if(e!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var r=n1(t,{precision:7});switch(n){case"Point":return qa(i,r);case"MultiPoint":return Ku(i,r);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ku(i,sd(i,r))}}function Ku(i,t){var e=[],n=fs.exports();return Xi(t,function(r){if(e.forEach(function(a,l){a.id=l}),!e.length)e=qa(i,r).features,e.forEach(function(a){a.bbox||(a.bbox=$E(fo(a)))}),n.load(Ge(e));else{var s=n.search(r);if(s.features.length){var o=od(r,s);e=e.filter(function(a){return a.id!==o.id}),n.remove(o),dr(qa(o,r),function(a){e.push(a),n.insert(a)})}}}),Ge(e)}function qa(i,t){var e=[],n=kn(i)[0],r=kn(i)[i.geometry.coordinates.length-1];if(va(n,ai(t))||va(r,ai(t)))return Ge([i]);var s=fs.exports(),o=Va(i);s.load(o);var a=s.search(t);if(!a.features.length)return Ge([i]);var l=od(t,a),h=[n],u=Jf(o,function(c,f,g){var _=kn(f)[1],m=ai(t);return g===l.id?(c.push(m),e.push(de(c)),va(m,_)?[m]:[m,_]):(c.push(_),c)},h);return u.length>1&&e.push(de(u)),Ge(e)}function od(i,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var e,n=1/0;return dr(t,function(r){var s=e1(r,i),o=s.properties.dist;o<n&&(e=r,n=o)}),e}function va(i,t){return i[0]===t[0]&&i[1]===t[1]}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function s1(i,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return l([h,u])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,r&&(s=h[0]&2?r.return:h[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,h[1])).done)return s;switch(r=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,r=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){e.label=h[1];break}if(h[0]===6&&e.label<s[1]){e.label=s[1],s=h;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(h);break}s[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(i,e)}catch(u){h=[6,u],r=0}finally{n=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var fi=function(){function i(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return i}();function o1(i,t){return i>t?1:i<t?-1:0}function ti(i,t,e){for(var n=new fi(null,null),r=n,s=n;;){var o=e(i,t.key);if(o<0){if(t.left===null)break;if(e(i,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,t=a,t.left===null)break}s.left=t,s=t,t=t.left}else if(o>0){if(t.right===null)break;if(e(i,t.right.key)>0){var a=t.right;if(t.right=a.left,a.left=t,t=a,t.right===null)break}r.right=t,r=t,t=t.right}else break}return r.right=t.left,s.left=t.right,t.left=n.right,t.right=n.left,t}function wa(i,t,e,n){var r=new fi(i,t);if(e===null)return r.left=r.right=null,r;e=ti(i,e,n);var s=n(i,e.key);return s<0?(r.left=e.left,r.right=e,e.left=null):s>=0&&(r.right=e.right,r.left=e,e.right=null),r}function ju(i,t,e){var n=null,r=null;if(t){t=ti(i,t,e);var s=e(t.key,i);s===0?(n=t.left,r=t.right):s<0?(r=t.right,t.right=null,n=t):(n=t.left,t.left=null,r=t)}return{left:n,right:r}}function a1(i,t,e){return t===null?i:(i===null||(t=ti(i.key,t,e),t.left=i),t)}function Ha(i,t,e,n,r){if(i){n(""+t+(e?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+r(i)+`
`);var s=t+(e?"    ":"\u2502   ");i.left&&Ha(i.left,s,!1,n,r),i.right&&Ha(i.right,s,!0,n,r)}}var fh=function(){function i(t){t===void 0&&(t=o1),this._root=null,this._size=0,this._comparator=t}return i.prototype.insert=function(t,e){return this._size++,this._root=wa(t,e,this._root,this._comparator)},i.prototype.add=function(t,e){var n=new fi(t,e);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,s=ti(t,this._root,r),o=r(t,s.key);return o===0?this._root=s:(o<0?(n.left=s.left,n.right=s,s.left=null):o>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},i.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},i.prototype._remove=function(t,e,n){var r;if(e===null)return null;e=ti(t,e,n);var s=n(t,e.key);return s===0?(e.left===null?r=e.right:(r=ti(t,e.left,n),r.right=e.right),this._size--,r):e},i.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ti(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},i.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(r===0)return e;r<0?e=e.left:e=e.right}return null},i.prototype.find=function(t){return this._root&&(this._root=ti(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},i.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(r===0)return!0;r<0?e=e.left:e=e.right}return!1},i.prototype.forEach=function(t,e){for(var n=this._root,r=[],s=!1;!s;)n!==null?(r.push(n),n=n.left):r.length!==0?(n=r.pop(),t.call(e,n),n=n.right):s=!0;return this},i.prototype.range=function(t,e,n,r){for(var s=[],o=this._comparator,a=this._root,l;s.length!==0||a;)if(a)s.push(a),a=a.left;else{if(a=s.pop(),l=o(a.key,e),l>0)break;if(o(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this},i.prototype.keys=function(){var t=[];return this.forEach(function(e){var n=e.key;return t.push(n)}),t},i.prototype.values=function(){var t=[];return this.forEach(function(e){var n=e.data;return t.push(n)}),t},i.prototype.min=function(){return this._root?this.minNode(this._root).key:null},i.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},i.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},i.prototype.at=function(t){for(var e=this._root,n=!1,r=0,s=[];!n;)if(e)s.push(e),e=e.left;else if(s.length>0){if(e=s.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},i.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var s=r(t.key,e.key);if(s===0)break;s<0?(n=e,e=e.left):e=e.right}return n},i.prototype.prev=function(t){var e=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var s=r(t.key,e.key);if(s===0)break;s<0?e=e.left:(n=e,e=e.right)}return n},i.prototype.clear=function(){return this._root=null,this._size=0,this},i.prototype.toList=function(){return h1(this._root)},i.prototype.load=function(t,e,n){e===void 0&&(e=[]),n===void 0&&(n=!1);var r=t.length,s=this._comparator;if(n&&tl(t,e,0,r-1,s),this._root===null)this._root=Ja(t,e,0,r),this._size=r;else{var o=u1(this.toList(),l1(t,e),s);r=this._size+r,this._root=Qa({head:o},0,r)}return this},i.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),i.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var e=[];return Ha(this._root,"",!0,function(n){return e.push(n)},t),e.join("")},i.prototype.update=function(t,e,n){var r=this._comparator,s=ju(t,this._root,r),o=s.left,a=s.right;r(t,e)<0?a=wa(e,n,a,r):o=wa(e,n,o,r),this._root=a1(o,a,r)},i.prototype.split=function(t){return ju(t,this._root,this._comparator)},i.prototype[Symbol.iterator]=function(){var t,e,n;return s1(this,function(r){switch(r.label){case 0:t=this._root,e=[],n=!1,r.label=1;case 1:return n?[3,6]:t===null?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return e.length===0?[3,4]:(t=e.pop(),[4,t]);case 3:return r.sent(),t=t.right,[3,5];case 4:n=!0,r.label=5;case 5:return[3,1];case 6:return[2]}})},i}();function Ja(i,t,e,n){var r=n-e;if(r>0){var s=e+Math.floor(r/2),o=i[s],a=t[s],l=new fi(o,a);return l.left=Ja(i,t,e,s),l.right=Ja(i,t,s+1,n),l}return null}function l1(i,t){for(var e=new fi(null,null),n=e,r=0;r<i.length;r++)n=n.next=new fi(i[r],t[r]);return n.next=null,e.next}function h1(i){for(var t=i,e=[],n=!1,r=new fi(null,null),s=r;!n;)t?(e.push(t),t=t.left):e.length>0?(t=s=s.next=e.pop(),t=t.right):n=!0;return s.next=null,r.next}function Qa(i,t,e){var n=e-t;if(n>0){var r=t+Math.floor(n/2),s=Qa(i,t,r),o=i.head;return o.left=s,i.head=i.head.next,o.right=Qa(i,r+1,e),o}return null}function u1(i,t,e){for(var n=new fi(null,null),r=n,s=i,o=t;s!==null&&o!==null;)e(s.key,o.key)<0?(r.next=s,s=s.next):(r.next=o,o=o.next),r=r.next;return s!==null?r.next=s:o!==null&&(r.next=o),n.next}function tl(i,t,e,n,r){if(!(e>=n)){for(var s=i[e+n>>1],o=e-1,a=n+1;;){do o++;while(r(i[o],s)<0);do a--;while(r(i[a],s)>0);if(o>=a)break;var l=i[o];i[o]=i[a],i[a]=l,l=t[o],t[o]=t[a],t[a]=l}tl(i,t,e,a,r),tl(i,t,a+1,n,r)}}const Nn=11102230246251565e-32,ne=134217729,c1=(3+8*Nn)*Nn;function Ca(i,t,e,n,r){let s,o,a,l,h=t[0],u=n[0],c=0,f=0;u>h==u>-h?(s=h,h=t[++c]):(s=u,u=n[++f]);let g=0;if(c<i&&f<e)for(u>h==u>-h?(o=h+s,a=s-(o-h),h=t[++c]):(o=u+s,a=s-(o-u),u=n[++f]),s=o,a!==0&&(r[g++]=a);c<i&&f<e;)u>h==u>-h?(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=t[++c]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=n[++f]),s=o,a!==0&&(r[g++]=a);for(;c<i;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=t[++c],s=o,a!==0&&(r[g++]=a);for(;f<e;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=n[++f],s=o,a!==0&&(r[g++]=a);return(s!==0||g===0)&&(r[g++]=s),g}function f1(i,t){let e=t[0];for(let n=1;n<i;n++)e+=t[n];return e}function ds(i){return new Float64Array(i)}const d1=(3+16*Nn)*Nn,g1=(2+12*Nn)*Nn,m1=(9+64*Nn)*Nn*Nn,Qi=ds(4),Vu=ds(8),qu=ds(12),Hu=ds(16),ce=ds(4);function _1(i,t,e,n,r,s,o){let a,l,h,u,c,f,g,_,m,y,x,E,v,R,w,I,b,S;const T=i-r,O=e-r,P=t-s,F=n-s;R=T*F,f=ne*T,g=f-(f-T),_=T-g,f=ne*F,m=f-(f-F),y=F-m,w=_*y-(R-g*m-_*m-g*y),I=P*O,f=ne*P,g=f-(f-P),_=P-g,f=ne*O,m=f-(f-O),y=O-m,b=_*y-(I-g*m-_*m-g*y),x=w-b,c=w-x,Qi[0]=w-(x+c)+(c-b),E=R+x,c=E-R,v=R-(E-c)+(x-c),x=v-I,c=v-x,Qi[1]=v-(x+c)+(c-I),S=E+x,c=S-E,Qi[2]=E-(S-c)+(x-c),Qi[3]=S;let W=f1(4,Qi),G=g1*o;if(W>=G||-W>=G||(c=i-T,a=i-(T+c)+(c-r),c=e-O,h=e-(O+c)+(c-r),c=t-P,l=t-(P+c)+(c-s),c=n-F,u=n-(F+c)+(c-s),a===0&&l===0&&h===0&&u===0)||(G=m1*o+c1*Math.abs(W),W+=T*u+F*a-(P*h+O*l),W>=G||-W>=G))return W;R=a*F,f=ne*a,g=f-(f-a),_=a-g,f=ne*F,m=f-(f-F),y=F-m,w=_*y-(R-g*m-_*m-g*y),I=l*O,f=ne*l,g=f-(f-l),_=l-g,f=ne*O,m=f-(f-O),y=O-m,b=_*y-(I-g*m-_*m-g*y),x=w-b,c=w-x,ce[0]=w-(x+c)+(c-b),E=R+x,c=E-R,v=R-(E-c)+(x-c),x=v-I,c=v-x,ce[1]=v-(x+c)+(c-I),S=E+x,c=S-E,ce[2]=E-(S-c)+(x-c),ce[3]=S;const $=Ca(4,Qi,4,ce,Vu);R=T*u,f=ne*T,g=f-(f-T),_=T-g,f=ne*u,m=f-(f-u),y=u-m,w=_*y-(R-g*m-_*m-g*y),I=P*h,f=ne*P,g=f-(f-P),_=P-g,f=ne*h,m=f-(f-h),y=h-m,b=_*y-(I-g*m-_*m-g*y),x=w-b,c=w-x,ce[0]=w-(x+c)+(c-b),E=R+x,c=E-R,v=R-(E-c)+(x-c),x=v-I,c=v-x,ce[1]=v-(x+c)+(c-I),S=E+x,c=S-E,ce[2]=E-(S-c)+(x-c),ce[3]=S;const z=Ca($,Vu,4,ce,qu);R=a*u,f=ne*a,g=f-(f-a),_=a-g,f=ne*u,m=f-(f-u),y=u-m,w=_*y-(R-g*m-_*m-g*y),I=l*h,f=ne*l,g=f-(f-l),_=l-g,f=ne*h,m=f-(f-h),y=h-m,b=_*y-(I-g*m-_*m-g*y),x=w-b,c=w-x,ce[0]=w-(x+c)+(c-b),E=R+x,c=E-R,v=R-(E-c)+(x-c),x=v-I,c=v-x,ce[1]=v-(x+c)+(c-I),S=E+x,c=S-E,ce[2]=E-(S-c)+(x-c),ce[3]=S;const Z=Ca(z,qu,4,ce,Hu);return Hu[Z-1]}function p1(i,t,e,n,r,s){const o=(t-s)*(e-r),a=(i-r)*(n-s),l=o-a,h=Math.abs(o+a);return Math.abs(l)>=d1*h?l:-_1(i,t,e,n,r,s,h)}const Tr=(i,t)=>i.ll.x<=t.x&&t.x<=i.ur.x&&i.ll.y<=t.y&&t.y<=i.ur.y,el=(i,t)=>{if(t.ur.x<i.ll.x||i.ur.x<t.ll.x||t.ur.y<i.ll.y||i.ur.y<t.ll.y)return null;const e=i.ll.x<t.ll.x?t.ll.x:i.ll.x,n=i.ur.x<t.ur.x?i.ur.x:t.ur.x,r=i.ll.y<t.ll.y?t.ll.y:i.ll.y,s=i.ur.y<t.ur.y?i.ur.y:t.ur.y;return{ll:{x:e,y:r},ur:{x:n,y:s}}};let si=Number.EPSILON;si===void 0&&(si=Math.pow(2,-52));const y1=si*si,Ju=(i,t)=>{if(-si<i&&i<si&&-si<t&&t<si)return 0;const e=i-t;return e*e<y1*i*t?0:i<t?-1:1};class x1{constructor(){this.reset()}reset(){this.xRounder=new Qu,this.yRounder=new Qu}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class Qu{constructor(){this.tree=new fh,this.round(0)}round(t){const e=this.tree.add(t),n=this.tree.prev(e);if(n!==null&&Ju(e.key,n.key)===0)return this.tree.remove(t),n.key;const r=this.tree.next(e);return r!==null&&Ju(e.key,r.key)===0?(this.tree.remove(t),r.key):t}}const Qr=new x1,Us=(i,t)=>i.x*t.y-i.y*t.x,ad=(i,t)=>i.x*t.x+i.y*t.y,tc=(i,t,e)=>{const n=p1(i.x,i.y,t.x,t.y,e.x,e.y);return n>0?-1:n<0?1:0},go=i=>Math.sqrt(ad(i,i)),E1=(i,t,e)=>{const n={x:t.x-i.x,y:t.y-i.y},r={x:e.x-i.x,y:e.y-i.y};return Us(r,n)/go(r)/go(n)},v1=(i,t,e)=>{const n={x:t.x-i.x,y:t.y-i.y},r={x:e.x-i.x,y:e.y-i.y};return ad(r,n)/go(r)/go(n)},ec=(i,t,e)=>t.y===0?null:{x:i.x+t.x/t.y*(e-i.y),y:e},nc=(i,t,e)=>t.x===0?null:{x:e,y:i.y+t.y/t.x*(e-i.x)},w1=(i,t,e,n)=>{if(t.x===0)return nc(e,n,i.x);if(n.x===0)return nc(i,t,e.x);if(t.y===0)return ec(e,n,i.y);if(n.y===0)return ec(i,t,e.y);const r=Us(t,n);if(r==0)return null;const s={x:e.x-i.x,y:e.y-i.y},o=Us(s,t)/r,a=Us(s,n)/r,l=i.x+a*t.x,h=e.x+o*n.x,u=i.y+a*t.y,c=e.y+o*n.y,f=(l+h)/2,g=(u+c)/2;return{x:f,y:g}};class Oe{static compare(t,e){const n=Oe.comparePoints(t.point,e.point);return n!==0?n:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:li.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let n=0,r=e.length;n<r;n++){const s=e[n];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const n=this.point.events[e];if(n.segment.consumedBy===void 0)for(let r=e+1;r<t;r++){const s=this.point.events[r];s.consumedBy===void 0&&n.otherSE.point.events===s.otherSE.point.events&&n.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,n=this.point.events.length;e<n;e++){const r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}getLeftmostComparator(t){const e=new Map,n=r=>{const s=r.otherSE;e.set(r,{sine:E1(this.point,t.point,s.point),cosine:v1(this.point,t.point,s.point)})};return(r,s)=>{e.has(r)||n(r),e.has(s)||n(s);const{sine:o,cosine:a}=e.get(r),{sine:l,cosine:h}=e.get(s);return o>=0&&l>=0?a<h?1:a>h?-1:0:o<0&&l<0?a<h?-1:a>h?1:0:l<o?-1:l>o?1:0}}}let C1=0;class li{static compare(t,e){const n=t.leftSE.point.x,r=e.leftSE.point.x,s=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(s<r)return-1;const a=t.leftSE.point.y,l=e.leftSE.point.y,h=t.rightSE.point.y,u=e.rightSE.point.y;if(n<r){if(l<a&&l<h)return 1;if(l>a&&l>h)return-1;const c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;const f=e.comparePoint(t.rightSE.point);return f!==0?f:-1}if(n>r){if(a<l&&a<u)return-1;if(a>l&&a>u)return 1;const c=e.comparePoint(t.leftSE.point);if(c!==0)return c;const f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(a<l)return-1;if(a>l)return 1;if(s<o){const c=e.comparePoint(t.rightSE.point);if(c!==0)return c}if(s>o){const c=t.comparePoint(e.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(s!==o){const c=h-a,f=s-n,g=u-l,_=o-r;if(c>f&&g<_)return 1;if(c<f&&g>_)return-1}return s>o?1:s<o||h<u?-1:h>u?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,n,r){this.id=++C1,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=n,this.windings=r}static fromRing(t,e,n){let r,s,o;const a=Oe.comparePoints(t,e);if(a<0)r=t,s=e,o=1;else if(a>0)r=e,s=t,o=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const l=new Oe(r,!0),h=new Oe(s,!1);return new li(l,h,[n],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;const s=(t.y-e.y)/r.y,o=e.x+s*r.x;if(t.x===o)return 0;const a=(t.x-e.x)/r.x,l=e.y+a*r.y;return t.y===l?0:t.y<l?-1:1}getIntersection(t){const e=this.bbox(),n=t.bbox(),r=el(e,n);if(r===null)return null;const s=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,l=t.rightSE.point,h=Tr(e,a)&&this.comparePoint(a)===0,u=Tr(n,s)&&t.comparePoint(s)===0,c=Tr(e,l)&&this.comparePoint(l)===0,f=Tr(n,o)&&t.comparePoint(o)===0;if(u&&h)return f&&!c?o:!f&&c?l:null;if(u)return c&&s.x===l.x&&s.y===l.y?null:s;if(h)return f&&o.x===a.x&&o.y===a.y?null:a;if(f&&c)return null;if(f)return o;if(c)return l;const g=w1(s,this.vector(),a,t.vector());return g===null||!Tr(r,g)?null:Qr.round(g.x,g.y)}split(t){const e=[],n=t.events!==void 0,r=new Oe(t,!0),s=new Oe(t,!1),o=this.rightSE;this.replaceRightSE(s),e.push(s),e.push(r);const a=new li(r,o,this.rings.slice(),this.windings.slice());return Oe.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Oe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),s.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}consume(t){let e=this,n=t;for(;e.consumedBy;)e=e.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const r=li.compare(e,n);if(r!==0){if(r>0){const s=e;e=n,n=s}if(e.prev===n){const s=e;e=n,n=s}for(let s=0,o=n.rings.length;s<o;s++){const a=n.rings[s],l=n.windings[s],h=e.rings.indexOf(a);h===-1?(e.rings.push(a),e.windings.push(l)):e.windings[h]+=l}n.rings=null,n.windings=null,n.consumedBy=e,n.leftSE.consumedBy=e.leftSE,n.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const h=this.rings[a],u=this.windings[a],c=e.indexOf(h);c===-1?(e.push(h),n.push(u)):n[c]+=u}const s=[],o=[];for(let a=0,l=e.length;a<l;a++){if(n[a]===0)continue;const h=e[a],u=h.poly;if(o.indexOf(u)===-1)if(h.isExterior)s.push(u);else{o.indexOf(u)===-1&&o.push(u);const c=s.indexOf(h.poly);c!==-1&&s.splice(c,1)}}for(let a=0,l=s.length;a<l;a++){const h=s[a].multiPoly;r.indexOf(h)===-1&&r.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Ve.type){case"union":{const n=t.length===0,r=e.length===0;this._isInResult=n!==r;break}case"intersection":{let n,r;t.length<e.length?(n=t.length,r=e.length):(n=e.length,r=t.length),this._isInResult=r===Ve.numMultiPolys&&n<r;break}case"xor":{const n=Math.abs(t.length-e.length);this._isInResult=n%2===1;break}case"difference":{const n=r=>r.length===1&&r[0].isSubject;this._isInResult=n(t)!==n(e);break}default:throw new Error(`Unrecognized operation type found ${Ve.type}`)}return this._isInResult}}class ic{constructor(t,e,n){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=Qr.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let s=r;for(let o=1,a=t.length;o<a;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=Qr.round(t[o][0],t[o][1]);l.x===s.x&&l.y===s.y||(this.segments.push(li.fromRing(s,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),s=l)}(r.x!==s.x||r.y!==s.y)&&this.segments.push(li.fromRing(s,r,this))}getSweepEvents(){const t=[];for(let e=0,n=this.segments.length;e<n;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}class R1{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ic(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,r=t.length;n<r;n++){const s=new ic(t[n],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const r=this.interiorRings[e].getSweepEvents();for(let s=0,o=r.length;s<o;s++)t.push(r[s])}return t}}class rc{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,r=t.length;n<r;n++){const s=new R1(t[n],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getSweepEvents();for(let s=0,o=r.length;s<o;s++)t.push(r[s])}return t}}class mo{static factory(t){const e=[];for(let n=0,r=t.length;n<r;n++){const s=t[n];if(!s.isInResult()||s.ringOut)continue;let o=null,a=s.leftSE,l=s.rightSE;const h=[a],u=a.point,c=[];for(;o=a,a=l,h.push(a),a.point!==u;)for(;;){const f=a.getAvailableLinkedEvents();if(f.length===0){const m=h[0].point,y=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${m.x}, ${m.y}]. Last matching segment found ends at [${y.x}, ${y.y}].`)}if(f.length===1){l=f[0].otherSE;break}let g=null;for(let m=0,y=c.length;m<y;m++)if(c[m].point===a.point){g=m;break}if(g!==null){const m=c.splice(g)[0],y=h.splice(m.index);y.unshift(y[0].otherSE),e.push(new mo(y.reverse()));continue}c.push({index:h.length,point:a.point});const _=a.getLeftmostComparator(o);l=f.sort(_)[0].otherSE;break}e.push(new mo(h))}return e}constructor(t){this.events=t;for(let e=0,n=t.length;e<n;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let h=1,u=this.events.length-1;h<u;h++){const c=this.events[h].point,f=this.events[h+1].point;tc(c,t,f)!==0&&(e.push(c),t=c)}if(e.length===1)return null;const n=e[0],r=e[1];tc(n,t,r)===0&&e.shift(),e.push(e[0]);const s=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,l=[];for(let h=o;h!=a;h+=s)l.push([e[h].x,e[h].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let r=1,s=this.events.length;r<s;r++){const o=this.events[r];Oe.compare(t,o)>0&&(t=o)}let e=t.segment.prevInResult(),n=e?e.prevInResult():null;for(;;){if(!e)return null;if(!n)return e.ringOut;if(n.ringOut!==e.ringOut)return n.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=n.prevInResult(),n=e?e.prevInResult():null}}}class sc{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let e=0,n=this.interiorRings.length;e<n;e++){const r=this.interiorRings[e].getGeom();r!==null&&t.push(r)}return t}}class S1{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getGeom();r!==null&&t.push(r)}return t}_composePolys(t){const e=[];for(let n=0,r=t.length;n<r;n++){const s=t[n];if(!s.poly)if(s.isExteriorRing())e.push(new sc(s));else{const o=s.enclosingRing();o.poly||e.push(new sc(o)),o.poly.addInterior(s)}}return e}}class I1{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:li.compare;this.queue=t,this.tree=new fh(e),this.segments=[]}process(t){const e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;const r=t.isLeft?this.tree.add(e):this.tree.find(e);if(!r)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let s=r,o=r,a,l;for(;a===void 0;)s=this.tree.prev(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;l===void 0;)o=this.tree.next(o),o===null?l=null:o.key.consumedBy===void 0&&(l=o.key);if(t.isLeft){let h=null;if(a){const c=a.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(h=c),!a.isAnEndpoint(c))){const f=this._splitSafely(a,c);for(let g=0,_=f.length;g<_;g++)n.push(f[g])}}let u=null;if(l){const c=l.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(u=c),!l.isAnEndpoint(c))){const f=this._splitSafely(l,c);for(let g=0,_=f.length;g<_;g++)n.push(f[g])}}if(h!==null||u!==null){let c=null;h===null?c=u:u===null?c=h:c=Oe.comparePoints(h,u)<=0?h:u,this.queue.remove(e.rightSE),n.push(e.rightSE);const f=e.split(c);for(let g=0,_=f.length;g<_;g++)n.push(f[g])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&l){const h=a.getIntersection(l);if(h!==null){if(!a.isAnEndpoint(h)){const u=this._splitSafely(a,h);for(let c=0,f=u.length;c<f;c++)n.push(u[c])}if(!l.isAnEndpoint(h)){const u=this._splitSafely(l,h);for(let c=0,f=u.length;c<f;c++)n.push(u[c])}}}this.tree.remove(e)}return n}_splitSafely(t,e){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const r=t.split(e);return r.push(n),t.consumedBy===void 0&&this.tree.add(t),r}}const oc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,b1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class T1{run(t,e,n){Ve.type=t,Qr.reset();const r=[new rc(e,!0)];for(let c=0,f=n.length;c<f;c++)r.push(new rc(n[c],!1));if(Ve.numMultiPolys=r.length,Ve.type==="difference"){const c=r[0];let f=1;for(;f<r.length;)el(r[f].bbox,c.bbox)!==null?f++:r.splice(f,1)}if(Ve.type==="intersection")for(let c=0,f=r.length;c<f;c++){const g=r[c];for(let _=c+1,m=r.length;_<m;_++)if(el(g.bbox,r[_].bbox)===null)return[]}const s=new fh(Oe.compare);for(let c=0,f=r.length;c<f;c++){const g=r[c].getSweepEvents();for(let _=0,m=g.length;_<m;_++)if(s.insert(g[_]),s.size>oc)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new I1(s);let a=s.size,l=s.pop();for(;l;){const c=l.key;if(s.size===a){const g=c.segment;throw new Error(`Unable to pop() ${c.isLeft?"left":"right"} SweepEvent [${c.point.x}, ${c.point.y}] from segment #${g.id} [${g.leftSE.point.x}, ${g.leftSE.point.y}] -> [${g.rightSE.point.x}, ${g.rightSE.point.y}] from queue.`)}if(s.size>oc)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>b1)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const f=o.process(c);for(let g=0,_=f.length;g<_;g++){const m=f[g];m.consumedBy===void 0&&s.insert(m)}a=s.size,l=s.pop()}Qr.reset();const h=mo.factory(o.segments);return new S1(h).getGeom()}}const Ve=new T1,M1=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return Ve.run("union",i,e)},A1=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return Ve.run("intersection",i,e)},L1=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return Ve.run("xor",i,e)},P1=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return Ve.run("difference",i,e)};var O1={union:M1,intersection:A1,xor:L1,difference:P1};function F1(i,t,e){e===void 0&&(e={});var n=Bu(i),r=Bu(t),s=O1.intersection(n.coordinates,r.coordinates);return s.length===0?null:s.length===1?Xo(s[0],e.properties):lh(s,e.properties)}var nl={exports:{}};/**
 * @license
 * lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash exports="node" include="clone,merge,isEmpty,isArray,compact,each" -d`
 * Copyright jQuery Foundation and other contributors <https://jquery.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(i,t){(function(){var e,n="4.15.0",r=200,s="Expected a function",o="__lodash_hash_undefined__",a=1,l=2,h=1/0,u=9007199254740991,c="[object Arguments]",f="[object Array]",g="[object Boolean]",_="[object Date]",m="[object Error]",y="[object Function]",x="[object GeneratorFunction]",E="[object Map]",v="[object Number]",R="[object Object]",w="[object Promise]",I="[object RegExp]",b="[object Set]",S="[object String]",T="[object Symbol]",O="[object WeakMap]",P="[object ArrayBuffer]",F="[object DataView]",W="[object Float32Array]",G="[object Float64Array]",$="[object Int8Array]",z="[object Int16Array]",Z="[object Int32Array]",H="[object Uint8Array]",lt="[object Uint8ClampedArray]",k="[object Uint16Array]",N="[object Uint32Array]",rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Et=/^\w*$/,A=/^\./,tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,V=/[\\^$.*+?()[\]{}|]/g,J=/\\(\\)?/g,Ct=/\w*$/,At=/^\[object .+?Constructor\]$/,_t=/^(?:0|[1-9]\d*)$/,st={};st[W]=st[G]=st[$]=st[z]=st[Z]=st[H]=st[lt]=st[k]=st[N]=!0,st[c]=st[f]=st[P]=st[g]=st[F]=st[_]=st[m]=st[y]=st[E]=st[v]=st[R]=st[I]=st[b]=st[S]=st[O]=!1;var j={};j[c]=j[f]=j[P]=j[F]=j[g]=j[_]=j[W]=j[G]=j[$]=j[z]=j[Z]=j[E]=j[v]=j[R]=j[I]=j[b]=j[S]=j[T]=j[H]=j[lt]=j[k]=j[N]=!0,j[m]=j[y]=j[O]=!1;var Yt=typeof br=="object"&&br&&br.Object===Object&&br,we=typeof self=="object"&&self&&self.Object===Object&&self,Ut=Yt||we||Function("return this")(),$t=t&&!t.nodeType&&t,te=$t&&!0&&i&&!i.nodeType&&i,Qe=te&&te.exports===$t,Ce=Qe&&Yt.process,tn=function(){try{return Ce&&Ce.binding("util")}catch{}}(),en=tn&&tn.isTypedArray;function ut(d,p){return d.set(p[0],p[1]),d}function bt(d,p){return d.add(p),d}function Nt(d,p,C){switch(C.length){case 0:return d.call(p);case 1:return d.call(p,C[0]);case 2:return d.call(p,C[0],C[1]);case 3:return d.call(p,C[0],C[1],C[2])}return d.apply(p,C)}function Gt(d,p){for(var C=-1,M=d?d.length:0;++C<M&&p(d[C],C,d)!==!1;);return d}function ge(d,p){for(var C=-1,M=p.length,X=d.length;++C<M;)d[X+C]=p[C];return d}function Ae(d,p,C,M){var X=-1,D=d?d.length:0;for(M&&D&&(C=d[++X]);++X<D;)C=p(C,d[X],X,d);return C}function Ht(d,p){for(var C=-1,M=d?d.length:0;++C<M;)if(p(d[C],C,d))return!0;return!1}function St(d){return function(p){return p==null?e:p[d]}}function Be(d,p){for(var C=-1,M=Array(d);++C<d;)M[C]=p(C);return M}function Ft(d){return function(p){return d(p)}}function Xn(d,p){return d==null?e:d[p]}function me(d){var p=!1;if(d!=null&&typeof d.toString!="function")try{p=!!(d+"")}catch{}return p}function yn(d){var p=-1,C=Array(d.size);return d.forEach(function(M,X){C[++p]=[X,M]}),C}function Wn(d,p){return function(C){return d(p(C))}}function nn(d){var p=-1,C=Array(d.size);return d.forEach(function(M){C[++p]=M}),C}var Wi=Array.prototype,Bn=Function.prototype,xn=Object.prototype,gi=Ut["__core-js_shared__"],Yn=function(){var d=/[^.]+$/.exec(gi&&gi.keys&&gi.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),rn=Bn.toString,zt=xn.hasOwnProperty,gs=rn.call(Object),sn=xn.toString,_e=RegExp("^"+rn.call(zt).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),on=Qe?Ut.Buffer:e,ae=Ut.Symbol,le=Ut.Uint8Array,he=Wn(Object.getPrototypeOf,Object),Ye=Object.create,Le=xn.propertyIsEnumerable,It=Wi.splice,Kt=Object.getOwnPropertySymbols,Ze=on?on.isBuffer:e,ms=Wn(Object.keys,Object),ph=Math.max,Yo=Yi(Ut,"DataView"),Er=Yi(Ut,"Map"),Zo=Yi(Ut,"Promise"),Uo=Yi(Ut,"Set"),$o=Yi(Ut,"WeakMap"),vr=Yi(Object,"create"),vd=!Le.call({valueOf:1},"valueOf"),wd=_i(Yo),Cd=_i(Er),Rd=_i(Zo),Sd=_i(Uo),Id=_i($o),_s=ae?ae.prototype:e,wr=_s?_s.valueOf:e,yh=_s?_s.toString:e;function ct(){}function mi(d){var p=-1,C=d?d.length:0;for(this.clear();++p<C;){var M=d[p];this.set(M[0],M[1])}}function bd(){this.__data__=vr?vr(null):{}}function Td(d){return this.has(d)&&delete this.__data__[d]}function Md(d){var p=this.__data__;if(vr){var C=p[d];return C===o?e:C}return zt.call(p,d)?p[d]:e}function Ad(d){var p=this.__data__;return vr?p[d]!==e:zt.call(p,d)}function Ld(d,p){var C=this.__data__;return C[d]=vr&&p===e?o:p,this}mi.prototype.clear=bd,mi.prototype.delete=Td,mi.prototype.get=Md,mi.prototype.has=Ad,mi.prototype.set=Ld;function En(d){var p=-1,C=d?d.length:0;for(this.clear();++p<C;){var M=d[p];this.set(M[0],M[1])}}function Pd(){this.__data__=[]}function Od(d){var p=this.__data__,C=ys(p,d);if(C<0)return!1;var M=p.length-1;return C==M?p.pop():It.call(p,C,1),!0}function Fd(d){var p=this.__data__,C=ys(p,d);return C<0?e:p[C][1]}function Dd(d){return ys(this.__data__,d)>-1}function kd(d,p){var C=this.__data__,M=ys(C,d);return M<0?C.push([d,p]):C[M][1]=p,this}En.prototype.clear=Pd,En.prototype.delete=Od,En.prototype.get=Fd,En.prototype.has=Dd,En.prototype.set=kd;function vn(d){var p=-1,C=d?d.length:0;for(this.clear();++p<C;){var M=d[p];this.set(M[0],M[1])}}function Nd(){this.__data__={hash:new mi,map:new(Er||En),string:new mi}}function Gd(d){return xs(this,d).delete(d)}function zd(d){return xs(this,d).get(d)}function Xd(d){return xs(this,d).has(d)}function Wd(d,p){return xs(this,d).set(d,p),this}vn.prototype.clear=Nd,vn.prototype.delete=Gd,vn.prototype.get=zd,vn.prototype.has=Xd,vn.prototype.set=Wd;function ps(d){var p=-1,C=d?d.length:0;for(this.__data__=new vn;++p<C;)this.add(d[p])}function Bd(d){return this.__data__.set(d,o),this}function Yd(d){return this.__data__.has(d)}ps.prototype.add=ps.prototype.push=Bd,ps.prototype.has=Yd;function Ue(d){this.__data__=new En(d)}function Zd(){this.__data__=new En}function Ud(d){return this.__data__.delete(d)}function $d(d){return this.__data__.get(d)}function Kd(d){return this.__data__.has(d)}function jd(d,p){var C=this.__data__;if(C instanceof En){var M=C.__data__;if(!Er||M.length<r-1)return M.push([d,p]),this;C=this.__data__=new vn(M)}return C.set(d,p),this}Ue.prototype.clear=Zd,Ue.prototype.delete=Ud,Ue.prototype.get=$d,Ue.prototype.has=Kd,Ue.prototype.set=jd;function xh(d,p){var C=ue(d)||Ui(d)?Be(d.length,String):[],M=C.length,X=!!M;for(var D in d)(p||zt.call(d,D))&&!(X&&(D=="length"||Ho(D,M)))&&C.push(D);return C}function Ko(d,p,C){(C!==e&&!Zi(d[p],C)||typeof p=="number"&&C===e&&!(p in d))&&(d[p]=C)}function Eh(d,p,C){var M=d[p];(!(zt.call(d,p)&&Zi(M,C))||C===e&&!(p in d))&&(d[p]=C)}function ys(d,p){for(var C=d.length;C--;)if(Zi(d[C][0],p))return C;return-1}function Vd(d,p){return d&&qo(p,Zn(p),d)}function Bi(d,p,C,M,X,D,B){var U;if(M&&(U=D?M(d,X,D,B):M(d)),U!==e)return U;if(!$e(d))return d;var ot=ue(d);if(ot){if(U=Lg(d),!p)return Ih(d,U)}else{var wt=an(d),yt=wt==y||wt==x;if(Qo(d))return gg(d,p);if(wt==R||wt==c||yt&&!D){if(me(d))return D?d:{};if(U=Pg(yt?{}:d),!p)return vg(d,Vd(U,d))}else{if(!j[wt])return D?d:{};U=Og(d,wt,Bi,p)}}B||(B=new Ue);var Tt=B.get(d);if(Tt)return Tt;if(B.set(d,U),!ot)var Dt=C?bg(d):Zn(d);return Gt(Dt||d,function(ee,Jt){Dt&&(Jt=ee,ee=d[Jt]),Eh(U,Jt,Bi(ee,p,C,M,Jt,d,B))}),U}function qd(d){return $e(d)?Ye(d):{}}var Hd=Cg(Qd),Jd=Rg();function Qd(d,p){return d&&Jd(d,p,Zn)}function vh(d,p){p=Es(p,d)?[p]:Sh(p);for(var C=0,M=p.length;d!=null&&C<M;)d=d[ws(p[C++])];return C&&C==M?d:e}function tg(d,p,C){var M=p(d);return ue(d)?M:ge(M,C(d))}function eg(d){return sn.call(d)}function ng(d,p){return d!=null&&p in Object(d)}function jo(d,p,C,M,X){return d===p?!0:d==null||p==null||!$e(d)&&!$i(p)?d!==d&&p!==p:ig(d,p,jo,C,M,X)}function ig(d,p,C,M,X,D){var B=ue(d),U=ue(p),ot=f,wt=f;B||(ot=an(d),ot=ot==c?R:ot),U||(wt=an(p),wt=wt==c?R:wt);var yt=ot==R&&!me(d),Tt=wt==R&&!me(p),Dt=ot==wt;if(Dt&&!yt)return D||(D=new Ue),B||bs(d)?bh(d,p,C,M,X,D):Sg(d,p,ot,C,M,X,D);if(!(X&l)){var ee=yt&&zt.call(d,"__wrapped__"),Jt=Tt&&zt.call(p,"__wrapped__");if(ee||Jt){var Un=ee?d.value():d,wn=Jt?p.value():p;return D||(D=new Ue),C(Un,wn,M,X,D)}}return Dt?(D||(D=new Ue),Ig(d,p,C,M,X,D)):!1}function rg(d,p,C,M){var X=C.length,D=X,B=!M;if(d==null)return!D;for(d=Object(d);X--;){var U=C[X];if(B&&U[2]?U[1]!==d[U[0]]:!(U[0]in d))return!1}for(;++X<D;){U=C[X];var ot=U[0],wt=d[ot],yt=U[1];if(B&&U[2]){if(wt===e&&!(ot in d))return!1}else{var Tt=new Ue;if(M)var Dt=M(wt,yt,ot,d,p,Tt);if(!(Dt===e?jo(yt,wt,M,a|l,Tt):Dt))return!1}}return!0}function sg(d){if(!$e(d)||kg(d))return!1;var p=Rs(d)||me(d)?_e:At;return p.test(_i(d))}function og(d){return $i(d)&&Ss(d.length)&&!!st[sn.call(d)]}function wh(d){return typeof d=="function"?d:d==null?Gh:typeof d=="object"?ue(d)?hg(d[0],d[1]):lg(d):zh(d)}function ag(d){if(!vs(d))return ms(d);var p=[];for(var C in Object(d))zt.call(d,C)&&C!="constructor"&&p.push(C);return p}function Ch(d){if(!$e(d))return Ng(d);var p=vs(d),C=[];for(var M in d)M=="constructor"&&(p||!zt.call(d,M))||C.push(M);return C}function lg(d){var p=Mg(d);return p.length==1&&p[0][2]?Ah(p[0][0],p[0][1]):function(C){return C===d||rg(C,d,p)}}function hg(d,p){return Es(d)&&Mh(p)?Ah(ws(d),p):function(C){var M=Dh(C,d);return M===e&&M===p?kh(C,d):jo(p,M,e,a|l)}}function Rh(d,p,C,M,X){if(d!==p){if(!(ue(p)||bs(p)))var D=Ch(p);Gt(D||p,function(B,U){if(D&&(U=B,B=p[U]),$e(B))X||(X=new Ue),ug(d,p,U,C,Rh,M,X);else{var ot=M?M(d[U],B,U+"",d,p,X):e;ot===e&&(ot=B),Ko(d,U,ot)}})}}function ug(d,p,C,M,X,D,B){var U=d[C],ot=p[C],wt=B.get(ot);if(wt){Ko(d,C,wt);return}var yt=D?D(U,ot,C+"",d,p,B):e,Tt=yt===e;Tt&&(yt=ot,ue(ot)||bs(ot)?ue(U)?yt=U:Jo(U)?yt=Ih(U):(Tt=!1,yt=Bi(ot,!0)):Ph(ot)||Ui(ot)?Ui(U)?yt=Oh(U):!$e(U)||M&&Rs(U)?(Tt=!1,yt=Bi(ot,!0)):yt=U:Tt=!1),Tt&&(B.set(ot,yt),X(yt,ot,M,D,B),B.delete(ot)),Ko(d,C,yt)}function cg(d){return function(p){return vh(p,d)}}function fg(d,p){return p=ph(p===e?d.length-1:p,0),function(){for(var C=arguments,M=-1,X=ph(C.length-p,0),D=Array(X);++M<X;)D[M]=C[p+M];M=-1;for(var B=Array(p+1);++M<p;)B[M]=C[M];return B[p]=D,Nt(d,this,B)}}function dg(d){if(typeof d=="string")return d;if(Is(d))return yh?yh.call(d):"";var p=d+"";return p=="0"&&1/d==-h?"-0":p}function Sh(d){return ue(d)?d:Gg(d)}function gg(d,p){if(p)return d.slice();var C=new d.constructor(d.length);return d.copy(C),C}function Vo(d){var p=new d.constructor(d.byteLength);return new le(p).set(new le(d)),p}function mg(d,p){var C=p?Vo(d.buffer):d.buffer;return new d.constructor(C,d.byteOffset,d.byteLength)}function _g(d,p,C){var M=p?C(yn(d),!0):yn(d);return Ae(M,ut,new d.constructor)}function pg(d){var p=new d.constructor(d.source,Ct.exec(d));return p.lastIndex=d.lastIndex,p}function yg(d,p,C){var M=p?C(nn(d),!0):nn(d);return Ae(M,bt,new d.constructor)}function xg(d){return wr?Object(wr.call(d)):{}}function Eg(d,p){var C=p?Vo(d.buffer):d.buffer;return new d.constructor(C,d.byteOffset,d.length)}function Ih(d,p){var C=-1,M=d.length;for(p||(p=Array(M));++C<M;)p[C]=d[C];return p}function qo(d,p,C,M){C||(C={});for(var X=-1,D=p.length;++X<D;){var B=p[X],U=M?M(C[B],d[B],B,C,d):e;Eh(C,B,U===e?d[B]:U)}return C}function vg(d,p){return qo(d,Th(d),p)}function wg(d){return fg(function(p,C){var M=-1,X=C.length,D=X>1?C[X-1]:e,B=X>2?C[2]:e;for(D=d.length>3&&typeof D=="function"?(X--,D):e,B&&Fg(C[0],C[1],B)&&(D=X<3?e:D,X=1),p=Object(p);++M<X;){var U=C[M];U&&d(p,U,M,D)}return p})}function Cg(d,p){return function(C,M){if(C==null)return C;if(!pi(C))return d(C,M);for(var X=C.length,D=p?X:-1,B=Object(C);(p?D--:++D<X)&&M(B[D],D,B)!==!1;);return C}}function Rg(d){return function(p,C,M){for(var X=-1,D=Object(p),B=M(p),U=B.length;U--;){var ot=B[d?U:++X];if(C(D[ot],ot,D)===!1)break}return p}}function bh(d,p,C,M,X,D){var B=X&l,U=d.length,ot=p.length;if(U!=ot&&!(B&&ot>U))return!1;var wt=D.get(d);if(wt&&D.get(p))return wt==p;var yt=-1,Tt=!0,Dt=X&a?new ps:e;for(D.set(d,p),D.set(p,d);++yt<U;){var ee=d[yt],Jt=p[yt];if(M)var Un=B?M(Jt,ee,yt,p,d,D):M(ee,Jt,yt,d,p,D);if(Un!==e){if(Un)continue;Tt=!1;break}if(Dt){if(!Ht(p,function(wn,yi){if(!Dt.has(yi)&&(ee===wn||C(ee,wn,M,X,D)))return Dt.add(yi)})){Tt=!1;break}}else if(!(ee===Jt||C(ee,Jt,M,X,D))){Tt=!1;break}}return D.delete(d),D.delete(p),Tt}function Sg(d,p,C,M,X,D,B){switch(C){case F:if(d.byteLength!=p.byteLength||d.byteOffset!=p.byteOffset)return!1;d=d.buffer,p=p.buffer;case P:return!(d.byteLength!=p.byteLength||!M(new le(d),new le(p)));case g:case _:case v:return Zi(+d,+p);case m:return d.name==p.name&&d.message==p.message;case I:case S:return d==p+"";case E:var U=yn;case b:var ot=D&l;if(U||(U=nn),d.size!=p.size&&!ot)return!1;var wt=B.get(d);if(wt)return wt==p;D|=a,B.set(d,p);var yt=bh(U(d),U(p),M,X,D,B);return B.delete(d),yt;case T:if(wr)return wr.call(d)==wr.call(p)}return!1}function Ig(d,p,C,M,X,D){var B=X&l,U=Zn(d),ot=U.length,wt=Zn(p),yt=wt.length;if(ot!=yt&&!B)return!1;for(var Tt=ot;Tt--;){var Dt=U[Tt];if(!(B?Dt in p:zt.call(p,Dt)))return!1}var ee=D.get(d);if(ee&&D.get(p))return ee==p;var Jt=!0;D.set(d,p),D.set(p,d);for(var Un=B;++Tt<ot;){Dt=U[Tt];var wn=d[Dt],yi=p[Dt];if(M)var Bh=B?M(yi,wn,Dt,p,d,D):M(wn,yi,Dt,d,p,D);if(!(Bh===e?wn===yi||C(wn,yi,M,X,D):Bh)){Jt=!1;break}Un||(Un=Dt=="constructor")}if(Jt&&!Un){var Ts=d.constructor,Ms=p.constructor;Ts!=Ms&&"constructor"in d&&"constructor"in p&&!(typeof Ts=="function"&&Ts instanceof Ts&&typeof Ms=="function"&&Ms instanceof Ms)&&(Jt=!1)}return D.delete(d),D.delete(p),Jt}function bg(d){return tg(d,Zn,Th)}function Tg(){var d=ct.iteratee||ta;return d=d===ta?wh:d,arguments.length?d(arguments[0],arguments[1]):d}function xs(d,p){var C=d.__data__;return Dg(p)?C[typeof p=="string"?"string":"hash"]:C.map}function Mg(d){for(var p=Zn(d),C=p.length;C--;){var M=p[C],X=d[M];p[C]=[M,X,Mh(X)]}return p}function Yi(d,p){var C=Xn(d,p);return sg(C)?C:e}var Th=Kt?Wn(Kt,Object):Xh,an=eg;(Yo&&an(new Yo(new ArrayBuffer(1)))!=F||Er&&an(new Er)!=E||Zo&&an(Zo.resolve())!=w||Uo&&an(new Uo)!=b||$o&&an(new $o)!=O)&&(an=function(d){var p=sn.call(d),C=p==R?d.constructor:e,M=C?_i(C):e;if(M)switch(M){case wd:return F;case Cd:return E;case Rd:return w;case Sd:return b;case Id:return O}return p});function Ag(d,p,C){p=Es(p,d)?[p]:Sh(p);for(var M,X=-1,B=p.length;++X<B;){var D=ws(p[X]);if(!(M=d!=null&&C(d,D)))break;d=d[D]}if(M)return M;var B=d?d.length:0;return!!B&&Ss(B)&&Ho(D,B)&&(ue(d)||Ui(d))}function Lg(d){var p=d.length,C=d.constructor(p);return p&&typeof d[0]=="string"&&zt.call(d,"index")&&(C.index=d.index,C.input=d.input),C}function Pg(d){return typeof d.constructor=="function"&&!vs(d)?qd(he(d)):{}}function Og(d,p,C,M){var X=d.constructor;switch(p){case P:return Vo(d);case g:case _:return new X(+d);case F:return mg(d,M);case W:case G:case $:case z:case Z:case H:case lt:case k:case N:return Eg(d,M);case E:return _g(d,M,C);case v:case S:return new X(d);case I:return pg(d);case b:return yg(d,M,C);case T:return xg(d)}}function Ho(d,p){return p=p==null?u:p,!!p&&(typeof d=="number"||_t.test(d))&&d>-1&&d%1==0&&d<p}function Fg(d,p,C){if(!$e(C))return!1;var M=typeof p;return(M=="number"?pi(C)&&Ho(p,C.length):M=="string"&&p in C)?Zi(C[p],d):!1}function Es(d,p){if(ue(d))return!1;var C=typeof d;return C=="number"||C=="symbol"||C=="boolean"||d==null||Is(d)?!0:Et.test(d)||!rt.test(d)||p!=null&&d in Object(p)}function Dg(d){var p=typeof d;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?d!=="__proto__":d===null}function kg(d){return!!Yn&&Yn in d}function vs(d){var p=d&&d.constructor,C=typeof p=="function"&&p.prototype||xn;return d===C}function Mh(d){return d===d&&!$e(d)}function Ah(d,p){return function(C){return C==null?!1:C[d]===p&&(p!==e||d in Object(C))}}function Ng(d){var p=[];if(d!=null)for(var C in Object(d))p.push(C);return p}var Gg=Cs(function(d){d=Fh(d);var p=[];return A.test(d)&&p.push(""),d.replace(tt,function(C,M,X,D){p.push(X?D.replace(J,"$1"):M||C)}),p});function ws(d){if(typeof d=="string"||Is(d))return d;var p=d+"";return p=="0"&&1/d==-h?"-0":p}function _i(d){if(d!=null){try{return rn.call(d)}catch{}try{return d+""}catch{}}return""}function zg(d){for(var p=-1,C=d?d.length:0,M=0,X=[];++p<C;){var D=d[p];D&&(X[M++]=D)}return X}function Lh(d,p){var C=ue(d)?Gt:Hd;return C(d,Tg(p,3))}function Cs(d,p){if(typeof d!="function"||p&&typeof p!="function")throw new TypeError(s);var C=function(){var M=arguments,X=p?p.apply(this,M):M[0],D=C.cache;if(D.has(X))return D.get(X);var B=d.apply(this,M);return C.cache=D.set(X,B),B};return C.cache=new(Cs.Cache||vn),C}Cs.Cache=vn;function Xg(d){return Bi(d,!1,!0)}function Zi(d,p){return d===p||d!==d&&p!==p}function Ui(d){return Jo(d)&&zt.call(d,"callee")&&(!Le.call(d,"callee")||sn.call(d)==c)}var ue=Array.isArray;function pi(d){return d!=null&&Ss(d.length)&&!Rs(d)}function Jo(d){return $i(d)&&pi(d)}var Qo=Ze||Wh;function Wg(d){if(pi(d)&&(ue(d)||typeof d=="string"||typeof d.splice=="function"||Qo(d)||Ui(d)))return!d.length;var p=an(d);if(p==E||p==b)return!d.size;if(vd||vs(d))return!ms(d).length;for(var C in d)if(zt.call(d,C))return!1;return!0}function Rs(d){var p=$e(d)?sn.call(d):"";return p==y||p==x}function Ss(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=u}function $e(d){var p=typeof d;return!!d&&(p=="object"||p=="function")}function $i(d){return!!d&&typeof d=="object"}function Ph(d){if(!$i(d)||sn.call(d)!=R||me(d))return!1;var p=he(d);if(p===null)return!0;var C=zt.call(p,"constructor")&&p.constructor;return typeof C=="function"&&C instanceof C&&rn.call(C)==gs}function Is(d){return typeof d=="symbol"||$i(d)&&sn.call(d)==T}var bs=en?Ft(en):og;function Oh(d){return qo(d,Nh(d))}function Fh(d){return d==null?"":dg(d)}function Dh(d,p,C){var M=d==null?e:vh(d,p);return M===e?C:M}function kh(d,p){return d!=null&&Ag(d,p,ng)}function Zn(d){return pi(d)?xh(d):ag(d)}function Nh(d){return pi(d)?xh(d,!0):Ch(d)}var Bg=wg(function(d,p,C){Rh(d,p,C)});function Gh(d){return d}function ta(d){return wh(typeof d=="function"?d:Bi(d,!0))}function zh(d){return Es(d)?St(ws(d)):cg(d)}function Xh(){return[]}function Wh(){return!1}ct.compact=zg,ct.iteratee=ta,ct.keys=Zn,ct.keysIn=Nh,ct.memoize=Cs,ct.merge=Bg,ct.property=zh,ct.toPlainObject=Oh,ct.clone=Xg,ct.eq=Zi,ct.forEach=Lh,ct.get=Dh,ct.hasIn=kh,ct.identity=Gh,ct.isArguments=Ui,ct.isArray=ue,ct.isArrayLike=pi,ct.isArrayLikeObject=Jo,ct.isBuffer=Qo,ct.isEmpty=Wg,ct.isFunction=Rs,ct.isLength=Ss,ct.isObject=$e,ct.isObjectLike=$i,ct.isPlainObject=Ph,ct.isSymbol=Is,ct.isTypedArray=bs,ct.stubArray=Xh,ct.stubFalse=Wh,ct.toString=Fh,ct.each=Lh,ct.VERSION=n,te&&((te.exports=ct)._=ct,$t._=ct)}).call(br)})(nl,nl.exports);var D1=$s;function $s(i,t){var e=i&&i.type,n;if(e==="FeatureCollection")for(n=0;n<i.features.length;n++)$s(i.features[n],t);else if(e==="GeometryCollection")for(n=0;n<i.geometries.length;n++)$s(i.geometries[n],t);else if(e==="Feature")$s(i.geometry,t);else if(e==="Polygon")ac(i.coordinates,t);else if(e==="MultiPolygon")for(n=0;n<i.coordinates.length;n++)ac(i.coordinates[n],t);return i}function ac(i,t){if(i.length!==0){lc(i[0],t);for(var e=1;e<i.length;e++)lc(i[e],!t)}}function lc(i,t){for(var e=0,n=0,r=0,s=i.length,o=s-1;r<s;o=r++){var a=(i[r][0]-i[o][0])*(i[o][1]+i[r][1]),l=e+a;n+=Math.abs(e)>=Math.abs(a)?e-l+a:a-l+e,e=l}e+n>=0!=!!t&&i.reverse()}var ld={exports:{}};const k1=[{key:"building",polygon:"all"},{key:"highway",polygon:"whitelist",values:["services","rest_area","escape","elevator"]},{key:"natural",polygon:"blacklist",values:["coastline","cliff","ridge","arete","tree_row"]},{key:"landuse",polygon:"all"},{key:"waterway",polygon:"whitelist",values:["riverbank","dock","boatyard","dam"]},{key:"amenity",polygon:"all"},{key:"leisure",polygon:"all"},{key:"barrier",polygon:"whitelist",values:["city_wall","ditch","hedge","retaining_wall","wall","spikes"]},{key:"railway",polygon:"whitelist",values:["station","turntable","roundhouse","platform"]},{key:"area",polygon:"all"},{key:"boundary",polygon:"all"},{key:"man_made",polygon:"blacklist",values:["cutline","embankment","pipeline"]},{key:"power",polygon:"whitelist",values:["plant","substation","generator","transformer"]},{key:"place",polygon:"all"},{key:"shop",polygon:"all"},{key:"aeroway",polygon:"blacklist",values:["taxiway"]},{key:"tourism",polygon:"all"},{key:"historic",polygon:"all"},{key:"public_transport",polygon:"all"},{key:"office",polygon:"all"},{key:"building:part",polygon:"all"},{key:"military",polygon:"all"},{key:"ruins",polygon:"all"},{key:"area:highway",polygon:"all"},{key:"craft",polygon:"all"},{key:"golf",polygon:"all"},{key:"indoor",polygon:"all"}];(function(i){i.exports=k1})(ld);var at=nl.exports,Bs=D1,Ks={};ld.exports.forEach(function(i){if(i.polygon==="all")Ks[i.key]=!0;else{var t=i.polygon==="whitelist"?"included_values":"excluded_values",e={};i.values.forEach(function(n){e[n]=!0}),Ks[i.key]={},Ks[i.key][t]=e}});function N1(i,t){return(i.version||t.version)&&i.version!==t.version?(+i.version||0)>(+t.version||0)?i:t:at.merge(i,t)}var _o={};_o=function(i,t,e){t=at.merge({verbose:!1,flatProperties:!0,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:Ks,deduplicator:N1},t);var n;return typeof XMLDocument<"u"&&i instanceof XMLDocument||typeof XMLDocument>"u"&&i.childNodes?n=s(i):n=r(i),n;function r(l){var h=new Array,u=new Array,c=new Array;function f(w){var I=at.clone(w);I.lat=w.center.lat,I.lon=w.center.lon,I.__is_center_placeholder=!0,h.push(I)}function g(w){var I=at.clone(w);I.nodes=[];function b(S,T,O){var P={type:"node",id:"_"+I.type+"/"+I.id+"bounds"+O,lat:S,lon:T};I.nodes.push(P.id),h.push(P)}b(I.bounds.minlat,I.bounds.minlon,1),b(I.bounds.maxlat,I.bounds.minlon,2),b(I.bounds.maxlat,I.bounds.maxlon,3),b(I.bounds.minlat,I.bounds.maxlon,4),I.nodes.push(I.nodes[0]),I.__is_bounds_placeholder=!0,u.push(I)}function _(w){function I(b,S,T){var O={type:"node",id:T,lat:b,lon:S};h.push(O)}at.isArray(w.nodes)||(w.nodes=w.geometry.map(function(b){return b!==null?"_anonymous@"+b.lat+"/"+b.lon:"_anonymous@unknown_location"})),w.geometry.forEach(function(b,S){b&&I(b.lat,b.lon,w.nodes[S])})}function m(w){function I(S,T,O){var P={type:"node",id:O,lat:S,lon:T};h.push(P)}function b(S,T){if(u.some(function(F){return F.type=="way"&&F.id==T}))return;var O={type:"way",id:T,nodes:[]};function P(F,W){var G={type:"node",id:"_anonymous@"+F+"/"+W,lat:F,lon:W};O.nodes.push(G.id),h.push(G)}S.forEach(function(F){F?P(F.lat,F.lon):O.nodes.push(void 0)}),u.push(O)}w.members.forEach(function(S,T){S.type=="node"?S.lat&&I(S.lat,S.lon,S.ref):S.type=="way"&&S.geometry&&(S.ref="_fullGeom"+S.ref,b(S.geometry,S.ref))})}for(var y=0;y<l.elements.length;y++)switch(l.elements[y].type){case"node":var x=l.elements[y];h.push(x);break;case"way":var E=at.clone(l.elements[y]);E.nodes=at.clone(E.nodes),u.push(E),E.center&&f(E),E.geometry?_(E):E.bounds&&g(E);break;case"relation":var v=at.clone(l.elements[y]);v.members=at.clone(v.members),c.push(v);var R=v.members&&v.members.some(function(w){return w.type=="node"&&w.lat||w.type=="way"&&w.geometry&&w.geometry.length>0});v.center&&f(v),R?m(v):v.bounds&&g(v);break}return o(h,u,c)}function s(l){var h=new Array,u=new Array,c=new Array;function f(v,R,w){v.hasAttribute(w)&&(R[w]=v.getAttribute(w))}function g(v,R){var w=at.clone(v);f(R,w,"lat"),f(R,w,"lon"),w.__is_center_placeholder=!0,h.push(w)}function _(v,R){var w=at.clone(v);w.nodes=[];function I(b,S,T){var O={type:"node",id:"_"+w.type+"/"+w.id+"bounds"+T,lat:b,lon:S};w.nodes.push(O.id),h.push(O)}I(R.getAttribute("minlat"),R.getAttribute("minlon"),1),I(R.getAttribute("maxlat"),R.getAttribute("minlon"),2),I(R.getAttribute("maxlat"),R.getAttribute("maxlon"),3),I(R.getAttribute("minlat"),R.getAttribute("maxlon"),4),w.nodes.push(w.nodes[0]),w.__is_bounds_placeholder=!0,u.push(w)}function m(v,R){function w(I,b,S){var T={type:"node",id:S,lat:I,lon:b};return h.push(T),T.id}at.isArray(v.nodes)||(v.nodes=[],at.each(R,function(I,b){v.nodes.push("_anonymous@"+I.getAttribute("lat")+"/"+I.getAttribute("lon"))})),at.each(R,function(I,b){I.getAttribute("lat")&&w(I.getAttribute("lat"),I.getAttribute("lon"),v.nodes[b])})}function y(v,R){function w(b,S,T){var O={type:"node",id:T,lat:b,lon:S};h.push(O)}function I(b,S){if(u.some(function(P){return P.type=="way"&&P.id==S}))return;var T={type:"way",id:S,nodes:[]};function O(P,F){var W={type:"node",id:"_anonymous@"+P+"/"+F,lat:P,lon:F};T.nodes.push(W.id),h.push(W)}at.each(b,function(P){P.getAttribute("lat")?O(P.getAttribute("lat"),P.getAttribute("lon")):T.nodes.push(void 0)}),u.push(T)}at.each(R,function(b,S){v.members[S].type=="node"?b.getAttribute("lat")&&w(b.getAttribute("lat"),b.getAttribute("lon"),v.members[S].ref):v.members[S].type=="way"&&b.getElementsByTagName("nd").length>0&&(v.members[S].ref="_fullGeom"+v.members[S].ref,I(b.getElementsByTagName("nd"),v.members[S].ref))})}at.each(l.getElementsByTagName("node"),function(v,R){var w={};at.each(v.getElementsByTagName("tag"),function(b){w[b.getAttribute("k")]=b.getAttribute("v")});var I={type:"node"};f(v,I,"id"),f(v,I,"lat"),f(v,I,"lon"),f(v,I,"version"),f(v,I,"timestamp"),f(v,I,"changeset"),f(v,I,"uid"),f(v,I,"user"),at.isEmpty(w)||(I.tags=w),h.push(I)});var x,E;return at.each(l.getElementsByTagName("way"),function(v,R){var w={},I=[];at.each(v.getElementsByTagName("tag"),function(T){w[T.getAttribute("k")]=T.getAttribute("v")});var b=!1;at.each(v.getElementsByTagName("nd"),function(T,O){var P;(P=T.getAttribute("ref"))&&(I[O]=P),!b&&T.getAttribute("lat")&&(b=!0)});var S={type:"way"};f(v,S,"id"),f(v,S,"version"),f(v,S,"timestamp"),f(v,S,"changeset"),f(v,S,"uid"),f(v,S,"user"),I.length>0&&(S.nodes=I),at.isEmpty(w)||(S.tags=w),(x=v.getElementsByTagName("center")[0])&&g(S,x),b?m(S,v.getElementsByTagName("nd")):(E=v.getElementsByTagName("bounds")[0])&&_(S,E),u.push(S)}),at.each(l.getElementsByTagName("relation"),function(v,R){var w={},I=[];at.each(v.getElementsByTagName("tag"),function(T){w[T.getAttribute("k")]=T.getAttribute("v")});var b=!1;at.each(v.getElementsByTagName("member"),function(T,O){I[O]={},f(T,I[O],"ref"),f(T,I[O],"role"),f(T,I[O],"type"),(!b&&I[O].type=="node"&&T.getAttribute("lat")||I[O].type=="way"&&T.getElementsByTagName("nd").length>0)&&(b=!0)});var S={type:"relation"};f(v,S,"id"),f(v,S,"version"),f(v,S,"timestamp"),f(v,S,"changeset"),f(v,S,"uid"),f(v,S,"user"),I.length>0&&(S.members=I),at.isEmpty(w)||(S.tags=w),(x=v.getElementsByTagName("center")[0])&&g(S,x),b?y(S,v.getElementsByTagName("member")):(E=v.getElementsByTagName("bounds")[0])&&_(S,E),c.push(S)}),o(h,u,c)}function o(l,h,u){function c(A,tt){if(typeof tt!="object"&&(tt={}),typeof t.uninterestingTags=="function")return!t.uninterestingTags(A,tt);for(var V in A)if(t.uninterestingTags[V]!==!0&&!(tt[V]===!0||tt[V]===A[V]))return!0;return!1}function f(A){var tt={timestamp:A.timestamp,version:A.version,changeset:A.changeset,user:A.user,uid:A.uid};for(var V in tt)tt[V]===void 0&&delete tt[V];return tt}for(var g=new Object,_=new Object,m=0;m<l.length;m++){var y=l[m];g[y.id]!==void 0&&(y=t.deduplicator(y,g[y.id])),g[y.id]=y,typeof y.tags<"u"&&c(y.tags)&&(_[y.id]=!0)}for(var m=0;m<u.length;m++)if(at.isArray(u[m].members))for(var x=0;x<u[m].members.length;x++)u[m].members[x].type=="node"&&(_[u[m].members[x].ref]=!0);for(var E=new Object,v=new Object,m=0;m<h.length;m++){var R=h[m];if(E[R.id]&&(R=t.deduplicator(R,E[R.id])),E[R.id]=R,at.isArray(R.nodes))for(var x=0;x<R.nodes.length;x++)typeof R.nodes[x]!="object"&&(v[R.nodes[x]]=!0,R.nodes[x]=g[R.nodes[x]])}var w=new Array;for(var I in g){var y=g[I];(!v[I]||_[I])&&w.push(y)}for(var b=new Array,m=0;m<u.length;m++){var S=u[m];b[S.id]&&(S=t.deduplicator(S,b[S.id])),b[S.id]=S}var T={node:{},way:{},relation:{}};for(var I in b){var S=b[I];if(!at.isArray(S.members)){t.verbose&&console.warn("Relation",S.type+"/"+S.id,"ignored because it has no members");continue}for(var x=0;x<S.members.length;x++){var O=S.members[x].type,P=S.members[x].ref;if(typeof P!="number"&&(P=P.replace("_fullGeom","")),!T[O]){t.verbose&&console.warn("Relation",S.type+"/"+S.id,"member",O+"/"+P,"ignored because it has an invalid type");continue}typeof T[O][P]>"u"&&(T[O][P]=[]),T[O][P].push({role:S.members[x].role,rel:S.id,reltags:S.tags})}}var F,W=[];for(m=0;m<w.length;m++){if(typeof w[m].lon>"u"||typeof w[m].lat>"u"){t.verbose&&console.warn("POI",w[m].type+"/"+w[m].id,"ignored because it lacks coordinates");continue}var G={type:"Feature",id:w[m].type+"/"+w[m].id,properties:{type:w[m].type,id:w[m].id,tags:w[m].tags||{},relations:T.node[w[m].id]||[],meta:f(w[m])},geometry:{type:"Point",coordinates:[+w[m].lon,+w[m].lat]}};w[m].__is_center_placeholder&&(G.properties.geometry="center"),e?e(G):W.push(G)}for(var $=[],z=[],m=0;m<u.length;m++)if(b[u[m].id]===u[m]){if(typeof u[m].tags<"u"&&(u[m].tags.type=="route"||u[m].tags.type=="waterway")){let tt=function(V){var J=!1,Ct;Ct=V.members.filter(function(j){return j.type==="way"}),Ct=Ct.map(function(j){var Yt=E[j.ref];if(Yt===void 0||Yt.nodes===void 0){t.verbose&&console.warn("Route "+V.type+"/"+V.id,"tainted by a missing or incomplete  way",j.type+"/"+j.ref),J=!0;return}return{id:j.ref,role:j.role,way:Yt,nodes:Yt.nodes.filter(function(we){return we!==void 0?!0:(J=!0,t.verbose&&console.warn("Route",V.type+"/"+V.id,"tainted by a way",j.type+"/"+j.ref,"with a missing node"),!1)})}}),Ct=at.compact(Ct);var At;At=Ra(Ct);var _t=[];if(_t=at.compact(At.map(function(j){return at.compact(j.map(function(Yt){return[+Yt.lon,+Yt.lat]}))})),_t.length==0)return t.verbose&&console.warn("Route",V.type+"/"+V.id,"contains no coordinates"),!1;var st={type:"Feature",id:V.type+"/"+V.id,properties:{type:V.type,id:V.id,tags:V.tags||{},relations:T[V.type][V.id]||[],meta:f(V)},geometry:{type:_t.length===1?"LineString":"MultiLineString",coordinates:_t.length===1?_t[0]:_t}};return J&&(t.verbose&&console.warn("Route",V.type+"/"+V.id,"is tainted"),st.properties.tainted=!0),st};var rt=tt;if(!at.isArray(u[m].members)){t.verbose&&console.warn("Route",u[m].type+"/"+u[m].id,"ignored because it has no members");continue}if(u[m].members.forEach(function(V){E[V.ref]&&!c(E[V.ref].tags)&&(E[V.ref].is_skippablerelationmember=!0)}),G=tt(u[m]),G===!1){t.verbose&&console.warn("Route relation",u[m].type+"/"+u[m].id,"ignored because it has invalid geometry");continue}e?e(Bs(G)):z.push(G)}if(typeof u[m].tags<"u"&&(u[m].tags.type=="multipolygon"||u[m].tags.type=="boundary")){let V=function(J,Ct){var At=!1,_t=H?"way":"relation",st=typeof J.id=="number"?J.id:+J.id.replace("_fullGeom",""),j;j=Ct.members.filter(function(ut){return ut.type==="way"}),j=j.map(function(ut){var bt=E[ut.ref];if(bt===void 0||bt.nodes===void 0){t.verbose&&console.warn("Multipolygon",_t+"/"+st,"tainted by a missing or incomplete way",ut.type+"/"+ut.ref),At=!0;return}return{id:ut.ref,role:ut.role||"outer",way:bt,nodes:bt.nodes.filter(function(Nt){return Nt!==void 0?!0:(At=!0,t.verbose&&console.warn("Multipolygon",_t+"/"+st,"tainted by a way",ut.type+"/"+ut.ref,"with a missing node"),!1)})}}),j=at.compact(j);var Yt,we;Yt=Ra(j.filter(function(ut){return ut.role==="outer"})),we=Ra(j.filter(function(ut){return ut.role==="inner"}));var Ut;function $t(ut){var bt=function(Ht,St){for(var Be=0;Be<St.length;Be++)if(Gt(St[Be],Ht))return!0;return!1},Nt=function(Ht){return Ht.map(function(St){return[+St.lat,+St.lon]})},Gt=function(Ht,St){for(var Be=Ht[0],Ft=Ht[1],Xn=!1,me=0,yn=St.length-1;me<St.length;yn=me++){var Wn=St[me][0],nn=St[me][1],Wi=St[yn][0],Bn=St[yn][1],xn=nn>Ft!=Bn>Ft&&Be<(Wi-Wn)*(Ft-nn)/(Bn-nn)+Wn;xn&&(Xn=!Xn)}return Xn},ge,Ae;for(ut=Nt(ut),ge=0;ge<Yt.length;ge++)if(Ae=Nt(Yt[ge]),bt(Ae,ut))return ge}Ut=Yt.map(function(ut){return[ut]});for(var te=0;te<we.length;te++){var Qe=$t(we[te]);Qe!==void 0?Ut[Qe].push(we[te]):t.verbose&&console.warn("Multipolygon",_t+"/"+st,"contains an inner ring with no containing outer")}var Ce=[];if(Ce=at.compact(Ut.map(function(ut){var bt=at.compact(ut.map(function(Nt){if(Nt.length<4){t.verbose&&console.warn("Multipolygon",_t+"/"+st,"contains a ring with less than four nodes");return}return at.compact(Nt.map(function(Gt){return[+Gt.lon,+Gt.lat]}))}));if(bt.length==0){t.verbose&&console.warn("Multipolygon",_t+"/"+st,"contains an empty ring cluster");return}return bt})),Ce.length==0)return t.verbose&&console.warn("Multipolygon",_t+"/"+st,"contains no coordinates"),!1;var tn="MultiPolygon";Ce.length===1&&(tn="Polygon",Ce=Ce[0]);var en={type:"Feature",id:J.type+"/"+st,properties:{type:J.type,id:st,tags:J.tags||{},relations:T[J.type][J.id]||[],meta:f(J)},geometry:{type:tn,coordinates:Ce}};return At&&(t.verbose&&console.warn("Multipolygon",_t+"/"+st,"is tainted"),en.properties.tainted=!0),en};var Et=V;if(!at.isArray(u[m].members)){t.verbose&&console.warn("Multipolygon",u[m].type+"/"+u[m].id,"ignored because it has no members");continue}for(var Z=0,x=0;x<u[m].members.length;x++)u[m].members[x].role=="outer"?Z++:t.verbose&&u[m].members[x].role!="inner"&&console.warn("Multipolygon",u[m].type+"/"+u[m].id,"member",u[m].members[x].type+"/"+u[m].members[x].ref,'ignored because it has an invalid role: "'+u[m].members[x].role+'"');if(u[m].members.forEach(function(J){E[J.ref]&&(J.role==="outer"&&!c(E[J.ref].tags,u[m].tags)&&(E[J.ref].is_skippablerelationmember=!0),J.role==="inner"&&!c(E[J.ref].tags)&&(E[J.ref].is_skippablerelationmember=!0))}),Z==0){t.verbose&&console.warn("Multipolygon relation",u[m].type+"/"+u[m].id,"ignored because it has no outer ways");continue}var H=!1;Z==1&&!c(u[m].tags,{type:!0})&&(H=!0);var G=null;if(!H)G=V(u[m],u[m]);else{var lt=u[m].members.filter(function(J){return J.role==="outer"})[0];if(lt=E[lt.ref],lt===void 0){t.verbose&&console.warn("Multipolygon relation",u[m].type+"/"+u[m].id,"ignored because outer way",lt.type+"/"+lt.ref,"is missing");continue}lt.is_skippablerelationmember=!0,G=V(lt,u[m])}if(G===!1){t.verbose&&console.warn("Multipolygon relation",u[m].type+"/"+u[m].id,"ignored because it has invalid geometry");continue}e?e(Bs(G)):z.push(G)}}for(var m=0;m<h.length;m++)if(E[h[m].id]===h[m]){if(!at.isArray(h[m].nodes)){t.verbose&&console.warn("Way",h[m].type+"/"+h[m].id,"ignored because it has no nodes");continue}if(!h[m].is_skippablerelationmember){typeof h[m].id!="number"&&(h[m].id=+h[m].id.replace("_fullGeom","")),h[m].tainted=!1,h[m].hidden=!1;var k=new Array;for(x=0;x<h[m].nodes.length;x++)typeof h[m].nodes[x]=="object"?k.push([+h[m].nodes[x].lon,+h[m].nodes[x].lat]):(t.verbose&&console.warn("Way",h[m].type+"/"+h[m].id,"is tainted by an invalid node"),h[m].tainted=!0);if(k.length<=1){t.verbose&&console.warn("Way",h[m].type+"/"+h[m].id,"ignored because it contains too few nodes");continue}var N="LineString";typeof h[m].nodes[0]<"u"&&typeof h[m].nodes[h[m].nodes.length-1]<"u"&&h[m].nodes[0].id===h[m].nodes[h[m].nodes.length-1].id&&(typeof h[m].tags<"u"&&a(h[m].tags)||h[m].__is_bounds_placeholder)&&(N="Polygon",k=[k]);var G={type:"Feature",id:h[m].type+"/"+h[m].id,properties:{type:h[m].type,id:h[m].id,tags:h[m].tags||{},relations:T.way[h[m].id]||[],meta:f(h[m])},geometry:{type:N,coordinates:k}};h[m].tainted&&(t.verbose&&console.warn("Way",h[m].type+"/"+h[m].id,"is tainted"),G.properties.tainted=!0),h[m].__is_bounds_placeholder&&(G.properties.geometry="bounds"),e?e(Bs(G)):N=="LineString"?$.push(G):z.push(G)}}return e?!0:(F={type:"FeatureCollection",features:[]},F.features=F.features.concat(z),F.features=F.features.concat($),F.features=F.features.concat(W),t.flatProperties&&F.features.forEach(function(A){A.properties=at.merge(A.properties.meta,A.properties.tags,{id:A.properties.type+"/"+A.properties.id})}),F=Bs(F),F)}function a(l){var h=t.polygonFeatures;if(typeof h=="function")return h(l);if(l.area==="no")return!1;for(var u in l){var c=l[u],f=h[u];if(!(typeof f>"u")&&c!=="no"&&(f===!0||f.included_values&&f.included_values[c]===!0||f.excluded_values&&f.excluded_values[c]!==!0))return!0}return!1}};function Ra(i){for(var t=function(c){return c[0]},e=function(c){return c[c.length-1]},n=function(c,f){return c!==void 0&&f!==void 0&&c.id===f.id},r=[],s,o,a,l,h,u;i.length;)for(s=i.pop().nodes.slice(),r.push(s);i.length&&!n(t(s),e(s));){for(o=t(s),a=e(s),l=0;l<i.length;l++)if(u=i[l].nodes,n(a,t(u))){h=s.push,u=u.slice(1);break}else if(n(a,e(u))){h=s.push,u=u.slice(0,-1).reverse();break}else if(n(o,e(u))){h=s.unshift,u=u.slice(0,-1);break}else if(n(o,t(u))){h=s.unshift,u=u.slice(1).reverse();break}else u=h=null;if(!u)break;i.splice(l,1),h.apply(s,u)}return r}_o.toGeojson=_o;var G1=_o;const z1="https://maps.google.com/mapfiles/kml/paddle/red-circle.png",X1=new or({image:new Yl({anchor:[.5,1],src:z1})});let Pn=[],_n=15,Li=[],hd=1,ud=1,hc=0,uc=0,je,bi,cd,fd,Mt,kt,ke,be,Ne,Te,dd,gd,md,_d;const dh=new th,gh=new th,po=new th;let Pi=!1;function W1(i,t){const e=i[0],n=e.width,r=e.height,s=e.data,o=new Uint8ClampedArray(s.length),a=t.resolution*2,l=n-1,h=r-1,u=[0,0,0,0],c=2*Math.PI,f=Math.PI/2,g=Math.PI*t.sunEl/180,_=Math.PI*t.sunAz/180,m=Math.cos(g),y=Math.sin(g);let x,E,v,R,w,I,b,S,T,O,P,F,W,G,$;function z(Z){return Z[0]*256+Z[1]+Z[2]/256-32768}for(E=0;E<=h;++E)for(w=E===0?0:E-1,I=E===h?h:E+1,x=0;x<=l;++x)v=x===0?0:x-1,R=x===l?l:x+1,b=(E*n+v)*4,u[0]=s[b],u[1]=s[b+1],u[2]=s[b+2],u[3]=s[b+3],S=t.vert*z(u),b=(E*n+R)*4,u[0]=s[b],u[1]=s[b+1],u[2]=s[b+2],u[3]=s[b+3],T=t.vert*z(u),O=(T-S)/a,b=(w*n+x)*4,u[0]=s[b],u[1]=s[b+1],u[2]=s[b+2],u[3]=s[b+3],S=t.vert*z(u),b=(I*n+x)*4,u[0]=s[b],u[1]=s[b+1],u[2]=s[b+2],u[3]=s[b+3],T=t.vert*z(u),P=(T-S)/a,F=Math.atan(Math.sqrt(O*O+P*P)),W=Math.atan2(P,-O),W<0?W=f-W:W>f?W=c-W+f:W=f-W,G=y*Math.cos(F)+m*Math.sin(F)*Math.cos(_-W),b=(E*n+x)*4,$=255*G,o[b]=$,o[b+1]=$,o[b+2]=$,o[b+3]=s[b+3];return{data:o,width:n,height:r}}function mh(){const t=eh({maxZoom:_n});Mt=(ke-be+1)*256,kt=(Ne-Te+1)*256,console.log(Mt,kt);const e=t.getTileCoordExtent([_n,be,Te]),n=t.getTileCoordExtent([_n,ke,Ne]);je=[e[0],e[3]],bi=[n[2],n[1]],cd=n[2]-e[0],fd=e[3]-n[1],console.log([kr(je),kr(bi)])}function pd(){const i=eh({maxZoom:_n});ke=0,be=32768,Ne=0,Te=32768,Pn.forEach(t=>{let[e,n]=i.getTileCoordForCoordAndZ(t,_n).slice(1);ke=Math.max(ke,e),be=Math.min(be,e),Ne=Math.max(Ne,n),Te=Math.min(Te,n)}),dd=be,gd=Te,md=ke,_d=Ne,mh()}function B1(){const i=Math.pow(2,_n);be>=1&&(be-=1),Te>=1&&(Te-=1),ke<=i-2&&(ke+=1),Ne<=i-2&&(Ne+=1),mh()}function Y1(){be<dd&&(be+=1),Te<gd&&(Te+=1),ke>md&&(ke-=1),Ne>_d&&(Ne-=1),mh()}function yd(i,t,e,n,r,s){let o=[];for(const[a,l]of i){const h=Math.floor((a-t[0])/e*r),u=Math.floor((t[1]-l)/n*s);o.push([h,u])}return o}function Z1(i,t,e){let n=[];return i.forEach(r=>{let s=r.x*e+t[0],o=t[1]-r.y*e;n.push([s,o])}),n}async function U1(){const t="https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",e=document.createElement("canvas"),n=e.getContext("2d");e.width=Mt,e.height=kt;const r=async(k,N)=>{const rt=t.replace("{z}",_n).replace("{x}",k).replace("{y}",N),A=await(await fetch(rt)).blob(),tt=new Image,V=new Promise(J=>{tt.onload=()=>J(tt)});return tt.src=URL.createObjectURL(A),V},s=async()=>{for(let k=be;k<=ke;k++)for(let N=Te;N<=Ne;N++){const rt=await r(k,N),Et=(k-be)*256,A=(N-Te)*256;n.drawImage(rt,Et,A,256,256)}},o=kr(je),a=kr(bi),l=[{key:"natural",value:"water"},{key:"natural",value:"wetland"}],h=[{key:"landuse",value:"forest"},{key:"natural",value:"wood"}],u=[{value:"waterway"}],c=[{value:"bridge"}],f=[{value:"building"}],g=[{value:"barrier"}];let _=[],m=[],y=[],x=[],E=[],v=[];const R=`${a[1]},${o[0]},${o[1]},${a[0]}`,w=await cc(R,l);_=Sa(o,a,w);const I=await Ys(R,u);if(I.elements.length>=1){y=Ia(o,a,I);for(let k=0;k<kt;k++)for(let N=0;N<Mt;N++)_[k][N]=_[k][N]||y[k][N]}const b=await Ys(R,f);if(b.elements.length>=1){E=Sa(o,a,b);for(let k=0;k<kt;k++)for(let N=0;N<Mt;N++)_[k][N]=_[k][N]||E[k][N]}const S=await Ys(R,g);if(S.elements.length>=1){v=Ia(o,a,S);for(let k=0;k<kt;k++)for(let N=0;N<Mt;N++)_[k][N]=_[k][N]||v[k][N]}const T=await Ys(R,c);if(T.elements.length>=1){x=Ia(o,a,T);for(let k=0;k<kt;k++)for(let N=0;N<Mt;N++)_[k][N]=_[k][N]^x[k][N]}const O=await cc(R,h);m=Sa(o,a,O);const P=yd(Pn,je,cd,fd,Mt,kt);let F=[];const W=[];await s().then(()=>{const N=n.getImageData(0,0,e.width,e.height).data;for(let rt=0;rt<e.height;rt++){const Et=[];for(let A=0;A<e.width;A++){const tt=(rt*e.width+A)*4,V=N[tt],J=N[tt+1],Ct=N[tt+2],At=V*256+J+Ct/256-32768;Et.push(At)}W.push(Et)}});let G=[];for(let k=0;k<P.length-1;k++){let N=new Vx(Mt,kt,P[k],P[k+1],W,_,m);G.push(N)}let $=[],z=!1;const Z=performance.now();for(let k=0;k<G.length;k++){let N=Hx(G[k],_n,hd,ud);if(N.length==0){z=!0;break}else $.push(N)}const lt=performance.now()-Z;if(console.log(`\u0412\u0440\u0435\u043C\u044F \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F: ${lt.toFixed(2)} \u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434`),z)P.length==2?alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043D\u0430\u0439\u0442\u0438 \u043F\u0443\u0442\u044C, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0443\u0432\u0435\u043B\u0438\u0447\u0438\u0442\u044C \u0440\u0430\u0437\u043C\u0435\u0440 \u043E\u043A\u043D\u0430 \u043F\u043E\u0438\u0441\u043A\u0430"):alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043D\u0430\u0439\u0442\u0438 \u043C\u0430\u0440\u0448\u0440\u0443\u0442 \u043C\u0435\u0436\u0434\u0443 \u043D\u0435\u043A\u043E\u0442\u043E\u0440\u044B\u043C\u0438 \u0442\u043E\u0447\u043A\u0430\u043C\u0438");else{let k=[];for(let N=0;N<G.length;N++){let rt=Z1($[N].reverse(),je,G[N].dictZoomPixelLen.get(_n));k.push(rt)}for(let N=0;N<k.length;N++)F.push(Pn[N]),F.push(...k[N]);F.push(Pn[Pn.length-1])}return F}const $1=new Yf({url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",crossOrigin:"anonymous",maxZoom:15,attributions:'<a href="https://github.com/tilezen/joerd/blob/master/docs/attribution.md" target="_blank">Data sources and attribution</a>'}),_h=new Ux({sources:[$1],operationType:"image",operation:W1}),Bo=new Xy({target:"map",layers:[new Nf({source:new kx}),new kf({opacity:.3,source:_h})],view:new hn({center:[622e4,7315e3],zoom:14})}),K1=new Jl({source:dh});Bo.addLayer(K1);const j1=new Jl({source:gh,style:new or({stroke:new Wl({color:"#ff0000",width:3})})});Bo.addLayer(j1);const yo=new Jl({source:po});Bo.addLayer(yo);const V1=["vert","sunEl","sunAz"],il={};V1.forEach(function(i){const t=document.getElementById(i);t.addEventListener("input",function(){_h.changed()}),il[i]=t});_h.on("beforeoperations",function(i){const t=i.data;t.resolution=i.resolution;for(const e in il)t[e]=Number(il[e].value)});var q1=document.getElementById("zoomSlider");q1.oninput=function(){_n=parseInt(this.value),pd(),Pn.length>=2&&Pi&&xr()};var H1=document.getElementById("mountainSlider");H1.oninput=function(){hd=parseInt(this.value)};var J1=document.getElementById("forestSlider");J1.oninput=function(){ud=parseInt(this.value)};function xr(){const i=[[je[0],je[1]],[bi[0],je[1]],[bi[0],bi[1]],[je[0],bi[1]],[je[0],je[1]]],t=new yr({geometry:new Wr([i])});po.clear(),po.addFeature(t)}Bo.on("click",async function(i){const t=i.coordinate;Pn.push(t),pd(),Pi==!0&&xr();const e=new yr({geometry:new zr(t)});e.setStyle(X1),dh.addFeature(e),console.log(Pn)});function Q1(){dh.clear(),Pn=[],console.log("\u041A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u044B \u0443\u0434\u0430\u043B\u0435\u043D\u044B")}function xd(){gh.clear(),Li=[],console.log("\u041F\u0443\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D")}function tv(){po.clear(),Pi=!1}document.getElementById("find-way").addEventListener("click",async function(){if(xd(),(ke-be)*(Ne-Te)>=2048*2048)alert("\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0435 \u043E\u043A\u043D\u043E \u043F\u043E\u0438\u0441\u043A\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0443\u0432\u0435\u043B\u0438\u0447\u0438\u0442\u044C \u0443\u0440\u043E\u0432\u0435\u043D\u044C zoom");else{hc=performance.now(),Li=await U1(),uc=performance.now(),console.log("\u041A\u043E\u043B-\u0432\u043E \u0442\u043E\u0447\u0435\u043A \u043C\u0430\u0440\u0448\u0440\u0443\u0442\u0430:",Li.length);const i=uc-hc;console.log(`\u041E\u0431\u0449\u0435\u0435 \u0432\u0440\u0435\u043C\u044F \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F: ${i.toFixed(2)} \u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434`);let t=new yr({geometry:new Hr(Li),name:"Route"});gh.addFeature(t),xr(),yo.setVisible(!0),Pi=!0}});document.getElementById("export-way").addEventListener("click",async function(){try{if(Li.length>0){let a=function(u){const c=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
      <gpx version="1.1" creator="OpenLayers">
      <trk><name>Route</name><trkseg>`,f="</trkseg></trk></gpx>",g=u.geometry.coordinates.map(_=>`<trkpt lat="${_[1]}" lon="${_[0]}"></trkpt>`).join(`
`);return c+g+f},h=function(u,c,f){const g=document.createElement("a"),_=new Blob([u],{type:f});g.href=URL.createObjectURL(_),g.download=c,g.click()};var i=a,t=h;let e=[];Li.forEach(u=>{e.push(kr(u))});const n=new Hr(e),r=new yr({geometry:n,name:"Route"}),o=new xE().writeFeatureObject(r),l=a(o);h(l,"route.gpx","application/gpx+xml")}else alert("\u041F\u0443\u0442\u044C \u043D\u0435 \u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D!")}catch(e){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043A\u0430\u0447\u0430\u0442\u044C",e)}});document.getElementById("clear-all").addEventListener("click",async function(){try{Q1(),xd(),tv()}catch(i){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u043E\u0447\u0438\u0441\u0442\u043A\u0438",i)}});document.getElementById("btn-rec-visible").addEventListener("click",async function(){try{Li.length==0&&xr(),Pi?(yo.setVisible(!1),Pi=!1):(yo.setVisible(!0),Pi=!0)}catch(i){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0432\u0438\u0434\u0438\u043C\u043E\u0441\u0442\u0438 \u043E\u043A\u043D\u0430 \u043F\u043E\u0438\u0441\u043A\u0430",i)}});document.getElementById("window-plus").addEventListener("click",async function(){try{B1(),xr()}catch(i){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u0443\u0432\u0435\u043B\u0438\u0447\u0435\u043D\u0438\u044F \u043E\u043A\u043D\u0430 \u043F\u043E\u0438\u0441\u043A\u0430",i)}});document.getElementById("window-minus").addEventListener("click",async function(){try{Y1(),xr()}catch(i){alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044E \u0443\u043C\u0435\u043D\u044C\u0448\u0435\u043D\u0438\u044F \u043E\u043A\u043D\u0430 \u043F\u043E\u0438\u0441\u043A\u0430",i)}});async function cc(i,t){const e=`
      [out:json];
      (
        ${t.map(r=>`way["${r.key}"="${r.value}"](${i}); relation["${r.key}"="${r.value}"](${i});`).join("")}
      );
      out body;
      >;
      out skel qt;
  `;console.log(e);const n=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:e}).toString()});if(!n.ok)throw new Error("Failed to fetch data from Overpass API");return await n.json()}function Ed(i,t){return{type:"Polygon",coordinates:[[[i[0],i[1]],[t[0],i[1]],[t[0],t[1]],[i[0],t[1]],[i[0],i[1]]]]}}function fc(i,t,e,n,r){t.beginPath(),i[0].forEach((s,o)=>{const a=(s[0]-e[0])/n,l=(e[3]-s[1])/r;o===0?t.moveTo(a,l):t.lineTo(a,l)}),t.closePath(),t.fill()}function Sa(i,t,e){const n=(t[0]-i[0])/Mt,r=(i[1]-t[1])/kt,s=[i[0],t[1],t[0],i[1]],o=Ed(i,t),a=new Map;e.elements.forEach(y=>{y.type==="node"&&a.set(y.id,[y.lon,y.lat])});const u={type:"FeatureCollection",features:G1(e).features.map(y=>{const x=F1(y,o);return x||null}).filter(Boolean)},c=document.createElement("canvas");c.width=Mt,c.height=kt;const f=c.getContext("2d");f.fillStyle="black",f.fillRect(0,0,Mt,kt),f.fillStyle="white",u.features.forEach(y=>{const x=y.geometry.coordinates;y.geometry.type==="Polygon"?fc(x,f,s,n,r):y.geometry.type==="MultiPolygon"&&x.forEach(E=>fc(E,f,s,n,r))});const _=f.getImageData(0,0,Mt,kt).data,m=Array.from({length:kt},()=>Array(Mt).fill(!1));for(let y=0;y<kt;y++)for(let x=0;x<Mt;x++){const E=(y*Mt+x)*4,v=_[E],R=_[E+1],w=_[E+2];v===255&&R===255&&w===255&&(m[y][x]=!0)}return m}async function Ys(i,t){const e=`
      [out:json];
      (
        ${t.map(r=>`way["${r.value}"](${i});`).join("")}
      );
      out body;
      >;
      out skel qt;
  `;console.log(e);const n=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:e}).toString()});if(!n.ok)throw new Error("Failed to fetch data from Overpass API");return await n.json()}function ev(i,t){i.beginPath(),i.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)i.lineTo(t[e][0],t[e][1]);i.strokeStyle="white",i.lineWidth=2,i.stroke()}function Ia(i,t,e){const n=t[0]-i[0],r=i[1]-t[1],s=Ed(i,t),o=new Map;e.elements.forEach(m=>{m.type==="node"&&o.set(m.id,[m.lon,m.lat])});const a=e.elements.filter(m=>m.type==="way"),l=document.createElement("canvas");l.width=Mt,l.height=kt;const h=l.getContext("2d");h.fillStyle="black",h.fillRect(0,0,Mt,kt),a.forEach(m=>{const y=m.nodes.map(v=>o.get(v)).filter(Boolean),x=de(y);r1(x,s).features.forEach(v=>{const R=v.geometry.coordinates,w=yd(R,i,n,r,Mt,kt);ev(h,w)})});const u=l.toDataURL("image/png"),c=document.createElement("a");c.href=u,c.download="waterway.png",c.click();const g=h.getImageData(0,0,Mt,kt).data,_=Array.from({length:kt},()=>Array(Mt).fill(!0));for(let m=0;m<kt;m++)for(let y=0;y<Mt;y++){const x=(m*Mt+y)*4,E=g[x],v=g[x+1],R=g[x+2];E===0&&v===0&&R===0&&(_[m][y]=!1)}return _}
